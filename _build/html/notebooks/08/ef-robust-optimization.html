
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Companion notebook to EF’s training on optimization with data uncertainty &#8212; Companion Notebooks for Data-Driven Mathematical Optimization in Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="9. Stochastic Optimization - Single Stage Problems" href="../09/09.00.html" />
    <link rel="prev" title="8. Robust Optimization - Single Stage Problems" href="08.00.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DVQ7NZ8CYZ"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-DVQ7NZ8CYZ');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo-02.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Companion Notebooks for Data-Driven Mathematical Optimization in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Data-Driven Mathematical Optimization in Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/01.00.html">
   1. Mathematical Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/alice-rose.html">
     Alice’s Rose
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/Pop-Up-Shop.html">
     Scenario Analysis: Pop Up Shop
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/02.00.html">
   2. Linear Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/lad-regression.html">
     Least Absolute Deviation (LAD) Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/lad-regression-wine-quality.html">
     Predicting Wine Quality
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/making-the-best-of-the-worst.html">
     Making the Best of the Worst
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/mad-portfolio-optimization.html">
     MAD Portfolio Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/fractional-bim.html">
     Fractional BIM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/large-example-chapter-2.html">
     Caroline’s raw material planning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/03.00.html">
   3. Mixed Integer Linear Programming
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/cryptarithms.html">
     Cryptarithms: Send More Money
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/strip-packing.html">
     Strip Packing: Placing Boxes on a Shelf
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/simple-production-model-gdp.html">
     Production Model with Disjuncts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/recharging-electric-vehicle.html">
     Recharging Strategy for an Electric Vehicle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/Shift-Scheduling.html">
     Shift Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/machine-scheduling.html">
     Machine Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/job-shop-scheduling.html">
     Job Shop Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/maintenance-planning.html">
     Maintenance Planning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/large-example-chapter-3.html">
     BIM Production
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/04.00.html">
   4. Network Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/dina-tables-and-variations.html">
     Dina’s table seating arrangements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/Transportation.html">
     Transportation and Allocation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/forex-arbitrage.html">
     Forex Arbitrage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/cryptocurrency-arbitrage.html">
     Crypto Currency Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/shortest-path-road-networks.html">
     Computing a real life shortest path
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/complete-example-ch4-power-network.html">
     Energy dispatch problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05/05.00.html">
   5. Convex Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/milk-pooling.html">
     Pooling and Blending
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/markowitz-portfolio.html">
     Markowitz Portfolio Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/bilinear-relaxations.html">
     McCormick Envelopes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/refinery-production.html">
     Refinery Production and Shadow Pricing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/detecting-change.html">
     Detecting Change
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/farkas-lemma.html">
     Minimum Risk-Free Rate of Return
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/svm-linear.html">
     Support Vector Machines for Binary Classifcation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/06.00.html">
   6. Conic Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/economic-order-quantity.html">
     Economic Order Quantity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/07.00.html">
   7. Accounting for Uncertainty: Optimization Meets Reality
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/Caroline-robustness-analysis.html">
     Caroline on robust steroids
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="08.00.html">
   8. Robust Optimization - Single Stage Problems
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Companion notebook to EF’s training on optimization with data uncertainty
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../09/09.00.html">
   9. Stochastic Optimization - Single Stage Problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10/10.00.html">
   10. Robust Optimization - Two Stage Problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../11/11.00.html">
   11. Stochastic Optimization - Two Stage Problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pyomo_style_guide.html">
   Pyomo Style Guide
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/jckantor/MO-book/main?urlpath=tree/notebooks/08/ef-robust-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/jckantor/MO-book/blob/main/notebooks/08/ef-robust-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/08/ef-robust-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Companion notebook to EF’s training on optimization with data uncertainty
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recall-the-alice-s-production-planning-model">
   Recall the Alice’s production planning model
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#betty-a-tiny-bit-of-data-science">
     Betty: a tiny bit of data science…
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#caroline-s-robust-model-for-box-uncertainty-in-wood-consumption">
     Caroline’s robust model for box uncertainty in wood consumption
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-model-in-pyomo">
   A model in
   <code class="docutils literal notranslate">
    <span class="pre">
     pyomo
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#integer-optimization">
   Integer optimization
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cardinality-constrained-uncertainty">
   Cardinality constrained uncertainty
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ball-uncertainty">
   Ball uncertainty
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#documentation-says-that-we-need-to-use-the-kernel-now">
     Documentation says that we need to use the kernel now
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#now-the-problem-is-nonlinear">
     Now the problem is nonlinear
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#but-cplex-gurobi-and-xpress-support-second-order-cones">
     But
     <code class="docutils literal notranslate">
      <span class="pre">
       cplex
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       gurobi
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       xpress
      </span>
     </code>
     support second order cones
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#and-therefore-we-can-also-have-mixed-integer-models">
     And therefore we can also have mixed integer models
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#final-note-maybe-useful-to-recall-that-in-python-you-can-always-ask-for-help">
     Final note: maybe useful to recall that in python you can always ask for help…
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-bring-second-order-cones-into-the-pyomo-environ">
   How to bring second order cones into the
   <code class="docutils literal notranslate">
    <span class="pre">
     pyomo.environ
    </span>
   </code>
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Companion notebook to EF’s training on optimization with data uncertainty</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Companion notebook to EF’s training on optimization with data uncertainty
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recall-the-alice-s-production-planning-model">
   Recall the Alice’s production planning model
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#betty-a-tiny-bit-of-data-science">
     Betty: a tiny bit of data science…
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#caroline-s-robust-model-for-box-uncertainty-in-wood-consumption">
     Caroline’s robust model for box uncertainty in wood consumption
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-model-in-pyomo">
   A model in
   <code class="docutils literal notranslate">
    <span class="pre">
     pyomo
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#integer-optimization">
   Integer optimization
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cardinality-constrained-uncertainty">
   Cardinality constrained uncertainty
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ball-uncertainty">
   Ball uncertainty
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#documentation-says-that-we-need-to-use-the-kernel-now">
     Documentation says that we need to use the kernel now
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#now-the-problem-is-nonlinear">
     Now the problem is nonlinear
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#but-cplex-gurobi-and-xpress-support-second-order-cones">
     But
     <code class="docutils literal notranslate">
      <span class="pre">
       cplex
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       gurobi
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       xpress
      </span>
     </code>
     support second order cones
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#and-therefore-we-can-also-have-mixed-integer-models">
     And therefore we can also have mixed integer models
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#final-note-maybe-useful-to-recall-that-in-python-you-can-always-ask-for-help">
     Final note: maybe useful to recall that in python you can always ask for help…
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-bring-second-order-cones-into-the-pyomo-environ">
   How to bring second order cones into the
   <code class="docutils literal notranslate">
    <span class="pre">
     pyomo.environ
    </span>
   </code>
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="companion-notebook-to-ef-s-training-on-optimization-with-data-uncertainty">
<h1>Companion notebook to EF’s training on optimization with data uncertainty<a class="headerlink" href="#companion-notebook-to-ef-s-training-on-optimization-with-data-uncertainty" title="Permalink to this headline">#</a></h1>
<p>Sander Vlot &amp; Joaquim Gromicho, 2021</p>
<hr class="docutils" />
<blockquote>
<div><p>During this course we make use of Jupyter notebooks hosted by <a class="reference external" href="https://colab.research.google.com/notebooks/intro.ipynb">Google Colab</a>.
The usage of this platform is allowed by ORTEC for <strong>educational and personal experimentation only</strong>. May you consider using it for a project please consult the IT department.
Notebooks deployed on <code class="docutils literal notranslate"><span class="pre">colab</span></code> require neither python nor other dependencies to be installed on your own machine, you only need a browser (preferably <code class="docutils literal notranslate"><span class="pre">chrome</span></code>) and you may also need a google account if you want to execute them.</p>
</div></blockquote>
<hr class="docutils" />
<p>This notebook has been setup for <code class="docutils literal notranslate"><span class="pre">colab</span></code>. Check <a class="reference external" href="https://jckantor.github.io/ND-Pyomo-Cookbook/">the pyomo cookbook</a> and in particular <a class="reference external" href="https://jckantor.github.io/ND-Pyomo-Cookbook/01.02-Running-Pyomo-on-Google-Colab.html">the explanation on how to get pyomo and the solvers on colab</a>.</p>
<p>May you want to use on your own python distribution, then you should care for  the installation of the required packages and subsidiary applications.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">at_colab</span> <span class="o">=</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span>

<span class="k">if</span> <span class="n">at_colab</span><span class="p">:</span>
    <span class="n">_</span><span class="o">=!</span>pip install -q pyomo
    <span class="n">_</span><span class="o">=!</span>wget -N -q <span class="s2">&quot;https://ampl.com/dl/open/ipopt/ipopt-linux64.zip&quot;</span>
    <span class="n">_</span><span class="o">=!</span>unzip -o -q ipopt-linux64
    <span class="n">_</span><span class="o">=!</span>apt-get install -y -q coinor-cbc
    <span class="n">_</span><span class="o">=!</span>pip install -q cplex
    <span class="n">_</span><span class="o">=!</span>pip install -q gurobipy
    <span class="n">_</span><span class="o">=!</span>pip install -q xpress
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pyomo <span class="nb">help</span> --solvers
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pyomo Solvers and Solver Managers
---------------------------------
Pyomo uses &#39;solver managers&#39; to execute &#39;solvers&#39; that perform
optimization and other forms of model analysis.  A solver directly
executes an optimizer, typically using an executable found on the
user&#39;s PATH environment.  Solver managers support a flexible mechanism
for asyncronously executing solvers either locally or remotely.  The
following solver managers are available in Pyomo:

    neos       Asynchronously execute solvers on the NEOS server
    serial     Synchronously execute solvers locally

If no solver manager is specified, Pyomo uses the serial solver
manager to execute solvers locally.  The neos solver manager is used
to execute solvers on the NEOS optimization server.


Serial Solver Interfaces
------------------------
The serial manager supports the following solver interfaces:

CPLEX Error  1016: Community Edition. Problem size limits exceeded. Purchase at http://ibm.biz/error1016.
Version identifier: 20.1.0.0 | 2020-11-11 | 9bedb6d68
CPXPARAM_Read_DataCheck                          1
Tried aggregator 1 time.
LP Presolve eliminated 0 rows and 1 columns.
All rows and columns eliminated.
Presolve time = 0.00 sec. (0.00 ticks)
   +appsi_cbc          2.9.9   Automated persistent interface to Cbc
   +appsi_cplex        20.1    Automated persistent interface to Cplex
   +appsi_gurobi       9.1.2   Automated persistent interface to
                               Gurobi
   +appsi_ipopt        3.12.13 Automated persistent interface to Ipopt
   *asl                        Interface for solvers using the AMPL
                               Solver Library
    baron                      The BARON MINLP solver
   +bilevel_blp_global         Global solver for continuous bilevel
                               linear problems
   +bilevel_blp_local          Local solver for continuous bilevel
                               linear problems
   +bilevel_bqp                Global solver for bilevel quadratic
                               problems
   +bilevel_ld                 Solver for bilevel problems using
                               linear duality
   +cbc                2.9.9   The CBC LP/MIP solver
    conopt                     The CONOPT NLP solver
    contrib.gjh                Interface to the AMPL GJH &quot;solver&quot;
    cplex                      The CPLEX LP/MIP solver
   +cplex_direct       20.1    Direct python interface to CPLEX
   +cplex_persistent   20.1    Persistent python interface to CPLEX
    cyipopt                    Cyipopt: direct python bindings to the
                               Ipopt NLP solver
    gams                       The GAMS modeling language
   +gdpbb              19.5.7  [DEPRECATED] Branch and Bound based GDP
                               Solver
   +gdpopt             20.2.28 The GDPopt decomposition-based
                               Generalized Disjunctive Programming
                               (GDP) solver
    glpk                       The GLPK LP/MIP solver
    gurobi                     The GUROBI LP/MIP solver
   +gurobi_direct      9.1.2   Direct python interface to Gurobi
   +gurobi_persistent  9.1.2   Persistent python interface to Gurobi
   +ipopt              3.12.13 The Ipopt NLP solver
   +mindtpy            0.1     MindtPy: Mixed-Integer Nonlinear
                               Decomposition Toolbox in Pyomo
    mosek                      The MOSEK LP/QP/SOCP/MIP solver
    mosek_direct               Direct python interface to MOSEK
    mosek_persistent           Persistent python interface to MOSEK.
   +mpec_minlp                 MPEC solver transforms to a MINLP
   +mpec_nlp                   MPEC solver that optimizes a nonlinear
                               transformation
   +multistart                 MultiStart solver for NLPs
    path                       Nonlinear MCP solver
    pico                       The PICO LP/MIP solver
   *py                         Direct python solver interfaces
    scip                       The SCIP LP/MIP solver
   +trustregion                Trust region filter method for black
                               box/glass box optimization
    xpress                     The XPRESS LP/MIP solver
   +xpress_direct      38.1.4  Direct python interface to XPRESS
   +xpress_persistent  38.1.4  Persistent python interface to Xpress

The leading symbol (one of *, -, +) indicates the current solver
availability.  A plus (+) indicates the solver is currently available
to be run from Pyomo with the serial solver manager, and (if
applicable) has a valid license.  A minus (-) indicates the solver
executables are available but do not report having a valid license.
The solver may still be usable in an unlicensed or &quot;demo&quot; mode for
limited problem sizes. An asterisk (*) indicates meta-solvers or
generic interfaces, which are always available.

Pyomo also supports solver interfaces that are wrappers around third-
party solver interfaces. These interfaces require a subsolver
specification that indicates the solver being executed.  For example,
the following indicates that the ipopt solver will be used:

   asl:ipopt

The asl interface provides a generic wrapper for all solvers that use
the AMPL Solver Library.

Note that subsolvers can not be enumerated automatically for these
interfaces.  However, if a solver is specified that is not found,
Pyomo assumes that the asl solver interface is being used.  Thus the
following solver name will launch ipopt if the &#39;ipopt&#39; executable is
on the user&#39;s path:

   ipopt


NEOS Solver Interfaces
----------------------
The neos solver manager supports solver interfaces that can be
executed remotely on the NEOS optimization server.  The following
solver interfaces are available with your current system
configuration:

    bonmin       Heuristic MINLP solver
    cbc          MILP solver
    conopt       Feasible path NLP solver
    couenne      Deterministic global MINLP solver
    cplex        MILP solver
    filmint      Heuristic MINLP solver
    filter       SQP NLP solver
    ipopt        Interior point NLP solver
    knitro       Convex MINLP solver
    l-bfgs-b     Bound-constrained NLP solver
    lancelot     Augmented Lagrangian NLP solver
    lgo          Lipschitz-Continuous Global Optimizer
    loqo         Interior point NLP solver
    minlp        Heuristic MINLP solver
    minos        SLC NLP solver
    minto        MILP solver
    mosek        Interior point NLP solver
    octeract     Deterministic global MINLP solver
    ooqp         Convex QP solver
    path         Nonlinear MCP solver
    raposa       A Global Solver for Polynomial Programming Problems
    snopt        SQP NLP solver
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="n">cbc</span>    <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>
<span class="n">ipopt</span>  <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;ipopt&#39;</span><span class="p">)</span>
<span class="n">cplex</span>  <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;cplex_direct&#39;</span><span class="p">)</span>
<span class="n">gurobi</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;gurobi_direct&#39;</span><span class="p">)</span>
<span class="n">xpress</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;xpress_direct&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="recall-the-alice-s-production-planning-model">
<h1>Recall the Alice’s production planning model<a class="headerlink" href="#recall-the-alice-s-production-planning-model" title="Permalink to this headline">#</a></h1>
<p>Alice owns a company that produces trophies for</p>
<ul class="simple">
<li><p>football</p></li>
<li><p>wood base, engraved plaque, brass football on top</p></li>
<li><p>€12 profit and uses 4 dm of wood</p></li>
<li><p>golf</p></li>
<li><p>wood base, engraved plaque, golf ball on top</p></li>
<li><p>€9 profit and uses 2 dm of wood</p></li>
</ul>
<p>Alice’s current stock of raw materials</p>
<ul class="simple">
<li><p>1000 footballs</p></li>
<li><p>1500 golf balls</p></li>
<li><p>1750 plaques</p></li>
<li><p>480 m (4800 dm) of wood</p></li>
</ul>
<blockquote>
<div><p>Alice wonders what the optimal production plan should be, in other words: how many football and how many golf trophies should Alice produce to maximize his profit while respecting the availability of raw materials?</p>
</div></blockquote>
<hr class="docutils" />
<p>The following model <strong>maximizes</strong> Alice’s profit by deciding the number of <span class="math notranslate nohighlight">\(x_1\)</span> football and <span class="math notranslate nohighlight">\(x_2\)</span> golf trophies to produce.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrcrcl}
\max    &amp; 12x_1 &amp; + &amp; 9x_2               \\
s.t.    &amp;   x_1 &amp;   &amp;      &amp; \leq &amp; 1000 \\
        &amp;       &amp;   &amp;  x_2 &amp; \leq &amp; 1500 \\
        &amp;   x_1 &amp; + &amp;  x_2 &amp; \leq &amp; 1750 \\
        &amp;  4x_1 &amp; + &amp; 2x_2 &amp; \leq &amp; 4800 \\
        &amp;   x_1 &amp; , &amp;  x_2 &amp; \geq &amp; 0    \\
\end{array}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trophies</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;Football&#39;</span><span class="p">,</span> <span class="s1">&#39;Golf&#39;</span> <span class="p">]</span>
<span class="n">profits</span>  <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;Football&#39;</span> <span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;Golf&#39;</span> <span class="p">:</span>  <span class="mi">9</span> <span class="p">}</span>
<span class="n">wood</span>     <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;Football&#39;</span> <span class="p">:</span>  <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Golf&#39;</span> <span class="p">:</span>  <span class="mi">2</span> <span class="p">}</span>

<span class="n">Alice</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">)</span>

<span class="n">Alice</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">trophies</span><span class="p">,</span><span class="n">within</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

<span class="n">Alice</span><span class="o">.</span><span class="n">profit</span>    <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">]),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>

<span class="n">Alice</span><span class="o">.</span><span class="n">footballs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Football&#39;</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">Alice</span><span class="o">.</span><span class="n">golfBalls</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Golf&#39;</span><span class="p">]</span>      <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
<span class="n">Alice</span><span class="o">.</span><span class="n">plaques</span>   <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>
<span class="n">Alice</span><span class="o">.</span><span class="n">wood</span>      <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">wood</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4800</span> <span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> results = cbc.solve(Alice)
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">profit</span><span class="o">.</span><span class="n">expr</span><span class="p">())</span>
<span class="nb">print</span><span class="p">([</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">])</span>

<span class="n">Alice</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 7.44 ms, sys: 6.1 ms, total: 13.5 ms
Wall time: 27.2 ms
ok optimal
17700.0
[650.0, 1100.0]
Model Alice

  Variables:
    x : Size=2, Index=x_index
        Key      : Lower : Value  : Upper : Fixed : Stale : Domain
        Football :     0 :  650.0 :  None : False : False : NonNegativeReals
            Golf :     0 : 1100.0 :  None : False : False : NonNegativeReals

  Objectives:
    profit : Size=1, Index=None, Active=True
        Key  : Active : Value
        None :   True : 17700.0

  Constraints:
    footballs : Size=1
        Key  : Lower : Body  : Upper
        None :  None : 650.0 : 1000.0
    golfBalls : Size=1
        Key  : Lower : Body   : Upper
        None :  None : 1100.0 : 1500.0
    plaques : Size=1
        Key  : Lower : Body   : Upper
        None :  None : 1750.0 : 1750.0
    wood : Size=1
        Key  : Lower : Body   : Upper
        None :  None : 4800.0 : 4800.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Alice</span><span class="o">.</span><span class="n">pprint</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1 Set Declarations
    x_index : Size=1, Index=None, Ordered=Insertion
        Key  : Dimen : Domain : Size : Members
        None :     1 :    Any :    2 : {&#39;Football&#39;, &#39;Golf&#39;}

1 Var Declarations
    x : Size=2, Index=x_index
        Key      : Lower : Value  : Upper : Fixed : Stale : Domain
        Football :     0 :  650.0 :  None : False : False : NonNegativeReals
            Golf :     0 : 1100.0 :  None : False : False : NonNegativeReals

1 Objective Declarations
    profit : Size=1, Index=None, Active=True
        Key  : Active : Sense    : Expression
        None :   True : maximize : 12*x[Football] + 9*x[Golf]

4 Constraint Declarations
    footballs : Size=1, Index=None, Active=True
        Key  : Lower : Body        : Upper  : Active
        None :  -Inf : x[Football] : 1000.0 :   True
    golfBalls : Size=1, Index=None, Active=True
        Key  : Lower : Body    : Upper  : Active
        None :  -Inf : x[Golf] : 1500.0 :   True
    plaques : Size=1, Index=None, Active=True
        Key  : Lower : Body                  : Upper  : Active
        None :  -Inf : x[Football] + x[Golf] : 1750.0 :   True
    wood : Size=1, Index=None, Active=True
        Key  : Lower : Body                      : Upper  : Active
        None :  -Inf : 4*x[Football] + 2*x[Golf] : 4800.0 :   True

7 Declarations: x_index x profit footballs golfBalls plaques wood
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ShowModelComponents</span><span class="p">(</span> <span class="n">model</span> <span class="p">):</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">component_objects</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Variable  &quot;</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        <span class="n">varobject</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">varobject</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;     &quot;</span><span class="p">,</span><span class="n">index</span><span class="p">,</span> <span class="n">varobject</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">component_objects</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Objective &quot;</span><span class="p">,</span><span class="n">o</span><span class="p">)</span>
        <span class="n">varobject</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">varobject</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span><span class="n">index</span><span class="p">,</span> <span class="n">varobject</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">component_objects</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Constraint&quot;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
        <span class="n">varobject</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">varobject</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;     &quot;</span><span class="p">,</span><span class="n">index</span><span class="p">,</span> <span class="n">varobject</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">uslack</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ShowModelComponents</span><span class="p">(</span> <span class="n">Alice</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variable   x
      Football 650.0
      Golf 1100.0
Objective  profit
     None 17700.0
Constraint footballs
      None 350.0
Constraint golfBalls
      None 400.0
Constraint plaques
      None 0.0
Constraint wood
      None 0.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ShowDuals</span><span class="p">(</span> <span class="n">model</span> <span class="p">):</span>
    <span class="kn">import</span> <span class="nn">fractions</span>
    <span class="c1"># display all duals</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Duals&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">component_objects</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Constraint &quot;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;      &quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">dual</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="n">index</span><span class="p">]])))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Alice</span><span class="o">.</span><span class="n">dual</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="o">.</span><span class="n">IMPORT</span><span class="p">)</span>

<span class="o">%</span><span class="k">time</span> results = cbc.solve(Alice)
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 19.8 ms, sys: 8.85 ms, total: 28.7 ms
Wall time: 41.2 ms
ok optimal
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ShowDuals</span><span class="p">(</span> <span class="n">Alice</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Duals
Constraint  footballs
       None 0
Constraint  golfBalls
       None 0
Constraint  plaques
       None 6
Constraint  wood
       None 3/2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">JustSolution</span><span class="p">(</span> <span class="n">model</span> <span class="p">):</span>
  <span class="k">return</span> <span class="p">[</span> <span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">profit</span><span class="p">)</span> <span class="p">]</span> <span class="o">+</span> <span class="p">[</span> <span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trophies</span> <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">JustSolution</span><span class="p">(</span> <span class="n">Alice</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17700.0, 650.0, 1100.0]
</pre></div>
</div>
</div>
</div>
<section id="betty-a-tiny-bit-of-data-science">
<h2>Betty: a tiny bit of data science…<a class="headerlink" href="#betty-a-tiny-bit-of-data-science" title="Permalink to this headline">#</a></h2>
<p>We start by simulating two samples of observed wood lengths for <code class="docutils literal notranslate"><span class="pre">f</span></code> football trophies and <code class="docutils literal notranslate"><span class="pre">g</span></code> golf trophies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2021</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">4.</span><span class="p">),</span> <span class="mf">.005</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.</span><span class="p">),</span> <span class="mf">.005</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4.02988325 4.01354309 3.99163972 ... 4.00911981 4.01641535 4.01801911]
[2.00803724 2.00844016 1.99734435 ... 2.00287521 2.00166029 1.99575931]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span> <span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.9391412319072394 4.073440566603856 1.9688647783939281 2.0337017720382375
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">f</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">g</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ef-robust-optimization_20_0.png" src="../../_images/ef-robust-optimization_20_0.png" />
</div>
</div>
<p>What is the consequence of uncertainty?
We compare the cumulative lengths with the nominal ones.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ef-robust-optimization_22_0.png" src="../../_images/ef-robust-optimization_22_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span> <span class="p">[</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">cs</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">),</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">cs</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">],</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;trouble!&#39;</span><span class="p">,</span> <span class="s1">&#39;ok&#39;</span> <span class="p">],</span> <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.1f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span> <span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ef-robust-optimization_23_0.png" src="../../_images/ef-robust-optimization_23_0.png" />
</div>
</div>
<p>A very simple and somehow naïf uncertainty region can be taken as the observed minimal box around the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span> <span class="p">)</span>
<span class="n">currentAxis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">currentAxis</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span> <span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ef-robust-optimization_25_0.png" src="../../_images/ef-robust-optimization_25_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.9391412319072394 4.073440566603856 1.9688647783939281 2.0337017720382375
</pre></div>
</div>
</div>
</div>
</section>
<section id="caroline-s-robust-model-for-box-uncertainty-in-wood-consumption">
<h2>Caroline’s robust model for box uncertainty in wood consumption<a class="headerlink" href="#caroline-s-robust-model-for-box-uncertainty-in-wood-consumption" title="Permalink to this headline">#</a></h2>
<p>Suppose now that Alice notices that not <em>exactly</em> 4 and 2 dm of wood are used, but some fluctuations are observed.
Alice wants to be <strong>sure</strong> that her model does not violate the wood constraint, therefore the following should hold:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrcrcl}
\max    &amp;  12 x_1 &amp; + &amp;   9 x_2               \\
s.t.    &amp;     x_1 &amp;   &amp;         &amp; \leq &amp; 1000 \\
        &amp;         &amp;   &amp;     x_2 &amp; \leq &amp; 1500 \\
        &amp;     x_1 &amp; + &amp;     x_2 &amp; \leq &amp; 1750 \\
        &amp; a_1 x_1 &amp; + &amp; a_2 x_2 &amp; \leq &amp; 4800 &amp; \forall \ell \leq a \leq u \\
        &amp;     x_1 &amp; , &amp;     x_2 &amp; \geq &amp; 0    \\
\end{array}
\end{split}\]</div>
<hr class="docutils" />
<p>A bit of linear duality (or even better: an introduction to robust optimization!) helps Alice how to deal with the above model that has an infinite number of constraints.
The first thing to notice is that the wood consumption is modeled by constraints that are equivalent to bounding the following optimization problem:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrr}
\max    &amp; x_1 a_1 + x_2 a_2 &amp; \leq 4800 \\
s.t.    &amp; \ell \leq a \leq u 
\end{array}
\end{split}\]</div>
<p>Or</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrr}
\max    &amp; x_1 a_1 + x_2 a_2 &amp; \leq 4800 \\
s.t.    &amp; a \leq u \\
        &amp; -a \leq -\ell 
\end{array}
\end{split}\]</div>
<p>Now we use linear duality to realize that the above is equivalent to:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrr}
\min    &amp; u y  - \ell w &amp; \leq 4800 \\
s.t.    &amp; y - w = x \\
        &amp; y \geq 0, w \geq 0
\end{array}
\end{split}\]</div>
<p>and the constraint imposed by the last problem is equivalent to:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrl}
   &amp; u y  - \ell w &amp; \leq 4800 \\
   &amp; y - w &amp; = x \\
   &amp; y \geq 0, w \geq 0
\end{array}
\end{split}\]</div>
<p>The only thing we need to do is add variables and constraints to Alice’s model.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="a-model-in-pyomo">
<h1>A model in <code class="docutils literal notranslate"><span class="pre">pyomo</span></code><a class="headerlink" href="#a-model-in-pyomo" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">AliceWithBoxUncertainty</span><span class="p">(</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span> <span class="p">):</span>

    <span class="n">Alice</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s1">&#39;AliceBox&#39;</span><span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">trophies</span><span class="p">,</span><span class="n">within</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">profit</span>    <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">]),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">footballs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Football&#39;</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">Alice</span><span class="o">.</span><span class="n">golfBalls</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Golf&#39;</span><span class="p">]</span>      <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">Alice</span><span class="o">.</span><span class="n">plaques</span>   <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">trophies</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">Alice</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">trophies</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">robustWood</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">upper</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Alice</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">lower</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Alice</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">4800</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">PerVariable</span><span class="p">(</span> <span class="n">model</span><span class="p">,</span> <span class="n">t</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> 
    
    <span class="n">Alice</span><span class="o">.</span><span class="n">perVariable</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">trophies</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">PerVariable</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Alice</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lower</span> <span class="o">=</span> <span class="n">upper</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">lower</span><span class="p">[</span><span class="s1">&#39;Football&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">upper</span><span class="p">[</span><span class="s1">&#39;Football&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">lower</span><span class="p">[</span><span class="s1">&#39;Golf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="n">upper</span><span class="p">[</span><span class="s1">&#39;Golf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

<span class="n">Alice</span> <span class="o">=</span> <span class="n">AliceWithBoxUncertainty</span><span class="p">(</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">)</span>

<span class="o">%</span><span class="k">time</span> results = cbc.solve(Alice)
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>

<span class="n">JustSolution</span><span class="p">(</span> <span class="n">Alice</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 6.64 ms, sys: 7.2 ms, total: 13.8 ms
Wall time: 30.2 ms
ok optimal
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17574.0, 608.0, 1142.0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># you can play with the amount of uncertainty. </span>
<span class="c1"># In particular, if below you make delta equal to 0 you obtain the same result als the  nominal model.</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="k">def</span> <span class="nf">AliceWithSymmetricalBoxUncertainty</span><span class="p">(</span> <span class="n">delta</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">):</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="p">{</span> <span class="n">trophy</span> <span class="p">:</span> <span class="n">wood</span><span class="p">[</span><span class="n">trophy</span><span class="p">]</span> <span class="o">-</span> <span class="n">delta</span> <span class="k">for</span> <span class="n">trophy</span> <span class="ow">in</span> <span class="n">wood</span> <span class="p">}</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="p">{</span> <span class="n">trophy</span> <span class="p">:</span> <span class="n">wood</span><span class="p">[</span><span class="n">trophy</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta</span> <span class="k">for</span> <span class="n">trophy</span> <span class="ow">in</span> <span class="n">wood</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">AliceWithBoxUncertainty</span><span class="p">(</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span> <span class="p">)</span>

<span class="n">Alice</span> <span class="o">=</span> <span class="n">AliceWithSymmetricalBoxUncertainty</span><span class="p">(</span> <span class="n">delta</span> <span class="p">)</span>
<span class="o">%</span><span class="k">time</span> results = cbc.solve(Alice)
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>

<span class="n">JustSolution</span><span class="p">(</span> <span class="n">Alice</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2.77 ms, sys: 12.3 ms, total: 15 ms
Wall time: 29.8 ms
ok optimal
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17568.0, 606.0, 1144.0]
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="integer-optimization">
<h1>Integer optimization<a class="headerlink" href="#integer-optimization" title="Permalink to this headline">#</a></h1>
<p>Alice’s model gave integer solutions, but not the robust version.
If we need integer solutions then we should impose that to the nature of the variables, which in this case of <em>box uncertainty</em> is easy to do since the model remains linear, although it will be mixed integer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Alice</span> <span class="o">=</span> <span class="n">AliceWithBoxUncertainty</span><span class="p">(</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">)</span>

<span class="o">%</span><span class="k">time</span> results = cbc.solve(Alice)
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>

<span class="n">JustSolution</span><span class="p">(</span> <span class="n">Alice</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 8.89 ms, sys: 7.04 ms, total: 15.9 ms
Wall time: 40.9 ms
ok optimal
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17574.0, 608.0, 1142.0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">.5</span><span class="p">,</span><span class="mi">21</span><span class="p">):</span>
  <span class="n">Alice</span> <span class="o">=</span> <span class="n">AliceWithSymmetricalBoxUncertainty</span><span class="p">(</span> <span class="n">delta</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">)</span>
  <span class="n">cbc</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Alice</span><span class="p">)</span>
  <span class="n">results</span> <span class="o">=</span> <span class="n">JustSolution</span><span class="p">(</span> <span class="n">Alice</span> <span class="p">)</span>
  <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">delta</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">delta</span><span class="p">,</span><span class="n">trophies</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">delta</span><span class="p">,</span><span class="n">trophies</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
      <th>Football</th>
      <th>Golf</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.000</th>
      <td>17700.0</td>
      <td>650.0</td>
      <td>1100.0</td>
    </tr>
    <tr>
      <th>0.025</th>
      <td>17634.0</td>
      <td>628.0</td>
      <td>1122.0</td>
    </tr>
    <tr>
      <th>0.050</th>
      <td>17568.0</td>
      <td>606.0</td>
      <td>1144.0</td>
    </tr>
    <tr>
      <th>0.075</th>
      <td>17502.0</td>
      <td>584.0</td>
      <td>1166.0</td>
    </tr>
    <tr>
      <th>0.100</th>
      <td>17436.0</td>
      <td>562.0</td>
      <td>1188.0</td>
    </tr>
    <tr>
      <th>0.125</th>
      <td>17370.0</td>
      <td>540.0</td>
      <td>1210.0</td>
    </tr>
    <tr>
      <th>0.150</th>
      <td>17304.0</td>
      <td>518.0</td>
      <td>1232.0</td>
    </tr>
    <tr>
      <th>0.175</th>
      <td>17238.0</td>
      <td>496.0</td>
      <td>1254.0</td>
    </tr>
    <tr>
      <th>0.200</th>
      <td>17175.0</td>
      <td>475.0</td>
      <td>1275.0</td>
    </tr>
    <tr>
      <th>0.225</th>
      <td>17109.0</td>
      <td>453.0</td>
      <td>1297.0</td>
    </tr>
    <tr>
      <th>0.250</th>
      <td>17043.0</td>
      <td>431.0</td>
      <td>1319.0</td>
    </tr>
    <tr>
      <th>0.275</th>
      <td>16977.0</td>
      <td>409.0</td>
      <td>1341.0</td>
    </tr>
    <tr>
      <th>0.300</th>
      <td>16911.0</td>
      <td>387.0</td>
      <td>1363.0</td>
    </tr>
    <tr>
      <th>0.325</th>
      <td>16845.0</td>
      <td>365.0</td>
      <td>1385.0</td>
    </tr>
    <tr>
      <th>0.350</th>
      <td>16779.0</td>
      <td>343.0</td>
      <td>1407.0</td>
    </tr>
    <tr>
      <th>0.375</th>
      <td>16713.0</td>
      <td>321.0</td>
      <td>1429.0</td>
    </tr>
    <tr>
      <th>0.400</th>
      <td>16650.0</td>
      <td>300.0</td>
      <td>1450.0</td>
    </tr>
    <tr>
      <th>0.425</th>
      <td>16584.0</td>
      <td>278.0</td>
      <td>1472.0</td>
    </tr>
    <tr>
      <th>0.450</th>
      <td>16518.0</td>
      <td>256.0</td>
      <td>1494.0</td>
    </tr>
    <tr>
      <th>0.475</th>
      <td>16416.0</td>
      <td>243.0</td>
      <td>1500.0</td>
    </tr>
    <tr>
      <th>0.500</th>
      <td>16296.0</td>
      <td>233.0</td>
      <td>1500.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f5e1957c650&gt;
</pre></div>
</div>
<img alt="../../_images/ef-robust-optimization_34_1.png" src="../../_images/ef-robust-optimization_34_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Football&#39;</span><span class="p">,</span><span class="s1">&#39;Golf&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f5e195c8590&gt;
</pre></div>
</div>
<img alt="../../_images/ef-robust-optimization_35_1.png" src="../../_images/ef-robust-optimization_35_1.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="cardinality-constrained-uncertainty">
<h1>Cardinality constrained uncertainty<a class="headerlink" href="#cardinality-constrained-uncertainty" title="Permalink to this headline">#</a></h1>
<p>Each <span class="math notranslate nohighlight">\(a_j\)</span> may deviate by at most <span class="math notranslate nohighlight">\(\pm \delta_j\)</span> from the nominal value <span class="math notranslate nohighlight">\(\bar{a}_j\)</span> bun no more than <span class="math notranslate nohighlight">\(\Gamma\)</span> will actually deviate.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrcrcl}
\max    &amp;  12 x_1 &amp; + &amp;   9 x_2               \\
s.t.    &amp;     x_1 &amp;   &amp;         &amp; \leq &amp; 1000 \\
        &amp;         &amp;   &amp;     x_2 &amp; \leq &amp; 1500 \\
        &amp;     x_1 &amp; + &amp;     x_2 &amp; \leq &amp; 1750 \\
        &amp; a_1 x_1 &amp; + &amp; a_2 x_2 &amp; \leq &amp; 4800 &amp; \forall a,y : a_j=\bar{a}_j+\delta_jy_j, \|y\|_\infty \leq 1, \|y\|_1\leq \Gamma \\
        &amp;     x_1 &amp; , &amp;     x_2 &amp; \geq &amp; 0    \\
\end{array}
\end{split}\]</div>
<p>As we have seen on the previous lecture, Lagrange duality yields the following modification to the problem as equivalent to the robust model stated above:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrcrcrcrcrcrcl}
\max    &amp;  12 x_1 &amp; + &amp;   9 x_2               \\
s.t.    &amp;     x_1 &amp;   &amp;         &amp; &amp; &amp; &amp; &amp; &amp; &amp; \leq &amp; 1000 \\
        &amp;         &amp;   &amp;     x_2 &amp; &amp; &amp; &amp; &amp; &amp; &amp; \leq &amp; 1500 \\
        &amp;     x_1 &amp; + &amp;     x_2 &amp; &amp; &amp; &amp; &amp; &amp; &amp; \leq &amp; 1750 \\
        &amp; a_1 x_1 &amp; + &amp; a_2 x_2 &amp; + &amp; \lambda\Gamma &amp; + &amp; z_1 &amp; + &amp; z_2 &amp; \leq &amp; 4800 \\
        &amp;-d_1 x_1 &amp;   &amp;         &amp; + &amp; \lambda &amp; + &amp; z_1 &amp;   &amp;     &amp; \geq &amp; 0 \\
        &amp;         &amp;   &amp;-d_2 x_2 &amp; + &amp; \lambda &amp;   &amp;     &amp; + &amp; z_2 &amp; \geq &amp; 0 \\
        &amp;     x_1 &amp; , &amp;     x_2 &amp; , &amp; \lambda &amp; , &amp; z_1 &amp; , &amp; z_2 &amp; \geq &amp; 0    \\
\end{array}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">AliceWithGammaUncertainty</span><span class="p">(</span> <span class="n">delta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span> <span class="p">):</span>
    <span class="n">Alice</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s1">&#39;AliceGamma&#39;</span><span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">trophies</span><span class="p">,</span><span class="n">within</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">profit</span>    <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">]),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">footballs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Football&#39;</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">Alice</span><span class="o">.</span><span class="n">golfBalls</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Golf&#39;</span><span class="p">]</span>      <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">Alice</span><span class="o">.</span><span class="n">plaques</span>   <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">z</span>   <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">trophies</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">Alice</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">robustWood</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span> \
     <span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">wood</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">])</span> \
          <span class="o">+</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">Alice</span><span class="o">.</span><span class="n">lam</span> \
          <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4800</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">up_rule</span><span class="p">(</span> <span class="n">model</span><span class="p">,</span> <span class="n">t</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span>  <span class="n">delta</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">lam</span>
    <span class="k">def</span> <span class="nf">down_rule</span><span class="p">(</span> <span class="n">model</span><span class="p">,</span> <span class="n">t</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">delta</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">lam</span>
    
    <span class="n">Alice</span><span class="o">.</span><span class="n">up</span>   <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">trophies</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">up_rule</span><span class="p">)</span>
    <span class="n">Alice</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">trophies</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">down_rule</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Alice</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Alice</span> <span class="o">=</span> <span class="n">AliceWithGammaUncertainty</span><span class="p">(</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">)</span>

<span class="o">%</span><span class="k">time</span> results = cbc.solve(Alice)
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="n">JustSolution</span><span class="p">(</span><span class="n">Alice</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 8.1 ms, sys: 7.25 ms, total: 15.4 ms
Wall time: 34.7 ms
ok optimal
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17673.0, 641.0, 1109.0]
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="ball-uncertainty">
<h1>Ball uncertainty<a class="headerlink" href="#ball-uncertainty" title="Permalink to this headline">#</a></h1>
<p>As <a class="reference external" href="https://pyomo.readthedocs.io/en/stable/library_reference/kernel/conic.html">the documentation</a> says a conic constraint is expressed in ‘pyomo’ in simple variables.</p>
<p>This <a class="reference external" href="https://pyomo.readthedocs.io/en/stable/library_reference/kernel/syntax_comparison.html">table</a> is very useful.</p>
<p>A straightforward remodulation leads to that:</p>
<div class="math notranslate nohighlight">
\[ 
  a_1x_1+a_2x_2 + \Omega \|x\| \leq 4800
\]</div>
<div class="math notranslate nohighlight">
\[
  \Omega \|x\| \leq 4800 - a_1x_1 - a_2x_2
\]</div>
<div class="math notranslate nohighlight">
\[
  \|\Omega x\| \leq 4800 - a_1x_1 - a_2x_2
\]</div>
<p>By defining <span class="math notranslate nohighlight">\(y = 4800 - a_1x_1 - a_2x_2\)</span> we may write:
$<span class="math notranslate nohighlight">\(
  \Omega^2 \|x\|^2 \leq y^2
\)</span>$</p>
<div class="math notranslate nohighlight">
\[
  (\Omega x_1)^2 + (\Omega x_2)^2 \leq y^2
\]</div>
<div class="math notranslate nohighlight">
\[
  \|w\|^2 \leq y^2
\]</div>
<p>with <span class="math notranslate nohighlight">\(w = \Omega x\)</span>.</p>
<section id="documentation-says-that-we-need-to-use-the-kernel-now">
<h2>Documentation says that we need to use the kernel now<a class="headerlink" href="#documentation-says-that-we-need-to-use-the-kernel-now" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.kernel</span> <span class="k">as</span> <span class="nn">pyk</span>

<span class="k">def</span> <span class="nf">AliceWithBallUncertainty</span><span class="p">(</span> <span class="n">omega</span><span class="p">,</span> <span class="n">domain_type</span><span class="o">=</span><span class="n">pyk</span><span class="o">.</span><span class="n">RealSet</span> <span class="p">):</span>
    
    <span class="n">idxTrophies</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">trophies</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="n">Alice</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">block</span><span class="p">()</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable_list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxTrophies</span><span class="p">:</span>
        <span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">domain_type</span><span class="o">=</span><span class="n">domain_type</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="n">Alice</span><span class="o">.</span><span class="n">profit</span>    <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">profits</span><span class="p">[</span><span class="n">trophies</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxTrophies</span><span class="p">),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyk</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">footballs</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">Alice</span><span class="o">.</span><span class="n">golfBalls</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">Alice</span><span class="o">.</span><span class="n">plaques</span>   <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxTrophies</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Alice</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable_list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxTrophies</span><span class="p">:</span>
        <span class="n">Alice</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>

    <span class="n">Alice</span><span class="o">.</span><span class="n">wood</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">4800</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">wood</span><span class="p">[</span><span class="n">trophies</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxTrophies</span><span class="p">)</span> <span class="p">)</span> 

    <span class="n">Alice</span><span class="o">.</span><span class="n">xtow</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint_list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxTrophies</span><span class="p">:</span>
        <span class="n">Alice</span><span class="o">.</span><span class="n">xtow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>

    <span class="kn">from</span> <span class="nn">pyomo.core.kernel.conic</span> <span class="kn">import</span> <span class="n">quadratic</span>
    <span class="n">Alice</span><span class="o">.</span><span class="n">robust</span> <span class="o">=</span> <span class="n">quadratic</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">Alice</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Alice</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="now-the-problem-is-nonlinear">
<h2>Now the problem is nonlinear<a class="headerlink" href="#now-the-problem-is-nonlinear" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Alice</span> <span class="o">=</span> <span class="n">AliceWithBallUncertainty</span><span class="p">(</span> <span class="mf">0.1</span> <span class="p">)</span>

<span class="o">%</span><span class="k">time</span> results = ipopt.solve(Alice)
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">profit</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span> <span class="p">[</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">))]</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 7.34 ms, sys: 6.25 ms, total: 13.6 ms
Wall time: 30.8 ms
ok optimal
17504.443278691946
[584.814373731946, 1165.1856437676215]
</pre></div>
</div>
</div>
</div>
</section>
<section id="but-cplex-gurobi-and-xpress-support-second-order-cones">
<h2>But <code class="docutils literal notranslate"><span class="pre">cplex</span></code>, <code class="docutils literal notranslate"><span class="pre">gurobi</span></code> and <code class="docutils literal notranslate"><span class="pre">xpress</span></code> support second order cones<a class="headerlink" href="#but-cplex-gurobi-and-xpress-support-second-order-cones" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conicsolver</span> <span class="o">=</span> <span class="n">gurobi</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> results = conicsolver.solve(Alice)
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">profit</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span> <span class="p">[</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">))]</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 6.56 ms, sys: 919 µs, total: 7.48 ms
Wall time: 8.23 ms
ok optimal
17504.443176720328
[584.8143922330063, 1165.1856077693617]
</pre></div>
</div>
</div>
</div>
</section>
<section id="and-therefore-we-can-also-have-mixed-integer-models">
<h2>And therefore we can also have mixed integer models<a class="headerlink" href="#and-therefore-we-can-also-have-mixed-integer-models" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Alice</span> <span class="o">=</span> <span class="n">AliceWithBallUncertainty</span><span class="p">(</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">domain_type</span><span class="o">=</span><span class="n">pyk</span><span class="o">.</span><span class="n">IntegerSet</span> <span class="p">)</span>

<span class="o">%</span><span class="k">time</span> results = conicsolver.solve(Alice)
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">profit</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span> <span class="p">[</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">))]</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 4.97 ms, sys: 1 ms, total: 5.97 ms
Wall time: 6.47 ms
ok optimal
17502.0
[584.0, 1166.0]
</pre></div>
</div>
</div>
</div>
</section>
<section id="final-note-maybe-useful-to-recall-that-in-python-you-can-always-ask-for-help">
<h2>Final note: maybe useful to recall that in python you can always ask for help…<a class="headerlink" href="#final-note-maybe-useful-to-recall-that-in-python-you-can-always-ask-for-help" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on variable in module pyomo.core.kernel.variable object:

class variable(IVariable)
 |  variable(domain_type=None, domain=None, lb=None, ub=None, value=None, fixed=False)
 |  
 |  A decision variable
 |  
 |  Decision variables are used in objectives and
 |  constraints to define an optimization problem.
 |  
 |  Args:
 |      domain_type: Sets the domain type of the
 |          variable. Must be one of :const:`RealSet` or
 |          :const:`IntegerSet`. Can be updated later by
 |          assigning to the :attr:`domain_type`
 |          property. The default value of :const:`None` is
 |          equivalent to :const:`RealSet`, unless the
 |          :attr:`domain` keyword is used.
 |      domain: Sets the domain of the variable. This
 |          updates the :attr:`domain_type`, :attr:`lb`, and
 |          :attr:`ub` properties of the variable. The
 |          default value of :const:`None` implies that this
 |          keyword is ignored. This keyword can not be used
 |          in combination with the :attr:`domain_type`
 |          keyword.
 |      lb: Sets the lower bound of the variable. Can be
 |          updated later by assigning to the :attr:`lb`
 |          property on the variable. Default is
 |          :const:`None`, which is equivalent to
 |          :const:`-inf`.
 |      ub: Sets the upper bound of the variable. Can be
 |          updated later by assigning to the :attr:`ub`
 |          property on the variable. Default is
 |          :const:`None`, which is equivalent to
 |          :const:`+inf`.
 |      value: Sets the value of the variable. Can be
 |          updated later by assigning to the :attr:`value`
 |          property on the variable. Default is
 |          :const:`None`.
 |      fixed (bool): Sets the fixed status of the
 |          variable. Can be updated later by assigning to
 |          the :attr:`fixed` property or by calling the
 |          :meth:`fix` method. Default is :const:`False`.
 |  
 |  Examples:
 |      &gt;&gt;&gt; import pyomo.kernel as pmo
 |      &gt;&gt;&gt; # A continuous variable with infinite bounds
 |      &gt;&gt;&gt; x = pmo.variable()
 |      &gt;&gt;&gt; # A binary variable
 |      &gt;&gt;&gt; x = pmo.variable(domain=pmo.Binary)
 |      &gt;&gt;&gt; # Also a binary variable
 |      &gt;&gt;&gt; x = pmo.variable(domain_type=pmo.IntegerSet, lb=0, ub=1)
 |  
 |  Method resolution order:
 |      variable
 |      IVariable
 |      pyomo.core.kernel.base.ICategorizedObject
 |      pyomo.core.expr.numvalue.NumericValue
 |      pyomo.core.pyomoobject.PyomoObject
 |      builtins.object
 |  
 |  Methods defined here:
 |  
 |  __init__(self, domain_type=None, domain=None, lb=None, ub=None, value=None, fixed=False)
 |      Initialize self.  See help(type(self)) for accurate signature.
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors defined here:
 |  
 |  __weakref__
 |      list of weak references to the object (if defined)
 |  
 |  domain
 |      Set the domain of the variable. This method
 |      updates the :attr:`domain_type` property and
 |      overwrites the :attr:`lb` and :attr:`ub` properties
 |      with the domain bounds.
 |  
 |  domain_type
 |      The domain type of the variable (:class:`RealSet`
 |      or :class:`IntegerSet`)
 |  
 |  fixed
 |      The fixed status of the variable
 |  
 |  lb
 |      The lower bound of the variable
 |  
 |  stale
 |      The stale status of the variable
 |  
 |  ub
 |      The upper bound of the variable
 |  
 |  value
 |      The value of the variable
 |  
 |  ----------------------------------------------------------------------
 |  Methods inherited from IVariable:
 |  
 |  __call__(self, exception=True)
 |      Return the value of this variable.
 |  
 |  fix(self, value=pyomo.common.modeling.NOTSET)
 |      Fix the variable. Sets the fixed indicator to
 |      :const:`True`. An optional value argument will
 |      update the variable&#39;s value before fixing.
 |  
 |  free = unfix(self)
 |  
 |  has_lb(self)
 |      Returns :const:`False` when the lower bound is
 |      :const:`None` or negative infinity
 |  
 |  has_ub(self)
 |      Returns :const:`False` when the upper bound is
 |      :const:`None` or positive infinity
 |  
 |  is_binary(self)
 |      Returns :const:`True` when the domain type is
 |      :class:`IntegerSet` and the bounds are within
 |      [0,1].
 |  
 |  is_constant(self)
 |      Returns :const:`False` because this is not a
 |      constant in an expression.
 |  
 |  is_continuous(self)
 |      Returns :const:`True` when the domain type is
 |      :class:`RealSet`.
 |  
 |  is_discrete(self)
 |      Returns :const:`True` when the domain type is
 |      :class:`IntegerSet`.
 |  
 |  is_fixed(self)
 |      Returns :const:`True` if this variable is fixed,
 |      otherwise returns :const:`False`.
 |  
 |  is_integer(self)
 |      Returns :const:`True` when the domain type is
 |      :class:`IntegerSet`.
 |  
 |  is_parameter_type(self)
 |      Returns :const:`False` because this is not a
 |      parameter object.
 |  
 |  is_potentially_variable(self)
 |      Returns :const:`True` because this is a
 |      variable.
 |  
 |  is_variable_type(self)
 |      Returns :const:`True` because this is a
 |      variable object.
 |  
 |  polynomial_degree(self)
 |      Return the polynomial degree of this
 |      expression
 |  
 |  unfix(self)
 |      Free the variable. Sets the fixed indicator to
 |      :const:`False`.
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors inherited from IVariable:
 |  
 |  bounds
 |      Get/Set the bounds as a tuple (lb, ub).
 |  
 |  lslack
 |      Lower slack (value - lb). Returns :const:`None` if
 |      the variable value is :const:`None`.
 |  
 |  slack
 |      min(lslack, uslack). Returns :const:`None` if
 |      the variable value is :const:`None`.
 |  
 |  uslack
 |      Upper slack (ub - value). Returns :const:`None` if
 |      the variable value is :const:`None`.
 |  
 |  ----------------------------------------------------------------------
 |  Methods inherited from pyomo.core.kernel.base.ICategorizedObject:
 |  
 |  __deepcopy__(self, memo)
 |  
 |  __getstate__(self)
 |  
 |  __setstate__(self, state)
 |  
 |  __str__(self)
 |      Convert this object to a string by first
 |      attempting to generate its fully qualified name. If
 |      the object does not have a name (because it does not
 |      have a parent, then a string containing the class
 |      name is returned.
 |  
 |  activate(self)
 |      Activate this object.
 |  
 |  clone(self)
 |      Returns a copy of this object with the parent
 |      pointer set to :const:`None`.
 |      
 |      A clone is almost equivalent to deepcopy except that
 |      any categorized objects encountered that are not
 |      descendents of this object will reference the same
 |      object on the clone.
 |  
 |  deactivate(self)
 |      Deactivate this object.
 |  
 |  getname(self, fully_qualified=False, name_buffer={}, convert=&lt;class &#39;str&#39;&gt;, relative_to=None)
 |      Dynamically generates a name for this object.
 |      
 |      Args:
 |          fully_qualified (bool): Generate a full name by
 |              iterating through all anscestor containers.
 |              Default is :const:`False`.
 |          convert (function): A function that converts a
 |              storage key into a string
 |              representation. Default is the built-in
 |              function str.
 |          relative_to (object): When generating a fully
 |              qualified name, generate the name relative
 |              to this block.
 |      
 |      Returns:
 |          If a parent exists, this method returns a string
 |          representing the name of the object in the
 |          context of its parent; otherwise (if no parent
 |          exists), this method returns :const:`None`.
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors inherited from pyomo.core.kernel.base.ICategorizedObject:
 |  
 |  active
 |      The active status of this object.
 |  
 |  ctype
 |      The object&#39;s category type.
 |  
 |  local_name
 |      The object&#39;s local name within the context of its
 |      parent. Alias for
 |      `obj.getname(fully_qualified=False)`.
 |  
 |  name
 |      The object&#39;s fully qualified name. Alias for
 |      `obj.getname(fully_qualified=True)`.
 |  
 |  parent
 |      The object&#39;s parent (possibly None).
 |  
 |  storage_key
 |      The object&#39;s storage key within its parent
 |  
 |  ----------------------------------------------------------------------
 |  Methods inherited from pyomo.core.expr.numvalue.NumericValue:
 |  
 |  __abs__(self)
 |      Absolute value
 |      
 |      This method is called when Python processes the statement::
 |      
 |          abs(self)
 |  
 |  __add__(self, other)
 |      Binary addition
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self + other
 |  
 |  __array_ufunc__(self, ufunc, method, *inputs, **kwargs)
 |  
 |  __div__(self, other)
 |      Binary division
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self / other
 |  
 |  __eq__(self, other)
 |      Equal to operator
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self == other
 |  
 |  __float__(self)
 |      Coerce the value to a floating point
 |      
 |      Raises:
 |          TypeError
 |  
 |  __ge__(self, other)
 |      Greater than or equal operator
 |      
 |      This method is called when Python processes statements of the form::
 |      
 |          self &gt;= other
 |          other &lt;= self
 |  
 |  __gt__(self, other)
 |      Greater than operator
 |      
 |      This method is called when Python processes statements of the form::
 |      
 |          self &gt; other
 |          other &lt; self
 |  
 |  __iadd__(self, other)
 |      Binary addition
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self += other
 |  
 |  __idiv__(self, other)
 |      Binary division
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self /= other
 |  
 |  __imul__(self, other)
 |      Binary multiplication
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self *= other
 |  
 |  __int__(self)
 |      Coerce the value to an integer
 |      
 |      Raises:
 |          TypeError
 |  
 |  __ipow__(self, other)
 |      Binary power
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self **= other
 |  
 |  __isub__(self, other)
 |      Binary subtraction
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self -= other
 |  
 |  __itruediv__(self, other)
 |      Binary division (when __future__.division is in effect)
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self /= other
 |  
 |  __le__(self, other)
 |      Less than or equal operator
 |      
 |      This method is called when Python processes statements of the form::
 |      
 |          self &lt;= other
 |          other &gt;= self
 |  
 |  __lt__(self, other)
 |      Less than operator
 |      
 |      This method is called when Python processes statements of the form::
 |      
 |          self &lt; other
 |          other &gt; self
 |  
 |  __mul__(self, other)
 |      Binary multiplication
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self * other
 |  
 |  __neg__(self)
 |      Negation
 |      
 |      This method is called when Python processes the statement::
 |      
 |          - self
 |  
 |  __pos__(self)
 |      Positive expression
 |      
 |      This method is called when Python processes the statement::
 |      
 |          + self
 |  
 |  __pow__(self, other)
 |      Binary power
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self ** other
 |  
 |  __radd__(self, other)
 |      Binary addition
 |      
 |      This method is called when Python processes the statement::
 |      
 |          other + self
 |  
 |  __rdiv__(self, other)
 |      Binary division
 |      
 |      This method is called when Python processes the statement::
 |      
 |          other / self
 |  
 |  __rmul__(self, other)
 |      Binary multiplication
 |      
 |      This method is called when Python processes the statement::
 |      
 |          other * self
 |      
 |      when other is not a :class:`NumericValue &lt;pyomo.core.expr.numvalue.NumericValue&gt;` object.
 |  
 |  __rpow__(self, other)
 |      Binary power
 |      
 |      This method is called when Python processes the statement::
 |      
 |          other ** self
 |  
 |  __rsub__(self, other)
 |      Binary subtraction
 |      
 |      This method is called when Python processes the statement::
 |      
 |          other - self
 |  
 |  __rtruediv__(self, other)
 |      Binary division (when __future__.division is in effect)
 |      
 |      This method is called when Python processes the statement::
 |      
 |          other / self
 |  
 |  __sub__(self, other)
 |      Binary subtraction
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self - other
 |  
 |  __truediv__(self, other)
 |      Binary division (when __future__.division is in effect)
 |      
 |      This method is called when Python processes the statement::
 |      
 |          self / other
 |  
 |  cname(self, *args, **kwds)
 |      DEPRECATED.
 |      
 |      .. deprecated:: 5.0
 |         The cname() method has been renamed to getname().
 |  
 |  is_indexed(self)
 |      Return True if this numeric value is an indexed object
 |  
 |  is_numeric_type(self)
 |      Return True if this class is a Pyomo numeric object
 |  
 |  is_relational(self)
 |      Return True if this numeric value represents a relational expression.
 |  
 |  to_string(self, verbose=None, labeler=None, smap=None, compute_values=False)
 |      Return a string representation of the expression tree.
 |      
 |      Args:
 |          verbose (bool): If :const:`True`, then the the string 
 |              representation consists of nested functions.  Otherwise,
 |              the string representation is an algebraic equation.
 |              Defaults to :const:`False`.
 |          labeler: An object that generates string labels for 
 |              variables in the expression tree.  Defaults to :const:`None`.
 |      
 |      Returns:
 |          A string representation for the expression tree.
 |  
 |  ----------------------------------------------------------------------
 |  Data and other attributes inherited from pyomo.core.expr.numvalue.NumericValue:
 |  
 |  __hash__ = None
 |  
 |  ----------------------------------------------------------------------
 |  Methods inherited from pyomo.core.pyomoobject.PyomoObject:
 |  
 |  is_component_type(self)
 |      Return True if this class is a Pyomo component
 |  
 |  is_expression_type(self)
 |      Return True if this numeric value is an expression
 |  
 |  is_logical_type(self)
 |      Return True if this class is a Pyomo Boolean value, variable, or expression.
 |  
 |  is_named_expression_type(self)
 |      Return True if this numeric value is a named expression
 |  
 |  is_reference(self)
 |      Return True if this object is a reference.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">robust</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on quadratic in module pyomo.core.kernel.conic object:

class quadratic(_ConicBase)
 |  quadratic(r, x)
 |  
 |  A quadratic conic constraint of the form:
 |  
 |      x[0]^2 + ... + x[n-1]^2 &lt;= r^2,
 |  
 |  which is recognized as convex for r &gt;= 0.
 |  
 |  Parameters
 |  ----------
 |  r : :class:`variable`
 |      A variable.
 |  x : list[:class:`variable`]
 |      An iterable of variables.
 |  
 |  Method resolution order:
 |      quadratic
 |      _ConicBase
 |      pyomo.core.kernel.constraint.IConstraint
 |      pyomo.core.kernel.base.ICategorizedObject
 |      builtins.object
 |  
 |  Methods defined here:
 |  
 |  __init__(self, r, x)
 |      Initialize self.  See help(type(self)) for accurate signature.
 |  
 |  check_convexity_conditions(self, relax=False)
 |      Returns True if all convexity conditions for the
 |      conic constraint are satisfied. If relax is True,
 |      then variable domains are ignored and it is assumed
 |      that all variables are continuous.
 |  
 |  ----------------------------------------------------------------------
 |  Class methods defined here:
 |  
 |  as_domain(r, x) from builtins.type
 |      Builds a conic domain. Input arguments take the
 |      same form as those of the conic constraint, but in
 |      place of each variable, one can optionally supply a
 |      constant, linear expression, or None.
 |      
 |      Returns
 |      -------
 |      block
 |          A block object with the core conic constraint
 |          (block.q) expressed using auxiliary variables
 |          (block.r, block.x) linked to the input arguments
 |          through auxiliary constraints (block.c).
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors defined here:
 |  
 |  __weakref__
 |      list of weak references to the object (if defined)
 |  
 |  r
 |  
 |  x
 |  
 |  ----------------------------------------------------------------------
 |  Methods inherited from _ConicBase:
 |  
 |  __call__(self, exception=True)
 |      Compute the value of the body of this constraint.
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors inherited from _ConicBase:
 |  
 |  body
 |      The body of the constraint
 |  
 |  equality
 |      A boolean indicating whether this is an equality constraint
 |  
 |  lb
 |      The lower bound of the constraint
 |  
 |  rhs
 |      The right-hand side of the constraint
 |  
 |  ub
 |      The upper bound of the constraint
 |  
 |  ----------------------------------------------------------------------
 |  Methods inherited from pyomo.core.kernel.constraint.IConstraint:
 |  
 |  has_lb(self)
 |      Returns :const:`False` when the lower bound is
 |      :const:`None` or negative infinity
 |  
 |  has_ub(self)
 |      Returns :const:`False` when the upper bound is
 |      :const:`None` or positive infinity
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors inherited from pyomo.core.kernel.constraint.IConstraint:
 |  
 |  bounds
 |      The bounds of the constraint as a tuple (lb, ub)
 |  
 |  expr
 |      Get the expression on this constraint.
 |  
 |  lower
 |  
 |  lslack
 |      Lower slack (body - lb). Returns :const:`None` if
 |      a value for the body can not be computed.
 |  
 |  slack
 |      min(lslack, uslack). Returns :const:`None` if a
 |      value for the body can not be computed.
 |  
 |  upper
 |  
 |  uslack
 |      Upper slack (ub - body). Returns :const:`None` if
 |      a value for the body can not be computed.
 |  
 |  ----------------------------------------------------------------------
 |  Methods inherited from pyomo.core.kernel.base.ICategorizedObject:
 |  
 |  __deepcopy__(self, memo)
 |  
 |  __getstate__(self)
 |  
 |  __setstate__(self, state)
 |  
 |  __str__(self)
 |      Convert this object to a string by first
 |      attempting to generate its fully qualified name. If
 |      the object does not have a name (because it does not
 |      have a parent, then a string containing the class
 |      name is returned.
 |  
 |  activate(self)
 |      Activate this object.
 |  
 |  clone(self)
 |      Returns a copy of this object with the parent
 |      pointer set to :const:`None`.
 |      
 |      A clone is almost equivalent to deepcopy except that
 |      any categorized objects encountered that are not
 |      descendents of this object will reference the same
 |      object on the clone.
 |  
 |  deactivate(self)
 |      Deactivate this object.
 |  
 |  getname(self, fully_qualified=False, name_buffer={}, convert=&lt;class &#39;str&#39;&gt;, relative_to=None)
 |      Dynamically generates a name for this object.
 |      
 |      Args:
 |          fully_qualified (bool): Generate a full name by
 |              iterating through all anscestor containers.
 |              Default is :const:`False`.
 |          convert (function): A function that converts a
 |              storage key into a string
 |              representation. Default is the built-in
 |              function str.
 |          relative_to (object): When generating a fully
 |              qualified name, generate the name relative
 |              to this block.
 |      
 |      Returns:
 |          If a parent exists, this method returns a string
 |          representing the name of the object in the
 |          context of its parent; otherwise (if no parent
 |          exists), this method returns :const:`None`.
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors inherited from pyomo.core.kernel.base.ICategorizedObject:
 |  
 |  active
 |      The active status of this object.
 |  
 |  ctype
 |      The object&#39;s category type.
 |  
 |  local_name
 |      The object&#39;s local name within the context of its
 |      parent. Alias for
 |      `obj.getname(fully_qualified=False)`.
 |  
 |  name
 |      The object&#39;s fully qualified name. Alias for
 |      `obj.getname(fully_qualified=True)`.
 |  
 |  parent
 |      The object&#39;s parent (possibly None).
 |  
 |  storage_key
 |      The object&#39;s storage key within its parent
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="how-to-bring-second-order-cones-into-the-pyomo-environ">
<h1>How to bring second order cones into the <code class="docutils literal notranslate"><span class="pre">pyomo.environ</span></code><a class="headerlink" href="#how-to-bring-second-order-cones-into-the-pyomo-environ" title="Permalink to this headline">#</a></h1>
<p>Noting that <span class="math notranslate nohighlight">\(\| x \| \leq t\)</span> is for <span class="math notranslate nohighlight">\(t \geq 0\)</span> equivalent to <span class="math notranslate nohighlight">\(\| x \|^2 \leq t^2\)</span> and knowing that the commercial solvers (<code class="docutils literal notranslate"><span class="pre">gurobi</span></code>, <code class="docutils literal notranslate"><span class="pre">cplex</span></code> and <code class="docutils literal notranslate"><span class="pre">express</span></code>) support convex quadratic inequalities, we can model this variant in <code class="docutils literal notranslate"><span class="pre">pyomo.environ</span></code> as follows.</p>
<p>Note that the essential part to make the model convex is having the rght hand side nonnegative.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">AliceWithBallUncertaintyAsSquaredSecondOrderCone</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">):</span>
  <span class="n">Alice</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">)</span>

  <span class="n">Alice</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">trophies</span><span class="p">,</span><span class="n">within</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

  <span class="c1"># the nonegativity of this variable is essential!</span>
  <span class="n">Alice</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">within</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

  <span class="n">Alice</span><span class="o">.</span><span class="n">profit</span>    <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">]),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>

  <span class="n">Alice</span><span class="o">.</span><span class="n">footballs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Football&#39;</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
  <span class="n">Alice</span><span class="o">.</span><span class="n">golfBalls</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Golf&#39;</span><span class="p">]</span>      <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
  <span class="n">Alice</span><span class="o">.</span><span class="n">plaques</span>   <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>
  <span class="n">Alice</span><span class="o">.</span><span class="n">wood</span>      <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">4800</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">wood</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">)</span> <span class="p">)</span> 
  <span class="n">Alice</span><span class="o">.</span><span class="n">robust</span>    <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">omega</span><span class="o">*</span><span class="n">Alice</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trophies</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">Alice</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
  <span class="k">return</span> <span class="n">Alice</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Alice</span> <span class="o">=</span> <span class="n">AliceWithBallUncertaintyAsSquaredSecondOrderCone</span><span class="p">(</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">)</span>

<span class="o">%</span><span class="k">time</span> results = cplex.solve(Alice)
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="n">JustSolution</span><span class="p">(</span><span class="n">Alice</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 7.48 ms, sys: 1.94 ms, total: 9.42 ms
Wall time: 9.67 ms
ok optimal
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17502.0, 584.0, 1166.0]
</pre></div>
</div>
</div>
</div>
<p>Note how the verbose <code class="docutils literal notranslate"><span class="pre">xpress</span></code> solver confirms that the convex quadratic constraint is recognized as conic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Alice</span> <span class="o">=</span> <span class="n">AliceWithBallUncertaintyAsSquaredSecondOrderCone</span><span class="p">(</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">)</span>

<span class="o">%</span><span class="k">time</span> results = xpress.solve(Alice,tee=True)
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="n">JustSolution</span><span class="p">(</span><span class="n">Alice</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FICO Xpress v8.12.3, Community, solve started 13:48:08, Oct 5, 2021
Heap usage: 339KB (peak 339KB, 428KB system)
Maximizing MIQCQP Alice with these control settings:
OUTPUTLOG = 1
Original problem has:
         5 rows            3 cols            7 elements         2 globals
         1 qrows           3 qrowelem
Converted 1 second order cones to standard form
Presolved problem has:
         7 rows            7 cols           12 elements         2 globals
         2 cones           4 celems
LP relaxation tightened
Presolve finished in 0 seconds
Heap usage: 369KB (peak 387KB, 430KB system)

Coefficient range                    original                 solved        
  Coefficients   [min,max] : [ 1.00e+00,  4.00e+00] / [ 1.00e-01,  1.00e+00]
  RHS and bounds [min,max] : [ 1.00e+03,  4.80e+03] / [ 1.00e+02,  4.80e+03]
  Objective      [min,max] : [ 9.00e+00,  1.20e+01] / [ 9.00e+00,  1.20e+01]
  Quadratic      [min,max] : [ 2.00e-02,  2.00e+00] / [ 2.00e+00,  2.00e+00]
Autoscaling applied standard scaling

Will try to keep branch and bound tree memory usage below 11.4GB
Barrier cache sizes : L1=32K L2=56320K
Using AVX support
Cores per CPU (CORESPERCPU): 2
Barrier starts after 0 seconds, using up to 2 threads, 1 cores
Matrix ordering - Dense cols.:      6   NZ(L):        65   Flops:          204
 
  Its   P.inf      D.inf      U.inf      Primal obj.     Dual obj.      Compl.
   0   1.75e+03   1.20e+01   4.80e+03   2.1000000e+01   1.7150000e+04   2.1e+01
   1   4.73e+02   3.25e+00   1.30e+03   3.7148331e+01   1.7130804e+04   6.2e+00
   2   3.48e+01   2.39e-01   9.56e+01   3.7906861e+02   1.6712679e+04   4.7e-01
   3   1.82e+00   1.25e-02   4.99e+00   5.1718692e+03   1.2952061e+04   2.5e-02
   4   5.17e-01   3.55e-03   1.42e+00   1.4287413e+04   1.6854657e+04   8.0e-03
   5   9.09e-02   6.24e-04   2.50e-01   1.6927027e+04   1.7374898e+04   1.7e-03
   6   7.22e-02   4.96e-04   1.98e-01   1.7031042e+04   1.7374638e+04   1.4e-03
   7   1.84e-02   1.27e-04   5.06e-02   1.7399322e+04   1.7483081e+04   3.7e-04
   8   8.88e-03   6.10e-05   2.44e-02   1.7455817e+04   1.7494083e+04   1.9e-04
   9   3.91e-03   2.69e-05   1.07e-02   1.7483553e+04   1.7500381e+04   8.4e-05
  10   3.27e-03   2.25e-05   8.99e-03   1.7487593e+04   1.7501220e+04   7.2e-05
  11   1.83e-03   1.26e-05   5.03e-03   1.7495119e+04   1.7502724e+04   4.0e-05
  12   1.16e-03   7.94e-06   3.17e-03   1.7498613e+04   1.7503341e+04   2.6e-05
  13   3.73e-04   2.56e-06   1.02e-03   1.7502500e+04   1.7504010e+04   8.5e-06
  14   7.67e-06   5.27e-08   2.11e-05   1.7504405e+04   1.7504436e+04   1.7e-07
  15   1.60e-06   1.10e-08   4.40e-06   1.7504435e+04   1.7504441e+04   3.6e-08
  16   2.38e-07   1.64e-09   6.54e-07   1.7504442e+04   1.7504443e+04   5.4e-09
Barrier method finished in 0 seconds
Crossover starts
 
   Its         Obj Value      S   Ninf  Nneg        Sum Inf  Time
     6       17504.44338      P      0     0        .000000     0
     0       17504.44338      N      0     0        .000000     0
     1       17504.44338      D      0     0        .000000     0
Crossover successful
Objective function value:  17504.44318 time: 0
     0       17504.44318      P      0     0        .000000     0
Optimal solution found
Barrier solved problem
  16 barrier and 7 simplex iterations in 0.01 seconds at time 0

Final objective                       : 1.750444317729157e+04
  Max primal violation      (abs/rel) :       0.0 /       0.0
  Max dual violation        (abs/rel) :       0.0 /       0.0
  Max complementarity viol. (abs/rel) :       0.0 /       0.0

Starting root cutting &amp; heuristics
 
 Its Type    BestSoln    BestBound   Sols    Add    Del     Gap     GInf   Time
k         12000.00000  17504.44318      1                 31.45%       0      0
c         12009.00000  17504.44318      2                 31.39%       0      0
d         12018.00000  17504.44318      3                 31.34%       0      0
k         17502.00000  17502.00000      4                  0.00%       0      0
 *** Search completed ***
Uncrunching matrix
Final MIP objective                   : 1.750200000000000e+04
Final MIP bound                       : 1.750200000000000e+04
  Solution time / primaldual integral :         0s/ 80.727955%
  Number of solutions found / nodes   :         4 /         1
  Max primal violation      (abs/rel) :       0.0 /       0.0
  Max integer violation     (abs    ) :       0.0
CPU times: user 25 ms, sys: 6.94 ms, total: 32 ms
Wall time: 33 ms
ok optimal
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[17502.0, 584.0, 1166.0]
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/08"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="08.00.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">8. Robust Optimization - Single Stage Problems</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../09/09.00.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">9. Stochastic Optimization - Single Stage Problems</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The MO Book Group<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>