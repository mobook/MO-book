
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Robust BIM microchip production problem &#8212; Companion code for the book &#34;Hands-On Optimization with Python&#34;</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="9. Stochastic Optimization - Single Stage Problems" href="../09/09.00.html" />
    <link rel="prev" title="8. Robust Optimization - Single Stage Problems" href="08.00.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DVQ7NZ8CYZ"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-DVQ7NZ8CYZ');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo-02.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Companion code for the book "Hands-On Optimization with Python"</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Hands-On Optimization with Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/01.00.html">
   1. Mathematical Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/production-planning.html">
     A first production planning problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/production-planning-basic.html">
     A basic Pyomo model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/production-planning-advanced.html">
     A data-driven Pyomo Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/02.00.html">
   2. Linear Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim.html">
     BIM production
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/lad-regression.html">
     Least Absolute Deviation (LAD) Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/mad-portfolio-optimization.html">
     Mean Absolute Deviation (MAD) portfolio optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-dual.html">
     Dual of the BIM production problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-maxmin.html">
     BIM production for worst case
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-fractional.html">
     BIM production variants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-rawmaterialplanning.html">
     BIM production using demand forecasts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/L1-regression-wine-quality.html">
     Extra material: Wine quality prediction with
     <span class="math notranslate nohighlight">
      \(L_1\)
     </span>
     regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/multiproductionfaciliity_worstcase.html">
     Extra material: Multi-product facility production
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/03.00.html">
   3. Mixed Integer Linear Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-perturbed.html">
     BIM production with perturbed data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/shift-scheduling.html">
     Workforce shift scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/recharging-electric-vehicle.html">
     Recharging strategy for an electric vehicle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/simple-production-model-gdp.html">
     Production model using disjunctions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/machine-scheduling.html">
     Machine Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-production-revisited.html">
     BIM production revisited
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/cryptarithms.html">
     Extra material: Cryptarithms puzzle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/strip-packing.html">
     Extra material: Strip packing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/job-shop-scheduling.html">
     Extra material: Job shop scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/maintenance-planning.html">
     Extra material: Maintenance planning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/04.00.html">
   4. Network Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/dinner-seat-allocation.html">
     Dinner seating arrangement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/gasoline-distribution.html">
     Gasoline distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/cryptocurrency-arbitrage.html">
     Cryptocurrency arbitrage search
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/power-network.html">
     Extra material: Energy dispatch problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/forex-arbitrage.html">
     Forex Arbitrage
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05/05.00.html">
   5. Convex Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/milk-pooling.html">
     Milk pooling and blending
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/ols-regression.html">
     Ordinary Least Squares (OLS) Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/markowitz_portfolio.html">
     Markowitz portfolio optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/svm.html">
     Support Vector Machines for Binary Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/refinery-production.html">
     Extra material: Refinery production and shadow pricing with CVXPY
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/cutting-stock.html">
     Extra Material: Cutting Stock
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/06.00.html">
   6. Conic Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/economic-order-quantity.html">
     Economic Order Quantity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/kelly-criterion.html">
     The Kelly Criterion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/markowitz_portfolio_revisited.html">
     Markowitz portfolio optimization revisited
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/building-insulation.html">
     Optimal Design of Multilayered Building Insulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/svm-conic.html">
     Training Support Vector Machines with Conic Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/investment-wheel.html">
     Extra material: Luenberger’s Investment Wheel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/optimal-growth-portfolios.html">
     Extra material: Optimal Growth Portfolios with Risk Aversion
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/07.00.html">
   7. Accounting for Uncertainty: Optimization Meets Reality
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/fleet-assignment.html">
     Fleet assignment problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/bim-robustness-analysis.html">
     Robustness analysis of BIM production plan via simulations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="08.00.html">
   8. Robust Optimization - Single Stage Problems
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Robust BIM microchip production problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/09.00.html">
   9. Stochastic Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/pop-up_shop.html">
     Pop-up shop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/markowitz_portfolio_with_chance_constraint.html">
     Markowitz portfolio optimization with chance constraints
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/seafood.html">
     Stock optimization for seafood distribution center
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/economicdispatch.html">
     Economic dispatch in energy systems
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../10/10.00.html">
   10. Two-Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/airline-seating.html">
     Airline seat allocation problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/opf-ldr.html">
     Optimal power flow problem with recourse actions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/ccg.html">
     Two-stage Production Planning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/farmer.html">
     Extra: The farmer’s problem and its variants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/opf-wind-curtailment.html">
     Extra: Two-stage energy dispatch optimization with wind curtailment
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../appendix/appendix.html">
   Appendix: Working with Pyomo
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../appendix/pyomo-style-guide.html">
     Pyomo style guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../appendix/functional-programming-pyomo.html">
     Functional Programming with Pyomo
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../genindex.html">
   Index
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/mobook/MO-book/main?urlpath=tree/notebooks/08/bim-robust-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/mobook/MO-book/blob/main/notebooks/08/bim-robust-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/mobook/MO-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/mobook/MO-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/08/bim-robust-optimization.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/08/bim-robust-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#original-bim-production-planning-model">
   Original BIM production planning model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#robust-bim-production-planning-models">
   Robust BIM production planning models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#box-uncertainty-for-copper-consumption">
     Box uncertainty for copper consumption
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#robust-counterpart-of-box-uncertainty">
     Robust counterpart of box uncertainty
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#integer-solution-variant">
     Integer solution variant
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cardinality-constrained-uncertainty-set">
   Cardinality-constrained uncertainty set
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#robust-counterpart-of-cardinality-constrained-uncertainty">
     Robust counterpart of cardinality-constrained uncertainty
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adversarial-approach-for-the-budgeted-uncertainty-set">
     Adversarial approach for the budgeted uncertainty set
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ball-uncertainty-set">
   Ball uncertainty set
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#robust-counterpart-of-ball-uncertainty">
     Robust counterpart of ball uncertainty
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implementing-second-order-cones-using-pyomo-environ">
     Implementing second-order cones using
     <code class="docutils literal notranslate">
      <span class="pre">
       pyomo.environ
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Robust BIM microchip production problem</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#original-bim-production-planning-model">
   Original BIM production planning model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#robust-bim-production-planning-models">
   Robust BIM production planning models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#box-uncertainty-for-copper-consumption">
     Box uncertainty for copper consumption
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#robust-counterpart-of-box-uncertainty">
     Robust counterpart of box uncertainty
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#integer-solution-variant">
     Integer solution variant
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cardinality-constrained-uncertainty-set">
   Cardinality-constrained uncertainty set
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#robust-counterpart-of-cardinality-constrained-uncertainty">
     Robust counterpart of cardinality-constrained uncertainty
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adversarial-approach-for-the-budgeted-uncertainty-set">
     Adversarial approach for the budgeted uncertainty set
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ball-uncertainty-set">
   Ball uncertainty set
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#robust-counterpart-of-ball-uncertainty">
     Robust counterpart of ball uncertainty
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implementing-second-order-cones-using-pyomo-environ">
     Implementing second-order cones using
     <code class="docutils literal notranslate">
      <span class="pre">
       pyomo.environ
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="robust-bim-microchip-production-problem">
<h1>Robust BIM microchip production problem<a class="headerlink" href="#robust-bim-microchip-production-problem" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># install Pyomo and solvers</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">SOLVER</span> <span class="o">=</span> <span class="s2">&quot;cbc&quot;</span>
<span class="n">SOLVER_NLO</span> <span class="o">=</span> <span class="s2">&quot;ipopt&quot;</span>
<span class="n">SOLVER_MINLO</span> <span class="o">=</span> <span class="s2">&quot;bonmin&quot;</span>

<span class="k">if</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>idaes-pse<span class="w"> </span>--pre<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;/dev/null
    <span class="o">!</span>idaes<span class="w"> </span>get-extensions<span class="w"> </span>--to<span class="w"> </span>./bin<span class="w"> </span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;:bin&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
</pre></div>
</div>
</div>
</div>
<section id="original-bim-production-planning-model">
<h2>Original BIM production planning model<a class="headerlink" href="#original-bim-production-planning-model" title="Permalink to this headline">#</a></h2>
<p>The full description of the BIM production problem, can be found here <a class="reference internal" href="../02/bim.html"><span class="doc std std-doc">here</span></a>. The resulting optimization problem was the following LP:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrcrcl}
\max    &amp; 12x_1 &amp; + &amp; 9x_2               \\
\text{s.t.}    &amp;   x_1 &amp;   &amp;      &amp; \leq &amp; 1000 \\
        &amp;       &amp;   &amp;  x_2 &amp; \leq &amp; 1500 \\
        &amp;   x_1 &amp; + &amp;  x_2 &amp; \leq &amp; 1750 \\
        &amp;  4x_1 &amp; + &amp; 2x_2 &amp; \leq &amp; 4800 \\
        &amp;   x_1 &amp; , &amp;  x_2 &amp; \geq &amp; 0.
\end{array}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chips</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;logic&quot;</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">]</span>
<span class="n">profits</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logic&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>
<span class="n">copper</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logic&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s2">&quot;BIM basic problem&quot;</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">chips</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">chips</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">profit</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span>
    <span class="n">expr</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">quicksum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]),</span>
    <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">silicon</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;logic&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">gemanium</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">plastic</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">quicksum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">copper</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span>
    <span class="n">expr</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">copper</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4800</span>
<span class="p">)</span>

<span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The optimal solution is x=</span><span class="si">{</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]</span><span class="si">}</span><span class="s2"> and yields a profit of </span><span class="si">{</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The optimal solution is x=[650.0, 1100.0] and yields a profit of 17700.00
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ShowDuals</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">fractions</span>

    <span class="c1"># display all duals</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The dual variable corresponding to:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">component_objects</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- the constraint on&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s2">&quot;is equal to &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">dual</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="n">index</span><span class="p">]])))</span>


<span class="n">m</span><span class="o">.</span><span class="n">dual</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="o">.</span><span class="n">IMPORT</span><span class="p">)</span>

<span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">ShowDuals</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The dual variable corresponding to:

- the constraint on silicon is equal to 0
- the constraint on gemanium is equal to 0
- the constraint on plastic is equal to 6
- the constraint on copper is equal to 3/2
</pre></div>
</div>
</div>
</div>
</section>
<section id="robust-bim-production-planning-models">
<h2>Robust BIM production planning models<a class="headerlink" href="#robust-bim-production-planning-models" title="Permalink to this headline">#</a></h2>
<p>Suppose now that there is uncertainty affecting the microchip production at BIM. Specifically, the company notices that not the amount of copper needed for the two types of microchips is not <em>exactly</em> 4 and 2 gr, but varies due to some external factors affecting the production process. How does this uncertainty affect the optimal production plan?</p>
<p>To get a feeling for what happens, let us first perform some simulations and data analysis on them. We start by simulating a sample of <span class="math notranslate nohighlight">\(n=2000\)</span> observed copper consumption pairs for the production of <code class="docutils literal notranslate"><span class="pre">f</span></code> logic chips and <code class="docutils literal notranslate"><span class="pre">g</span></code> memory chips. The amounts vary around the original values, 4 gr and 2 gr, respectively, according to two independent lognormal distributions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>

<span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">4.0</span><span class="p">),</span> <span class="mf">0.005</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">),</span> <span class="mf">0.005</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Copper gr needed for logic chips&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Copper gr needed for memory chips&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bim-robust-optimization_8_0.png" src="../../_images/bim-robust-optimization_8_0.png" />
</div>
</div>
<section id="box-uncertainty-for-copper-consumption">
<h3>Box uncertainty for copper consumption<a class="headerlink" href="#box-uncertainty-for-copper-consumption" title="Permalink to this headline">#</a></h3>
<p>A very simple and somehow naive uncertainty set can be the minimal box that contains all the simulated data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="n">currentAxis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">currentAxis</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
        <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">)),</span>
        <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
        <span class="nb">max</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">),</span>
        <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Copper gr needed for logic chips&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Copper gr needed for memory chips&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># calculate the upper and lower bounds for each uncertain parameter</span>
<span class="n">lower</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logic&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">)}</span>
<span class="n">upper</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logic&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">g</span><span class="p">)}</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lower bounds&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Upper bounds&quot;</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bim-robust-optimization_10_0.png" src="../../_images/bim-robust-optimization_10_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lower bounds {&#39;logic&#39;: 3.922766922829344, &#39;memory&#39;: 1.9701110863753781}
Upper bounds {&#39;logic&#39;: 4.061793174956137, &#39;memory&#39;: 2.0328386701386703}
</pre></div>
</div>
</div>
</div>
<p>Using this empirical box uncertainty set, we can consider the following robust variant of their optimization model:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrcrcl}
\max    &amp;  12 x_1 &amp; + &amp;   9 x_2               \\
\text{s.t.}    &amp;     x_1 &amp;   &amp;         &amp; \leq &amp; 1000 \\
        &amp;         &amp;   &amp;     x_2 &amp; \leq &amp; 1500 \\
        &amp;     x_1 &amp; + &amp;     x_2 &amp; \leq &amp; 1750 \\
        &amp; z_1 x_1 &amp; + &amp; z_2 x_2 &amp; \leq &amp; 4800 &amp; \forall \ell \leq a \leq u \\
        &amp;     x_1 &amp; , &amp;     x_2 &amp; \geq &amp; 0    \\
\end{array}
\end{split}\]</div>
<p>The above model has an infinite number of constraints, one for every realization of the uncertain coefficients <span class="math notranslate nohighlight">\(z\)</span>. However, using linear duality, we can deal with this and obtain a robustified LP that we can solve.</p>
</section>
<section id="robust-counterpart-of-box-uncertainty">
<h3>Robust counterpart of box uncertainty<a class="headerlink" href="#robust-counterpart-of-box-uncertainty" title="Permalink to this headline">#</a></h3>
<p>The first thing to notice is that the copper consumption is modeled by constraints that are equivalent to bounding the following optimization problem:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrr}
\max    &amp; x_1 z_1 + x_2 z_2 &amp; \leq 4800 \\
\text{s.t.}    &amp; \ell \leq z \leq u 
\end{array}
\end{split}\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrr}
\max    &amp; x_1 z_1 + x_2 z_2 &amp; \leq 4800 \\
\text{s.t.}    &amp; z \leq u \\
        &amp; -z \leq -\ell.
\end{array}
\end{split}\]</div>
<p>Now we use linear duality to realize that the above is equivalent to:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrr}
\min    &amp; u y  - \ell w &amp; \leq 4800 \\
\text{s.t.}    &amp; y - w = x \\
        &amp; y \geq 0, w \geq 0
\end{array}
\end{split}\]</div>
<p>and the constraint imposed by the last problem is equivalent to:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrl}
   &amp; u y  - \ell w &amp; \leq 4800 \\
   &amp; y - w &amp; = x \\
   &amp; y \geq 0, w \geq 0
\end{array}
\end{split}\]</div>
<p>The only thing we need to do is add the new auxiliary variables and constraints to the original model and implement them in Pyomo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">BIMWithBoxUncertainty</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s2">&quot;BIM with Box Uncertainty&quot;</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">chips</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">chips</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">profit</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span>
    <span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">silicon</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;logic&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">germanium</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plastic</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">robustcopper</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">upper</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">-</span> <span class="n">lower</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">])</span>
        <span class="o">&lt;=</span> <span class="mi">4800</span>
    <span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">PerVariable</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">m</span>


<span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBoxUncertainty</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
<span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The optimal solution is x=</span><span class="si">{</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]</span><span class="si">}</span><span class="s2"> and yields a profit of </span><span class="si">{</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The optimal solution is x=[612.4, 1137.6] and yields a profit of 17587.20
</pre></div>
</div>
</div>
</div>
<p>We may want to impose the box uncertainty set to be symmetric with respect to the nominal values and just choose its width <span class="math notranslate nohighlight">\(\delta\)</span>. This leads to a different optimal robust solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The parameter delta allows you to tune the amount of uncertainty.</span>
<span class="c1"># In particular, if you take delta=0, you obtain the same result as the nominal model.</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mf">0.05</span>


<span class="k">def</span> <span class="nf">BIMWithSymmetricalBoxUncertainty</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">):</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="p">{</span><span class="n">chip</span><span class="p">:</span> <span class="n">copper</span><span class="p">[</span><span class="n">chip</span><span class="p">]</span> <span class="o">-</span> <span class="n">delta</span> <span class="k">for</span> <span class="n">chip</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">}</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="p">{</span><span class="n">chip</span><span class="p">:</span> <span class="n">copper</span><span class="p">[</span><span class="n">chip</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta</span> <span class="k">for</span> <span class="n">chip</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">BIMWithBoxUncertainty</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>


<span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithSymmetricalBoxUncertainty</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
<span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The optimal solution is x=</span><span class="si">{</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]</span><span class="si">}</span><span class="s2"> and yields a profit of </span><span class="si">{</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The optimal solution is x=[606.25, 1143.75] and yields a profit of 17568.75
</pre></div>
</div>
</div>
</div>
</section>
<section id="integer-solution-variant">
<h3>Integer solution variant<a class="headerlink" href="#integer-solution-variant" title="Permalink to this headline">#</a></h3>
<p>The original BIM model gave integer solutions, but not the robust version. If we need integer solutions then we should impose that to the nature of the variables, which in this case of <em>box uncertainty</em> is easy to do since the model remains linear, although it will be mixed integer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBoxUncertainty</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>
<span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The optimal solution is x=</span><span class="si">{</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]</span><span class="si">}</span><span class="s2"> and yields a profit of </span><span class="si">{</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The optimal solution is x=[612.0, 1138.0] and yields a profit of 17586.00
</pre></div>
</div>
</div>
</div>
<p>Let us see how the optimal solution behave as we vary the width of the box uncertainty set <span class="math notranslate nohighlight">\(\delta\)</span> from 0 to 0.5.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">21</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithSymmetricalBoxUncertainty</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>
    <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;profit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">delta</span><span class="p">,</span> <span class="n">chips</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">delta</span><span class="p">,</span> <span class="n">chips</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>profit</th>
      <th>logic</th>
      <th>memory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.000</th>
      <td>17700.0</td>
      <td>650.0</td>
      <td>1100.0</td>
    </tr>
    <tr>
      <th>0.025</th>
      <td>17634.0</td>
      <td>628.0</td>
      <td>1122.0</td>
    </tr>
    <tr>
      <th>0.050</th>
      <td>17568.0</td>
      <td>606.0</td>
      <td>1144.0</td>
    </tr>
    <tr>
      <th>0.075</th>
      <td>17502.0</td>
      <td>584.0</td>
      <td>1166.0</td>
    </tr>
    <tr>
      <th>0.100</th>
      <td>17436.0</td>
      <td>562.0</td>
      <td>1188.0</td>
    </tr>
    <tr>
      <th>0.125</th>
      <td>17370.0</td>
      <td>540.0</td>
      <td>1210.0</td>
    </tr>
    <tr>
      <th>0.150</th>
      <td>17304.0</td>
      <td>518.0</td>
      <td>1232.0</td>
    </tr>
    <tr>
      <th>0.175</th>
      <td>17238.0</td>
      <td>496.0</td>
      <td>1254.0</td>
    </tr>
    <tr>
      <th>0.200</th>
      <td>17175.0</td>
      <td>475.0</td>
      <td>1275.0</td>
    </tr>
    <tr>
      <th>0.225</th>
      <td>17109.0</td>
      <td>453.0</td>
      <td>1297.0</td>
    </tr>
    <tr>
      <th>0.250</th>
      <td>17043.0</td>
      <td>431.0</td>
      <td>1319.0</td>
    </tr>
    <tr>
      <th>0.275</th>
      <td>16977.0</td>
      <td>409.0</td>
      <td>1341.0</td>
    </tr>
    <tr>
      <th>0.300</th>
      <td>16911.0</td>
      <td>387.0</td>
      <td>1363.0</td>
    </tr>
    <tr>
      <th>0.325</th>
      <td>16845.0</td>
      <td>365.0</td>
      <td>1385.0</td>
    </tr>
    <tr>
      <th>0.350</th>
      <td>16779.0</td>
      <td>343.0</td>
      <td>1407.0</td>
    </tr>
    <tr>
      <th>0.375</th>
      <td>16713.0</td>
      <td>321.0</td>
      <td>1429.0</td>
    </tr>
    <tr>
      <th>0.400</th>
      <td>16650.0</td>
      <td>300.0</td>
      <td>1450.0</td>
    </tr>
    <tr>
      <th>0.425</th>
      <td>16584.0</td>
      <td>278.0</td>
      <td>1472.0</td>
    </tr>
    <tr>
      <th>0.450</th>
      <td>16518.0</td>
      <td>256.0</td>
      <td>1494.0</td>
    </tr>
    <tr>
      <th>0.475</th>
      <td>16416.0</td>
      <td>243.0</td>
      <td>1500.0</td>
    </tr>
    <tr>
      <th>0.500</th>
      <td>16296.0</td>
      <td>233.0</td>
      <td>1500.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can visualize how these quantities change as a function of <span class="math notranslate nohighlight">\(\delta\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s2">&quot;profit&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">16001</span><span class="p">,</span> <span class="mi">17999</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Margin $\delta$ of the uncertainty box&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Profit&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">df</span><span class="p">[[</span><span class="s2">&quot;logic&quot;</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Margin $\delta$ of the uncertainty box&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Optimal number of produced chips&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bim-robust-optimization_21_0.png" src="../../_images/bim-robust-optimization_21_0.png" />
<img alt="../../_images/bim-robust-optimization_21_1.png" src="../../_images/bim-robust-optimization_21_1.png" />
</div>
</div>
</section>
</section>
<section id="cardinality-constrained-uncertainty-set">
<h2>Cardinality-constrained uncertainty set<a class="headerlink" href="#cardinality-constrained-uncertainty-set" title="Permalink to this headline">#</a></h2>
<p>Let us now make different assumptions regarding the uncertainty related to the copper consumption. More specifically, we now assume that each uncertain coefficient <span class="math notranslate nohighlight">\(z_j\)</span> may deviate by at most <span class="math notranslate nohighlight">\(\pm \delta\)</span> from the nominal value <span class="math notranslate nohighlight">\(\bar{z}_j\)</span> but no more than <span class="math notranslate nohighlight">\(\Gamma\)</span> will actually deviate.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrcrcl}
\max    &amp;  12 x_1 &amp; + &amp;   9 x_2               \\
\text{s.t.}    &amp;     x_1 &amp;   &amp;         &amp; \leq &amp; 1000 \\
        &amp;         &amp;   &amp;     x_2 &amp; \leq &amp; 1500 \\
        &amp;     x_1 &amp; + &amp;     x_2 &amp; \leq &amp; 1750 \\
        &amp; z_1 x_1 &amp; + &amp; z_2 x_2 &amp; \leq &amp; 4800 &amp; \forall \, y \in \mathbb{R}^2 \,:\, z_j=\bar{z}_j+\delta y_j, \, \|y\|_\infty \leq 1, \, \|y\|_1\leq \Gamma \\
        &amp;     x_1 &amp; , &amp;     x_2 &amp; \geq &amp; 0    \\
\end{array}
\end{split}\]</div>
<section id="robust-counterpart-of-cardinality-constrained-uncertainty">
<h3>Robust counterpart of cardinality-constrained uncertainty<a class="headerlink" href="#robust-counterpart-of-cardinality-constrained-uncertainty" title="Permalink to this headline">#</a></h3>
<p>Lagrange duality yields the following modification to the problem as equivalent to the robust model stated above:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrcrcrcrcrcrcl}
\max    &amp;  12 x_1 &amp; + &amp;   9 x_2               \\
\text{s.t.}    &amp;     x_1 &amp;   &amp;         &amp; &amp; &amp; &amp; &amp; &amp; &amp; \leq &amp; 1000 \\
        &amp;         &amp;   &amp;     x_2 &amp; &amp; &amp; &amp; &amp; &amp; &amp; \leq &amp; 1500 \\
        &amp;     x_1 &amp; + &amp;     x_2 &amp; &amp; &amp; &amp; &amp; &amp; &amp; \leq &amp; 1750 \\
        &amp; \bar{z}_1 x_1 &amp; + &amp; \bar{z}_2 x_2 &amp; + &amp; \lambda\Gamma &amp; + &amp; t_1 &amp; + &amp; t_2 &amp; \leq &amp; 4800 \\
        &amp;-\delta x_1 &amp;   &amp;         &amp; + &amp; \lambda &amp; + &amp; t_1 &amp;   &amp;     &amp; \geq &amp; 0 \\
        &amp;         &amp;   &amp;-\delta x_2 &amp; + &amp; \lambda &amp;   &amp;     &amp; + &amp; t_2 &amp; \geq &amp; 0 \\
        &amp;\delta x_1 &amp;   &amp;         &amp; + &amp; \lambda &amp; + &amp; t_1 &amp;   &amp;     &amp; \geq &amp; 0 \\
        &amp;         &amp;   &amp;\delta x_2 &amp; + &amp; \lambda &amp;   &amp;     &amp; + &amp; t_2 &amp; \geq &amp; 0 \\
        &amp;     x_1 &amp; , &amp;     x_2 &amp; , &amp; \lambda &amp; , &amp; t_1 &amp; , &amp; t_2 &amp; \geq &amp; 0    \\
\end{array}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">BIMWithBudgetUncertainty</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s2">&quot;BIM with Budget Uncertainty&quot;</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">chips</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">chips</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">profit</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span>
    <span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">silicon</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;logic&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">germanium</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plastic</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">robustcopper</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">copper</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">])</span>
        <span class="o">+</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">lam</span>
        <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">)</span>
        <span class="o">&lt;=</span> <span class="mi">4800</span>
    <span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">up_rule</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">lam</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">down_rule</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">delta</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">lam</span>

    <span class="k">return</span> <span class="n">m</span>


<span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBudgetUncertainty</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>
<span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The optimal solution is x=</span><span class="si">{</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]</span><span class="si">}</span><span class="s2"> and yields a profit of </span><span class="si">{</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The optimal solution is x=[641.0, 1109.0] and yields a profit of 17673.00
</pre></div>
</div>
</div>
</div>
</section>
<section id="adversarial-approach-for-the-budgeted-uncertainty-set">
<h3>Adversarial approach for the budgeted uncertainty set<a class="headerlink" href="#adversarial-approach-for-the-budgeted-uncertainty-set" title="Permalink to this headline">#</a></h3>
<p>Instead of adopting the approach of robust counterparts, we could also use the adversarial approach where we initially solve the problem for the nominal value of the data. Then, we iteratively search for scenarios that make the current solution violate the copper constraint, and pre-solve the problem to take this scenario into account. To do so, we need to slightly modify our problem formulation function to allow for many scenarios for the parameter <span class="math notranslate nohighlight">\(z\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">BIMWithSetOfScenarios</span><span class="p">(</span>
    <span class="n">delta</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;logic&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span>
<span class="p">):</span>
    <span class="n">chips</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;logic&quot;</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">]</span>
    <span class="n">profits</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logic&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>
    <span class="n">copper</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logic&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s2">&quot;BIM basic problem&quot;</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">chips</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">chips</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">scenarios</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)))</span>
    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">profit</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">quicksum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]),</span>
        <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">silicon</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;logic&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">gemanium</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plastic</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">quicksum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span>
    <span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">scenarios</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">balance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">pyo</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">copper</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">z</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">)</span>
            <span class="o">&lt;=</span> <span class="mi">4800</span>
        <span class="p">)</span>

    <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<p>We also need a function that for a given solution finds the worst-possible realization of the uncertainty restricted by the parameters <span class="math notranslate nohighlight">\(\Gamma\)</span> and <span class="math notranslate nohighlight">\(\delta\)</span>. In other words, its role is to solve the following maximization problem for a given solution <span class="math notranslate nohighlight">\((\bar{x}_1, \bar{x}_2)\)</span>:
\begin{align*}
\max \ &amp; (\bar{z}_1 + \delta y_1) \bar{x}_1 + (\bar{z}_2 + \delta y_2) \bar{x}_2 - 4800 \
\text{s.t.} \ &amp; |y_1| + |y_2| \leq \Gamma \
&amp; -1 \leq y_i \leq 1 &amp;&amp; i = 1, 2.
\end{align*}
Such a function is implemented below and takes as argument also the maximum magnitude of the individual deviations <span class="math notranslate nohighlight">\(\delta\)</span> and the total budget <span class="math notranslate nohighlight">\(\Gamma\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">BIMPessimization</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="n">chips</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;logic&quot;</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">]</span>
    <span class="n">copper</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logic&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s2">&quot;BIM pessimization problem&quot;</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">chips</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">chips</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Reals</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">absolute_value_1</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">absolute_value_2</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">absolute_value_less_than_one</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>

    <span class="n">m</span><span class="o">.</span><span class="n">budget_constraint</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">quicksum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">gamma</span>
    <span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">violation</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=-</span><span class="mi">4800</span>
        <span class="o">+</span> <span class="n">pyo</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span>
            <span class="p">[</span><span class="n">copper</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]</span>
        <span class="p">),</span>
        <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="n">worst_z</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">worst_z</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">violation</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We wrap the two functions above into a loop of the adversarial approach, which begins with a non-perturbation assumption and gradually generates violating scenarios, reoptimizing until the maximum constraint violation is below a tolerable threshold.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">adversarial_converged</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">stopping_precision</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">max_iterations</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">adversarial_iterations</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">chips</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;logic&quot;</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">]</span>

<span class="c1"># Initialize the null scenario - no perturbation</span>
<span class="n">Z</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;logic&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>

<span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">adversarial_converged</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">adversarial_iterations</span> <span class="o">&lt;</span> <span class="n">max_iterations</span><span class="p">):</span>
    <span class="c1"># Building and solving the master problem</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BIMWithSetOfScenarios</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>

    <span class="c1"># Saving the current solution</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">chips</span><span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Iteration #</span><span class="si">{</span><span class="n">adversarial_iterations</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current solution: &quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x[&#39;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&#39;]= </span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Pessimization</span>
    <span class="n">worst_z</span><span class="p">,</span> <span class="n">constraint_violation</span> <span class="o">=</span> <span class="n">BIMPessimization</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>

    <span class="c1"># If pessimization yields no violation, stop the procedure, otherwise add a scenario and repeat</span>
    <span class="k">if</span> <span class="n">constraint_violation</span> <span class="o">&lt;</span> <span class="n">stopping_precision</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No violation found. Stopping the procedure.&quot;</span><span class="p">)</span>
        <span class="n">adversarial_converged</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Violation found: z[&#39;logic&#39;] = </span><span class="si">{</span><span class="n">worst_z</span><span class="p">[</span><span class="s1">&#39;logic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">,  z[&#39;memory&#39;] = </span><span class="si">{</span><span class="n">worst_z</span><span class="p">[</span><span class="s1">&#39;memory&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;constraint violation: </span><span class="si">{</span><span class="n">constraint_violation</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">worst_z</span><span class="p">)</span>

    <span class="n">adversarial_iterations</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Iteration #0
Current solution: 
x[&#39;logic&#39;]= 650.00
x[&#39;memory&#39;]= 1100.00
Violation found: z[&#39;logic&#39;] = 1.0,  z[&#39;memory&#39;] = 0.5, constraint violation: 740.00

Iteration #1
Current solution: 
x[&#39;logic&#39;]= 37.50
x[&#39;memory&#39;]= 1500.00
No violation found. Stopping the procedure.
</pre></div>
</div>
</div>
</div>
<p>It takes only two scenarios to be added to the baseline scenario to arrive at the solution which is essentially robust! For that reason, in many settings the adversarial approach is very viable. In fact, because the budgeted uncertainty set for two uncertain parameters has at most 8 vertices, we are guaranteed that it would never take more than 8 iterations to reach a fully robust solution (constraint violation of exactly <span class="math notranslate nohighlight">\(0\)</span>).</p>
<p>This is not true, however, if the uncertainty set is not a polytope, but is, for example, an ellipsoid (ball) with infinitely many extreme points - it is expected that there will always be some minuscule constraint violation remaining after a certain number of iterations.</p>
<p>We will now illustrate how to use conic optimization to solve the problem using robust counterparts for an ellipsoidal uncertainty set.</p>
</section>
</section>
<section id="ball-uncertainty-set">
<h2>Ball uncertainty set<a class="headerlink" href="#ball-uncertainty-set" title="Permalink to this headline">#</a></h2>
<p>Let us now make yet another different assumption regarding the uncertainty related to copper consumption. More specifically, we assume that the two uncertain coefficients <span class="math notranslate nohighlight">\(z_1\)</span> and <span class="math notranslate nohighlight">\(z_2\)</span> can vary in a 2-dimensional ball centered around the point <span class="math notranslate nohighlight">\((\bar{z}_1,\bar{z}_2) = (4,2)\)</span> and with radius <span class="math notranslate nohighlight">\(r\)</span>.</p>
<section id="robust-counterpart-of-ball-uncertainty">
<h3>Robust counterpart of ball uncertainty<a class="headerlink" href="#robust-counterpart-of-ball-uncertainty" title="Permalink to this headline">#</a></h3>
<p>A straightforward reformulation leads to the equivalent constraint:</p>
<div class="math notranslate nohighlight">
\[
  \bar{z}_1x_1+\bar{z}_2x_2 + r \|x\|_2 \leq 4800
\]</div>
<p>By defining <span class="math notranslate nohighlight">\(y = 4800 - \bar{z}_1x_1 - \bar{z}_2x_2\)</span> and <span class="math notranslate nohighlight">\(w = r x\)</span>, we may write:</p>
<div class="math notranslate nohighlight">
\[
  \|w\|^2_2 \leq y^2
\]</div>
<p>We now need to add this newly obtained conic constraint to the original BIM model. The <a class="reference external" href="https://pyomo.readthedocs.io/en/stable/library_reference/kernel/conic.html">Pyomo documentation</a> says a conic constraint is expressed in ‘pyomo’ in simple variables and this <a class="reference external" href="https://pyomo.readthedocs.io/en/stable/library_reference/kernel/syntax_comparison.html">table</a> reports the syntax.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.kernel</span> <span class="k">as</span> <span class="nn">pyk</span>


<span class="k">def</span> <span class="nf">BIMWithBallUncertainty</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">domain_type</span><span class="o">=</span><span class="n">pyk</span><span class="o">.</span><span class="n">RealSet</span><span class="p">):</span>
    <span class="n">idxChips</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chips</span><span class="p">))</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">block</span><span class="p">()</span>

    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable_list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxChips</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">domain_type</span><span class="o">=</span><span class="n">domain_type</span><span class="p">))</span>

    <span class="n">m</span><span class="o">.</span><span class="n">profit</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">objective</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">profits</span><span class="p">[</span><span class="n">chips</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxChips</span><span class="p">),</span>
        <span class="n">sense</span><span class="o">=</span><span class="n">pyk</span><span class="o">.</span><span class="n">maximize</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">silicon</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">germanium</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plastic</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxChips</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable_list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxChips</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="n">m</span><span class="o">.</span><span class="n">copper</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">4800</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">copper</span><span class="p">[</span><span class="n">chips</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxChips</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">xtow</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint_list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxChips</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">xtow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="kn">from</span> <span class="nn">pyomo.core.kernel.conic</span> <span class="kn">import</span> <span class="n">quadratic</span>

    <span class="n">m</span><span class="o">.</span><span class="n">robust</span> <span class="o">=</span> <span class="n">quadratic</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<p>Now the optimization problem is nonlinear, but dedicated solvers can leverage the fact that is conic and solve it efficiently. Specifically, <code class="docutils literal notranslate"><span class="pre">cplex</span></code>, <code class="docutils literal notranslate"><span class="pre">gurobi</span></code> and <code class="docutils literal notranslate"><span class="pre">xpress</span></code> support second-order cones. On the other hand, <code class="docutils literal notranslate"><span class="pre">ipopt</span></code> is a generic solver for nonlinear optimization problems.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">radius</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBallUncertainty</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER_NLO</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Solver: </span><span class="si">{</span><span class="n">SOLVER_NLO</span><span class="si">}</span><span class="s2">, solver status:&quot;</span><span class="p">,</span>
    <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
    <span class="s2">&quot;and solver terminal condition:&quot;</span><span class="p">,</span>
    <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The optimal solution is x=&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">))],</span>
    <span class="s2">&quot;and yields a profit of&quot;</span><span class="p">,</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Solver: ipopt, solver status: ok and solver terminal condition: optimal
The optimal solution is x= [617.755, 1132.245] and yields a profit of 17603.265 
</pre></div>
</div>
</div>
</div>
<p>The solvers <code class="docutils literal notranslate"><span class="pre">bonmin</span></code>, <code class="docutils literal notranslate"><span class="pre">cplex</span></code>, <code class="docutils literal notranslate"><span class="pre">gurobi</span></code> and <code class="docutils literal notranslate"><span class="pre">xpress</span></code> are capable of solving the mixed integer version of the same model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBallUncertainty</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">domain_type</span><span class="o">=</span><span class="n">pyk</span><span class="o">.</span><span class="n">IntegerSet</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER_MINLO</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Solver: </span><span class="si">{</span><span class="n">SOLVER_MINLO</span><span class="si">}</span><span class="s2">, solver status:&quot;</span><span class="p">,</span>
    <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
    <span class="s2">&quot;and solver terminal condition:&quot;</span><span class="p">,</span>
    <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The optimal solution is x=&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">))],</span>
    <span class="s2">&quot;and yields a profit of&quot;</span><span class="p">,</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Solver: bonmin, solver status: ok and solver terminal condition: optimal
The optimal solution is x= [617.0, 1133.0] and yields a profit of 17601.0 
</pre></div>
</div>
</div>
</div>
</section>
<section id="implementing-second-order-cones-using-pyomo-environ">
<h3>Implementing second-order cones using <code class="docutils literal notranslate"><span class="pre">pyomo.environ</span></code><a class="headerlink" href="#implementing-second-order-cones-using-pyomo-environ" title="Permalink to this headline">#</a></h3>
<p>Noting that <span class="math notranslate nohighlight">\(\| x \| \leq t\)</span> is for <span class="math notranslate nohighlight">\(t \geq 0\)</span> equivalent to <span class="math notranslate nohighlight">\(\| x \|^2 \leq t^2\)</span> and knowing that the commercial solvers (<code class="docutils literal notranslate"><span class="pre">gurobi</span></code>, <code class="docutils literal notranslate"><span class="pre">cplex</span></code> and <code class="docutils literal notranslate"><span class="pre">express</span></code>) support convex quadratic inequalities, we can model this variant in <code class="docutils literal notranslate"><span class="pre">pyomo.environ</span></code> as follows. Note that the essential part to make the model convex is having the right hand side nonnegative.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">BIMWithBallUncertaintyAsSquaredSecondOrderCone</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span>
<span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s2">&quot;BIM with Ball Uncertainty as SOC&quot;</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">chips</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">chips</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="c1"># the nonnegativity of this variable is essential!</span>
    <span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">within</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">profit</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span>
    <span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">silicon</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;logic&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">germanium</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plastic</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">copper</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">4800</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">copper</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">robust</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">((</span><span class="n">r</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBallUncertaintyAsSquaredSecondOrderCone</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER_NLO</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Solver: </span><span class="si">{</span><span class="n">SOLVER_NLO</span><span class="si">}</span><span class="s2">, solver status:&quot;</span><span class="p">,</span>
    <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
    <span class="s2">&quot;and solver terminal condition:&quot;</span><span class="p">,</span>
    <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The optimal solution is x=</span><span class="si">{</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]</span><span class="si">}</span><span class="s2"> and yields a profit of </span><span class="si">{</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Solver: ipopt, solver status: ok and solver terminal condition: optimal
The optimal solution is x=[617.755, 1132.245] and yields a profit of 17603.26
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBallUncertaintyAsSquaredSecondOrderCone</span><span class="p">(</span>
    <span class="n">radius</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span>
<span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER_MINLO</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Solver: </span><span class="si">{</span><span class="n">SOLVER_MINLO</span><span class="si">}</span><span class="s2">, solver status:&quot;</span><span class="p">,</span>
    <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
    <span class="s2">&quot;and solver terminal condition:&quot;</span><span class="p">,</span>
    <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The optimal solution is x=</span><span class="si">{</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">m</span><span class="o">.</span><span class="n">chips</span><span class="p">]</span><span class="si">}</span><span class="s2"> and yields a profit of </span><span class="si">{</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Solver: bonmin, solver status: ok and solver terminal condition: optimal
The optimal solution is x=[617.0, 1133.0] and yields a profit of 17601.00
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/08"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="08.00.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">8. Robust Optimization - Single Stage Problems</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../09/09.00.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">9. Stochastic Optimization - Single Stage Problems</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The MO Book Group<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>