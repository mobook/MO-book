
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Various robust versions of BIM production problem &#8212; Companion Notebooks for Data-Driven Mathematical Optimization in Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="9. Stochastic Optimization - Single Stage Problems" href="../09/09.00.html" />
    <link rel="prev" title="8. Robust Optimization - Single Stage Problems" href="08.00.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DVQ7NZ8CYZ"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-DVQ7NZ8CYZ');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo-02.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Companion Notebooks for Data-Driven Mathematical Optimization in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Data-Driven Mathematical Optimization in Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/01.00.html">
   1. Mathematical Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/pop-up_shop.html">
     Pop-up shop
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/02.00.html">
   2. Linear Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim.html">
     BIM production
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/lad-regression.html">
     LAD Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/mad-portfolio-optimization.html">
     MAD portfolio optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/multiproductionfaciliity_worstcase.html">
     Extra material: Multi-product facility production
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/03.00.html">
   3. Mixed Integer Linear Programming
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-perturbed.html">
     BIM production with perturbed data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/simple-production-model-gdp.html">
     Production model using disjunctions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/machine-scheduling.html">
     Machine Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/recharging-electric-vehicle.html">
     Recharging strategy for an electric vehicle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-production-revisited.html">
     BIM production revisited
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/cryptarithms.html">
     Extra material: Cryptarithms puzzle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/strip-packing.html">
     Extra material: Strip packing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/job-shop-scheduling.html">
     Extra material: Job shop scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/maintenance-planning.html">
     Extra material: Maintenance planning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/04.00.html">
   4. Network Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/dinner-seat-allocation.html">
     Dinner seating arrangement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/Transportation.html">
     Transportation and Allocation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/forex-arbitrage.html">
     Forex Arbitrage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/cryptocurrency-arbitrage.html">
     Crypto Currency Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/complete-example-ch4-power-network.html">
     Energy dispatch problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05/05.00.html">
   5. Convex Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/milk-pooling.html">
     Pooling and Blending
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/ols-regression.html">
     Ordinary Least Squares (OLS) Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/markowitz_portfolio_with_chance_constraint.html">
     Portfolio optimization with chance constraint
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/refinery-production.html">
     Refinery Production and Shadow Pricing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/svm-linear.html">
     Support Vector Machines for Binary Classifcation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/06.00.html">
   6. Conic Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/economic-order-quantity.html">
     Economic Order Quantity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/07.00.html">
   7. Accounting for Uncertainty: Optimization Meets Reality
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/bim-robustness-analysis.html">
     Robustness analysis of BIM production plan via simulations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="08.00.html">
   8. Robust Optimization - Single Stage Problems
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Various robust versions of BIM production problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/09.00.html">
   9. Stochastic Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/newsvendor.html">
     Stock optimization for seafood distribution center
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../10/10.00.html">
   10. Two-Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/vendor-problem.html">
     The Vendor Problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/airline-seating.html">
     Airline seat allocation problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/farmer.html">
     Farmerâ€™s problem and some of its variants
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pyomo_style_guide.html">
   Appendix: Pyomo style guide
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/mobook/MO-book/main?urlpath=tree/notebooks/08/bim-robust-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/mobook/MO-book/blob/main/notebooks/08/bim-robust-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/mobook/MO-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/mobook/MO-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/08/bim-robust-optimization.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/08/bim-robust-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Various robust versions of BIM production problem
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#original-bim-production-planning-model">
   Original BIM production planning model
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#uncertainty-in-copper-usage-during-production">
     Uncertainty in copper usage during production
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-robust-model-with-box-uncertainty-for-copper-consumption">
     A robust model with box uncertainty for copper consumption
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#integer-optimization">
   Integer optimization
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cardinality-constrained-uncertainty">
   Cardinality constrained uncertainty
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ball-uncertainty-set">
   Ball uncertainty set
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-implement-second-order-cones-using-pyomo-environ">
   How to implement second order cones using
   <code class="docutils literal notranslate">
    <span class="pre">
     pyomo.environ
    </span>
   </code>
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Various robust versions of BIM production problem</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Various robust versions of BIM production problem
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#original-bim-production-planning-model">
   Original BIM production planning model
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#uncertainty-in-copper-usage-during-production">
     Uncertainty in copper usage during production
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-robust-model-with-box-uncertainty-for-copper-consumption">
     A robust model with box uncertainty for copper consumption
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#integer-optimization">
   Integer optimization
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cardinality-constrained-uncertainty">
   Cardinality constrained uncertainty
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ball-uncertainty-set">
   Ball uncertainty set
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-implement-second-order-cones-using-pyomo-environ">
   How to implement second order cones using
   <code class="docutils literal notranslate">
    <span class="pre">
     pyomo.environ
    </span>
   </code>
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="various-robust-versions-of-bim-production-problem">
<h1>Various robust versions of BIM production problem<a class="headerlink" href="#various-robust-versions-of-bim-production-problem" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># install Pyomo and solvers</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/mobook/MO-book/main/python/helper.py&quot;</span>
<span class="n">helper</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s2">&quot;helper&quot;</span><span class="p">)</span>
<span class="n">exec</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">helper</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

<span class="n">helper</span><span class="o">.</span><span class="n">install_pyomo</span><span class="p">()</span>
<span class="n">helper</span><span class="o">.</span><span class="n">install_cbc</span><span class="p">()</span>
<span class="n">helper</span><span class="o">.</span><span class="n">install_ipopt</span><span class="p">()</span>
<span class="n">helper</span><span class="o">.</span><span class="n">install_gurobi</span><span class="p">()</span>
<span class="n">helper</span><span class="o">.</span><span class="n">install_xpress</span><span class="p">()</span>
<span class="n">helper</span><span class="o">.</span><span class="n">install_cplex</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="n">cbc</span>    <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>
<span class="n">ipopt</span>  <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;ipopt&#39;</span><span class="p">)</span>
<span class="n">cplex</span>  <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;cplex_direct&#39;</span><span class="p">)</span>
<span class="n">gurobi</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;gurobi_direct&#39;</span><span class="p">)</span>
<span class="n">xpress</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;xpress_direct&#39;</span><span class="p">)</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pyomo was previously installed
cbc was previously installed
ipopt was previously installed
gurobi was previously installed
Xpress was previously installed
cplex was previously installed
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="original-bim-production-planning-model">
<h1>Original BIM production planning model<a class="headerlink" href="#original-bim-production-planning-model" title="Permalink to this headline">#</a></h1>
<p>The full description of the BIM production problem, can be found here <a class="reference internal" href="../02/bim.html"><span class="doc std std-doc">here</span></a>. The resulting optimization problem was the following LP:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrcrcl}
\max    &amp; 12x_1 &amp; + &amp; 9x_2               \\
s.t.    &amp;   x_1 &amp;   &amp;      &amp; \leq &amp; 1000 \\
        &amp;       &amp;   &amp;  x_2 &amp; \leq &amp; 1500 \\
        &amp;   x_1 &amp; + &amp;  x_2 &amp; \leq &amp; 1750 \\
        &amp;  4x_1 &amp; + &amp; 2x_2 &amp; \leq &amp; 4800 \\
        &amp;   x_1 &amp; , &amp;  x_2 &amp; \geq &amp; 0.
\end{array}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">JustSolution</span><span class="p">(</span> <span class="n">model</span> <span class="p">):</span>
    <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The optimal solution is x=&#39;</span><span class="p">,[</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">],</span><span class="s1">&#39;and yields a profit of&#39;</span><span class="p">,</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">profit</span><span class="p">))</span>

<span class="n">chips</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;logic&#39;</span><span class="p">,</span> <span class="s1">&#39;memory&#39;</span> <span class="p">]</span>
<span class="n">profits</span>  <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;logic&#39;</span> <span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;memory&#39;</span> <span class="p">:</span>  <span class="mi">9</span> <span class="p">}</span>
<span class="n">copper</span>     <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;logic&#39;</span> <span class="p">:</span>  <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;memory&#39;</span> <span class="p">:</span>  <span class="mi">2</span> <span class="p">}</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s1">&#39;BIM basic problem&#39;</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">chips</span><span class="p">,</span><span class="n">within</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">profit</span>    <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">quicksum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">]),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">silicon</span>  <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;logic&#39;</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">gemanium</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;memory&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">plastic</span>  <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">quicksum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">copper</span>   <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">copper</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4800</span> <span class="p">)</span> 

<span class="n">cbc</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">JustSolution</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The optimal solution is x= [650.0, 1100.0] and yields a profit of 17700.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ShowDuals</span><span class="p">(</span> <span class="n">model</span> <span class="p">):</span>
    <span class="kn">import</span> <span class="nn">fractions</span>
    <span class="c1"># display all duals</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Dual variables:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">component_objects</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Constraint &quot;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;      &quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">dual</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="n">index</span><span class="p">]])))</span>
            

            
<span class="n">m</span><span class="o">.</span><span class="n">dual</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="o">.</span><span class="n">IMPORT</span><span class="p">)</span>

<span class="n">cbc</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">ShowDuals</span><span class="p">(</span> <span class="n">m</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dual variables:
Constraint  silicon
       None 0
Constraint  gemanium
       None 0
Constraint  plastic
       None 6
Constraint  copper
       None 3/2
</pre></div>
</div>
</div>
</div>
<section id="uncertainty-in-copper-usage-during-production">
<h2>Uncertainty in copper usage during production<a class="headerlink" href="#uncertainty-in-copper-usage-during-production" title="Permalink to this headline">#</a></h2>
<p>Suppose now that the company BIM notices that not the amount of copper needed for the two types of microchips is not <em>exactly</em> 4 and 2 gr, but varies due to some external factors affecting the production process. How does this uncertainty affect the optimal production plan?</p>
<p>To get a feeling for what happens, let us first perform some simulations and data analysis on them. We start by simulating a sample of observed copper consumptions pairs for the production of 2000 <code class="docutils literal notranslate"><span class="pre">f</span></code> logic chips and 2000 <code class="docutils literal notranslate"><span class="pre">g</span></code> memory chips. The amounts vary around the original values, 4 gr and 2 gr, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2021</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">4.</span><span class="p">),</span> <span class="mf">.005</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.</span><span class="p">),</span> <span class="mf">.005</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bim-robust-optimization_7_0.png" src="../../_images/bim-robust-optimization_7_0.png" />
</div>
</div>
<p>A very simple and somehow naive uncertainty set can be the minimal box that contains all the simulated data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span> <span class="p">)</span>
<span class="n">currentAxis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">currentAxis</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bim-robust-optimization_9_0.png" src="../../_images/bim-robust-optimization_9_0.png" />
</div>
</div>
</section>
<section id="a-robust-model-with-box-uncertainty-for-copper-consumption">
<h2>A robust model with box uncertainty for copper consumption<a class="headerlink" href="#a-robust-model-with-box-uncertainty-for-copper-consumption" title="Permalink to this headline">#</a></h2>
<p>BIM wants to be sure that their production does not violate the copper constraint, therefore they consider the following robust variant of their optimization model:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrcrcl}
\max    &amp;  12 x_1 &amp; + &amp;   9 x_2               \\
s.t.    &amp;     x_1 &amp;   &amp;         &amp; \leq &amp; 1000 \\
        &amp;         &amp;   &amp;     x_2 &amp; \leq &amp; 1500 \\
        &amp;     x_1 &amp; + &amp;     x_2 &amp; \leq &amp; 1750 \\
        &amp; a_1 x_1 &amp; + &amp; a_2 x_2 &amp; \leq &amp; 4800 &amp; \forall \ell \leq a \leq u \\
        &amp;     x_1 &amp; , &amp;     x_2 &amp; \geq &amp; 0    \\
\end{array}
\end{split}\]</div>
<hr class="docutils" />
<p>The above model has an infinite number of constraints, one for every realization of the uncertain coefficients <span class="math notranslate nohighlight">\(a\)</span>. However, using linear duality, we can deal with this and obtain a LP that we can solve.</p>
<p>The first thing to notice is that the copper consumption is modeled by constraints that are equivalent to bounding the following optimization problem:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrr}
\max    &amp; x_1 a_1 + x_2 a_2 &amp; \leq 4800 \\
s.t.    &amp; \ell \leq a \leq u 
\end{array}
\end{split}\]</div>
<p>Or</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrr}
\max    &amp; x_1 a_1 + x_2 a_2 &amp; \leq 4800 \\
s.t.    &amp; a \leq u \\
        &amp; -a \leq -\ell 
\end{array}
\end{split}\]</div>
<p>Now we use linear duality to realize that the above is equivalent to:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrr}
\min    &amp; u y  - \ell w &amp; \leq 4800 \\
s.t.    &amp; y - w = x \\
        &amp; y \geq 0, w \geq 0
\end{array}
\end{split}\]</div>
<p>and the constraint imposed by the last problem is equivalent to:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrl}
   &amp; u y  - \ell w &amp; \leq 4800 \\
   &amp; y - w &amp; = x \\
   &amp; y \geq 0, w \geq 0
\end{array}
\end{split}\]</div>
<p>The only thing we need to do is add the new auxiliary variables and constraints to the original model and implement them in Pyomo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">BIMWithBoxUncertainty</span><span class="p">(</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span> <span class="p">):</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s1">&#39;BIM with Box Uncertainty&#39;</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">chips</span><span class="p">,</span><span class="n">within</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">profit</span>    <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">]),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">silicon</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;logic&#39;</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">germanium</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;memory&#39;</span><span class="p">]</span>      <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plastic</span>   <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">chips</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">chips</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">robustcopper</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">upper</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">lower</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">4800</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">PerVariable</span><span class="p">(</span> <span class="n">model</span><span class="p">,</span> <span class="n">t</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> 
    
    <span class="n">m</span><span class="o">.</span><span class="n">perVariable</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">chips</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">PerVariable</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lower</span> <span class="o">=</span> <span class="n">upper</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">lower</span><span class="p">[</span><span class="s1">&#39;logic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">upper</span><span class="p">[</span><span class="s1">&#39;logic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">lower</span><span class="p">[</span><span class="s1">&#39;memory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="n">upper</span><span class="p">[</span><span class="s1">&#39;memory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBoxUncertainty</span><span class="p">(</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">)</span>
<span class="n">cbc</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">JustSolution</span><span class="p">(</span> <span class="n">m</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The optimal solution is x= [608.0, 1142.0] and yields a profit of 17574.0
</pre></div>
</div>
</div>
</div>
<p>We may want to impose the box uncertainty set to be symmetric with respect to the nominal values and just choose its width <span class="math notranslate nohighlight">\(\delta\)</span>. This leads to a different optimal robust solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># you can play with the amount of uncertainty. </span>
<span class="c1"># In particular, if below you make delta equal to 0 you obtain the same result as the nominal model.</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="k">def</span> <span class="nf">BIMWithSymmetricalBoxUncertainty</span><span class="p">(</span> <span class="n">delta</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">):</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="p">{</span> <span class="n">chip</span> <span class="p">:</span> <span class="n">copper</span><span class="p">[</span><span class="n">chip</span><span class="p">]</span> <span class="o">-</span> <span class="n">delta</span> <span class="k">for</span> <span class="n">chip</span> <span class="ow">in</span> <span class="n">chips</span> <span class="p">}</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="p">{</span> <span class="n">chip</span> <span class="p">:</span> <span class="n">copper</span><span class="p">[</span><span class="n">chip</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta</span> <span class="k">for</span> <span class="n">chip</span> <span class="ow">in</span> <span class="n">chips</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">BIMWithBoxUncertainty</span><span class="p">(</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span> <span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithSymmetricalBoxUncertainty</span><span class="p">(</span> <span class="n">delta</span> <span class="p">)</span>
<span class="n">cbc</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">JustSolution</span><span class="p">(</span> <span class="n">m</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The optimal solution is x= [606.0, 1144.0] and yields a profit of 17568.0
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="integer-optimization">
<h1>Integer optimization<a class="headerlink" href="#integer-optimization" title="Permalink to this headline">#</a></h1>
<p>The original BIM model gave integer solutions, but not the robust version. If we need integer solutions then we should impose that to the nature of the variables, which in this case of <em>box uncertainty</em> is easy to do since the model remains linear, although it will be mixed integer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBoxUncertainty</span><span class="p">(</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">)</span>
<span class="n">cbc</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">JustSolution</span><span class="p">(</span> <span class="n">m</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The optimal solution is x= [608.0, 1142.0] and yields a profit of 17574.0
</pre></div>
</div>
</div>
</div>
<p>Let us see how the optimal solution behave as we vary the width of the box uncertainty set <span class="math notranslate nohighlight">\(\delta\)</span> from 0 to 0.5.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">.5</span><span class="p">,</span><span class="mi">21</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithSymmetricalBoxUncertainty</span><span class="p">(</span> <span class="n">delta</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">)</span>
    <span class="n">cbc</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span> <span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">)</span> <span class="p">]</span> <span class="o">+</span> <span class="p">[</span> <span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">chips</span> <span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">delta</span><span class="p">,</span><span class="s1">&#39;profit&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">delta</span><span class="p">,</span><span class="n">chips</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">delta</span><span class="p">,</span><span class="n">chips</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>profit</th>
      <th>logic</th>
      <th>memory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.000</th>
      <td>17700.0</td>
      <td>650.0</td>
      <td>1100.0</td>
    </tr>
    <tr>
      <th>0.025</th>
      <td>17634.0</td>
      <td>628.0</td>
      <td>1122.0</td>
    </tr>
    <tr>
      <th>0.050</th>
      <td>17568.0</td>
      <td>606.0</td>
      <td>1144.0</td>
    </tr>
    <tr>
      <th>0.075</th>
      <td>17502.0</td>
      <td>584.0</td>
      <td>1166.0</td>
    </tr>
    <tr>
      <th>0.100</th>
      <td>17436.0</td>
      <td>562.0</td>
      <td>1188.0</td>
    </tr>
    <tr>
      <th>0.125</th>
      <td>17370.0</td>
      <td>540.0</td>
      <td>1210.0</td>
    </tr>
    <tr>
      <th>0.150</th>
      <td>17304.0</td>
      <td>518.0</td>
      <td>1232.0</td>
    </tr>
    <tr>
      <th>0.175</th>
      <td>17238.0</td>
      <td>496.0</td>
      <td>1254.0</td>
    </tr>
    <tr>
      <th>0.200</th>
      <td>17175.0</td>
      <td>475.0</td>
      <td>1275.0</td>
    </tr>
    <tr>
      <th>0.225</th>
      <td>17109.0</td>
      <td>453.0</td>
      <td>1297.0</td>
    </tr>
    <tr>
      <th>0.250</th>
      <td>17043.0</td>
      <td>431.0</td>
      <td>1319.0</td>
    </tr>
    <tr>
      <th>0.275</th>
      <td>16977.0</td>
      <td>409.0</td>
      <td>1341.0</td>
    </tr>
    <tr>
      <th>0.300</th>
      <td>16911.0</td>
      <td>387.0</td>
      <td>1363.0</td>
    </tr>
    <tr>
      <th>0.325</th>
      <td>16845.0</td>
      <td>365.0</td>
      <td>1385.0</td>
    </tr>
    <tr>
      <th>0.350</th>
      <td>16779.0</td>
      <td>343.0</td>
      <td>1407.0</td>
    </tr>
    <tr>
      <th>0.375</th>
      <td>16713.0</td>
      <td>321.0</td>
      <td>1429.0</td>
    </tr>
    <tr>
      <th>0.400</th>
      <td>16650.0</td>
      <td>300.0</td>
      <td>1450.0</td>
    </tr>
    <tr>
      <th>0.425</th>
      <td>16584.0</td>
      <td>278.0</td>
      <td>1472.0</td>
    </tr>
    <tr>
      <th>0.450</th>
      <td>16518.0</td>
      <td>256.0</td>
      <td>1494.0</td>
    </tr>
    <tr>
      <th>0.475</th>
      <td>16416.0</td>
      <td>243.0</td>
      <td>1500.0</td>
    </tr>
    <tr>
      <th>0.500</th>
      <td>16296.0</td>
      <td>233.0</td>
      <td>1500.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can visualize how these quantities change as a function of <span class="math notranslate nohighlight">\(\delta\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">df</span><span class="p">[[</span><span class="s1">&#39;logic&#39;</span><span class="p">,</span><span class="s1">&#39;memory&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bim-robust-optimization_20_0.png" src="../../_images/bim-robust-optimization_20_0.png" />
<img alt="../../_images/bim-robust-optimization_20_1.png" src="../../_images/bim-robust-optimization_20_1.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="cardinality-constrained-uncertainty">
<h1>Cardinality constrained uncertainty<a class="headerlink" href="#cardinality-constrained-uncertainty" title="Permalink to this headline">#</a></h1>
<p>Let us now make different assumptions regarding the uncertainty related to the copper consumption.</p>
<p>More specifically, we now assume that each uncertain coefficient <span class="math notranslate nohighlight">\(a_j\)</span> may deviate by at most <span class="math notranslate nohighlight">\(\pm \delta_j\)</span> from the nominal value <span class="math notranslate nohighlight">\(\bar{a}_j\)</span> bun no more than <span class="math notranslate nohighlight">\(\Gamma\)</span> will actually deviate.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrcrcl}
\max    &amp;  12 x_1 &amp; + &amp;   9 x_2               \\
s.t.    &amp;     x_1 &amp;   &amp;         &amp; \leq &amp; 1000 \\
        &amp;         &amp;   &amp;     x_2 &amp; \leq &amp; 1500 \\
        &amp;     x_1 &amp; + &amp;     x_2 &amp; \leq &amp; 1750 \\
        &amp; a_1 x_1 &amp; + &amp; a_2 x_2 &amp; \leq &amp; 4800 &amp; \forall \, a,y \,:\, a_j=\bar{a}_j+\delta_jy_j, \, \|y\|_\infty \leq 1, \, \|y\|_1\leq \Gamma \\
        &amp;     x_1 &amp; , &amp;     x_2 &amp; \geq &amp; 0    \\
\end{array}
\end{split}\]</div>
<p>Lagrange duality yields the following modification to the problem as equivalent to the robust model stated above:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rrcrcrcrcrcrcl}
\max    &amp;  12 x_1 &amp; + &amp;   9 x_2               \\
s.t.    &amp;     x_1 &amp;   &amp;         &amp; &amp; &amp; &amp; &amp; &amp; &amp; \leq &amp; 1000 \\
        &amp;         &amp;   &amp;     x_2 &amp; &amp; &amp; &amp; &amp; &amp; &amp; \leq &amp; 1500 \\
        &amp;     x_1 &amp; + &amp;     x_2 &amp; &amp; &amp; &amp; &amp; &amp; &amp; \leq &amp; 1750 \\
        &amp; a_1 x_1 &amp; + &amp; a_2 x_2 &amp; + &amp; \lambda\Gamma &amp; + &amp; z_1 &amp; + &amp; z_2 &amp; \leq &amp; 4800 \\
        &amp;-d_1 x_1 &amp;   &amp;         &amp; + &amp; \lambda &amp; + &amp; z_1 &amp;   &amp;     &amp; \geq &amp; 0 \\
        &amp;         &amp;   &amp;-d_2 x_2 &amp; + &amp; \lambda &amp;   &amp;     &amp; + &amp; z_2 &amp; \geq &amp; 0 \\
        &amp;     x_1 &amp; , &amp;     x_2 &amp; , &amp; \lambda &amp; , &amp; z_1 &amp; , &amp; z_2 &amp; \geq &amp; 0    \\
\end{array}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">BIMWithGammaUncertainty</span><span class="p">(</span> <span class="n">delta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span> <span class="p">):</span>
    
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s1">&#39;BIM with Cardinality Constrained Uncertainty&#39;</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">chips</span><span class="p">,</span><span class="n">within</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">profit</span>    <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">]),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">silicon</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;logic&#39;</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">germanium</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;memory&#39;</span><span class="p">]</span>      <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plastic</span>   <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">z</span>   <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">chips</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">robustcopper</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span> \
     <span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">copper</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">])</span> \
          <span class="o">+</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">lam</span> \
          <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4800</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">up_rule</span><span class="p">(</span> <span class="n">model</span><span class="p">,</span> <span class="n">t</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span>  <span class="n">delta</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">lam</span>
    <span class="k">def</span> <span class="nf">down_rule</span><span class="p">(</span> <span class="n">model</span><span class="p">,</span> <span class="n">t</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">delta</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">lam</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">up</span>   <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">chips</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">up_rule</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">chips</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">down_rule</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithGammaUncertainty</span><span class="p">(</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">)</span>
<span class="n">cbc</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">JustSolution</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The optimal solution is x= [641.0, 1109.0] and yields a profit of 17673.0
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="ball-uncertainty-set">
<h1>Ball uncertainty set<a class="headerlink" href="#ball-uncertainty-set" title="Permalink to this headline">#</a></h1>
<p>Let us now make yet another different assumptions regarding the uncertainty related to the copper consumption.</p>
<p>More specifically, we assume that the two uncertain coefficients <span class="math notranslate nohighlight">\(a_1\)</span> and <span class="math notranslate nohighlight">\(a_2\)</span> can vary in a 2-dimensional ball centered around the point <span class="math notranslate nohighlight">\((4,2)\)</span> and with radius 1.</p>
<p>A straightforward reformulation leads to that:</p>
<div class="math notranslate nohighlight">
\[ 
  a_1x_1+a_2x_2 + \Omega \|x\| \leq 4800
\]</div>
<div class="math notranslate nohighlight">
\[
  \Omega \|x\| \leq 4800 - a_1x_1 - a_2x_2
\]</div>
<div class="math notranslate nohighlight">
\[
  \|\Omega x\| \leq 4800 - a_1x_1 - a_2x_2
\]</div>
<p>By defining <span class="math notranslate nohighlight">\(y = 4800 - a_1x_1 - a_2x_2\)</span> we may write:
$<span class="math notranslate nohighlight">\(
  \Omega^2 \|x\|^2 \leq y^2
\)</span>$</p>
<div class="math notranslate nohighlight">
\[
  (\Omega x_1)^2 + (\Omega x_2)^2 \leq y^2
\]</div>
<div class="math notranslate nohighlight">
\[
  \|w\|^2 \leq y^2
\]</div>
<p>with <span class="math notranslate nohighlight">\(w = \Omega x\)</span>.</p>
<p>We now need to add this newly obtained conic constraint to the original BIM model. The <a class="reference external" href="https://pyomo.readthedocs.io/en/stable/library_reference/kernel/conic.html">Pyomo documentation</a> says a conic constraint is expressed in â€˜pyomoâ€™ in simple variables and this <a class="reference external" href="https://pyomo.readthedocs.io/en/stable/library_reference/kernel/syntax_comparison.html">table</a> reports the syntax.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.kernel</span> <span class="k">as</span> <span class="nn">pyk</span>

<span class="k">def</span> <span class="nf">BIMWithBallUncertainty</span><span class="p">(</span> <span class="n">omega</span><span class="p">,</span> <span class="n">domain_type</span><span class="o">=</span><span class="n">pyk</span><span class="o">.</span><span class="n">RealSet</span> <span class="p">):</span>
    
    <span class="n">idxTrophies</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">chips</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">block</span><span class="p">()</span>

    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable_list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxTrophies</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">domain_type</span><span class="o">=</span><span class="n">domain_type</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">profit</span>    <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">profits</span><span class="p">[</span><span class="n">chips</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxTrophies</span><span class="p">),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyk</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">silicon</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">germanium</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plastic</span>   <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxTrophies</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable_list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxTrophies</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pyk</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">copper</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">4800</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">copper</span><span class="p">[</span><span class="n">chips</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxTrophies</span><span class="p">)</span> <span class="p">)</span> 

    <span class="n">m</span><span class="o">.</span><span class="n">xtow</span> <span class="o">=</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint_list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxTrophies</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">xtow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pyk</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>

    <span class="kn">from</span> <span class="nn">pyomo.core.kernel.conic</span> <span class="kn">import</span> <span class="n">quadratic</span>
    <span class="n">m</span><span class="o">.</span><span class="n">robust</span> <span class="o">=</span> <span class="n">quadratic</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<p>Now the optimization problem is nonlinear, but dedicated solver can levarage the fact that is conic and solve it efficiently. Specifically, <code class="docutils literal notranslate"><span class="pre">cplex</span></code>, <code class="docutils literal notranslate"><span class="pre">gurobi</span></code> and <code class="docutils literal notranslate"><span class="pre">xpress</span></code> support second order cones. On the other hand, <code class="docutils literal notranslate"><span class="pre">ipotp</span></code> is a generic solver for nonlinear optimization problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBallUncertainty</span><span class="p">(</span> <span class="mf">0.1</span> <span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">gurobi</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solver status=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;and solver terminal condition=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The optimal solution is x=&#39;</span><span class="p">,[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">))],</span><span class="s1">&#39;and yields a profit of&#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">cplex</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solver status=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;and solver terminal condition=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The optimal solution is x=&#39;</span><span class="p">,[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">))],</span><span class="s1">&#39;and yields a profit of&#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">xpress</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solver status=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;and solver terminal condition=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The optimal solution is x=&#39;</span><span class="p">,[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">))],</span><span class="s1">&#39;and yields a profit of&#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">ipopt</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solver status=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;and solver terminal condition=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The optimal solution is x=&#39;</span><span class="p">,[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">))],</span><span class="s1">&#39;and yields a profit of&#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Solver status= ok and solver terminal condition= optimal
The optimal solution is x= [584.814, 1165.186] and yields a profit of 17504.443

Solver status= ok and solver terminal condition= optimal
The optimal solution is x= [584.814, 1165.186] and yields a profit of 17504.443


Solver status= ok and solver terminal condition= optimal
The optimal solution is x= [584.814, 1165.185] and yields a profit of 17504.441

Solver status= ok and solver terminal condition= optimal
The optimal solution is x= [584.814, 1165.186] and yields a profit of 17504.443
</pre></div>
</div>
</div>
</div>
<p>The solvers <code class="docutils literal notranslate"><span class="pre">cplex</span></code>, <code class="docutils literal notranslate"><span class="pre">gurobi</span></code> and <code class="docutils literal notranslate"><span class="pre">xpress</span></code> are capable of solving the mixed integer version of the same model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBallUncertainty</span><span class="p">(</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">domain_type</span><span class="o">=</span><span class="n">pyk</span><span class="o">.</span><span class="n">IntegerSet</span> <span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">gurobi</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solver status=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;and solver terminal condition=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The optimal solution is x=&#39;</span><span class="p">,[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">))],</span><span class="s1">&#39;and yields a profit of&#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">cplex</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solver status=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;and solver terminal condition=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The optimal solution is x=&#39;</span><span class="p">,[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">))],</span><span class="s1">&#39;and yields a profit of&#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">xpress</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solver status=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;and solver terminal condition=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The optimal solution is x=&#39;</span><span class="p">,[</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">))],</span><span class="s1">&#39;and yields a profit of&#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">pyk</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">profit</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Solver status= ok and solver terminal condition= optimal
The optimal solution is x= [584.0, 1166.0] and yields a profit of 17502.0

Solver status= ok and solver terminal condition= optimal
The optimal solution is x= [584.0, 1166.0] and yields a profit of 17502.0


Solver status= ok and solver terminal condition= optimal
The optimal solution is x= [584.0, 1166.0] and yields a profit of 17502.0
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="how-to-implement-second-order-cones-using-pyomo-environ">
<h1>How to implement second order cones using <code class="docutils literal notranslate"><span class="pre">pyomo.environ</span></code><a class="headerlink" href="#how-to-implement-second-order-cones-using-pyomo-environ" title="Permalink to this headline">#</a></h1>
<p>Noting that <span class="math notranslate nohighlight">\(\| x \| \leq t\)</span> is for <span class="math notranslate nohighlight">\(t \geq 0\)</span> equivalent to <span class="math notranslate nohighlight">\(\| x \|^2 \leq t^2\)</span> and knowing that the commercial solvers (<code class="docutils literal notranslate"><span class="pre">gurobi</span></code>, <code class="docutils literal notranslate"><span class="pre">cplex</span></code> and <code class="docutils literal notranslate"><span class="pre">express</span></code>) support convex quadratic inequalities, we can model this variant in <code class="docutils literal notranslate"><span class="pre">pyomo.environ</span></code> as follows. Note that the essential part to make the model convex is having the right hand side nonnegative.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">BIMWithBallUncertaintyAsSquaredSecondOrderCone</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">):</span>
    
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s1">&#39;BIM with Ball Uncertainty as SOC&#39;</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">chips</span><span class="p">,</span><span class="n">within</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="c1"># the nonegativity of this variable is essential!</span>
    <span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">within</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">profit</span>    <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">profits</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">]),</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">silicon</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;logic&#39;</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">germanium</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;memory&#39;</span><span class="p">]</span>      <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plastic</span>   <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1750</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">copper</span>      <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">4800</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">copper</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">)</span> <span class="p">)</span> 
    <span class="n">m</span><span class="o">.</span><span class="n">robust</span>    <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">omega</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chips</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBallUncertaintyAsSquaredSecondOrderCone</span><span class="p">(</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">cplex</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solver status=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;and solver terminal condition=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="n">JustSolution</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Solver status= ok and solver terminal condition= optimal
The optimal solution is x= [584.0, 1166.0] and yields a profit of 17502.0
</pre></div>
</div>
</div>
</div>
<p>Note how the verbose <code class="docutils literal notranslate"><span class="pre">xpress</span></code> solver confirms that the convex quadratic constraint is recognized as conic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">BIMWithBallUncertaintyAsSquaredSecondOrderCone</span><span class="p">(</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span> <span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">xpress</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">tee</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solver status=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;and solver terminal condition=&#39;</span><span class="p">,</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="p">)</span>
<span class="n">JustSolution</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FICO Xpress v8.14.2, Community, solve started 18:55:47, Oct 25, 2022
Heap usage: 382KB (peak 382KB, 318KB system)
Maximizing MIQCQP BIM with Ball Uncertainty as SOC using up to 12 threads and up to 32GB memory, with these control settings:
OUTPUTLOG = 1
Original problem has:
         5 rows            3 cols            7 elements         2 globals
         1 qrows           3 qrowelem
Converted 1 second order cones to standard form
Presolved problem has:
         7 rows            7 cols           12 elements         2 globals
         2 cones           4 celems
LP relaxation tightened
Presolve finished in 0 seconds
Heap usage: 415KB (peak 417KB, 318KB system)

Coefficient range                    original                 solved        
  Coefficients   [min,max] : [ 1.00e+00,  4.00e+00] / [ 1.00e-01,  1.00e+00]
  RHS and bounds [min,max] : [ 1.00e+03,  4.80e+03] / [ 1.00e+02,  4.80e+03]
  Objective      [min,max] : [ 9.00e+00,  1.20e+01] / [ 9.00e+00,  1.20e+01]
  Quadratic      [min,max] : [ 2.00e-02,  2.00e+00] / [ 2.00e+00,  2.00e+00]
Autoscaling applied standard scaling

Will try to keep branch and bound tree memory usage below 30.3GB
Barrier cache sizes : L1=32K L2=9216K
Using AVX support
Cores per CPU (CORESPERCPU): 12
Barrier starts after 0 seconds, using up to 12 threads, 6 cores
Matrix ordering - Dense cols.:      6   NZ(L):        65   Flops:          204
 
  Its   P.inf      D.inf      U.inf      Primal obj.     Dual obj.      Compl.
   0   1.75e+03   1.20e+01   4.80e+03   2.1000000e+01   1.7150000e+04   2.1e+01
   1   4.73e+02   3.25e+00   1.30e+03   3.7148331e+01   1.7130804e+04   6.2e+00
   2   3.48e+01   2.39e-01   9.56e+01   3.7906861e+02   1.6712679e+04   4.7e-01
   3   1.82e+00   1.25e-02   4.99e+00   5.1718692e+03   1.2952061e+04   2.5e-02
   4   5.17e-01   3.55e-03   1.42e+00   1.4287413e+04   1.6854657e+04   8.0e-03
   5   9.09e-02   6.24e-04   2.50e-01   1.6927027e+04   1.7374898e+04   1.7e-03
   6   7.22e-02   4.96e-04   1.98e-01   1.7031042e+04   1.7374638e+04   1.4e-03
   7   1.84e-02   1.27e-04   5.06e-02   1.7399322e+04   1.7483081e+04   3.7e-04
   8   8.88e-03   6.10e-05   2.44e-02   1.7455817e+04   1.7494083e+04   1.9e-04
   9   3.91e-03   2.69e-05   1.07e-02   1.7483553e+04   1.7500381e+04   8.4e-05
  10   3.27e-03   2.25e-05   8.99e-03   1.7487593e+04   1.7501220e+04   7.2e-05
  11   1.83e-03   1.26e-05   5.03e-03   1.7495119e+04   1.7502724e+04   4.0e-05
  12   1.16e-03   7.94e-06   3.17e-03   1.7498613e+04   1.7503341e+04   2.6e-05
  13   3.73e-04   2.56e-06   1.02e-03   1.7502500e+04   1.7504010e+04   8.5e-06
  14   7.67e-06   5.27e-08   2.11e-05   1.7504405e+04   1.7504436e+04   1.7e-07
  15   1.60e-06   1.10e-08   4.40e-06   1.7504435e+04   1.7504441e+04   3.6e-08
  16   2.38e-07   1.64e-09   6.54e-07   1.7504442e+04   1.7504443e+04   5.4e-09
Barrier method finished in 0 seconds
Crossover crash basis containing 5 structurals form 7 candidates
Crossover starts
 
   Its         Obj Value      S   Ninf  Nneg        Sum Inf  Time
     7       17504.45543      P      0     0        .000000     0
     0       17504.45543      N      0     0        .000000     0
     0       17504.45543      D      0     0        .000000     0
Crossover successful
Objective function value:  17504.44318 time: 0
     0       17504.44318      P      0     0        .000000     0
Optimal solution found
Barrier solved problem
  16 barrier and 7 simplex iterations in 0.01 seconds at time 0

Final objective                       : 1.750444317729157e+04
  Max primal violation      (abs/rel) :       0.0 /       0.0
  Max dual violation        (abs/rel) :       0.0 /       0.0
  Max complementarity viol. (abs/rel) :       0.0 /       0.0

Starting root cutting &amp; heuristics
 
 Its Type    BestSoln    BestBound   Sols    Add    Del     Gap     GInf   Time
k         12000.00000  17504.44318      1                 31.45%       0      0
c         12009.00000  17504.44318      2                 31.39%       0      0
d         12018.00000  17504.44318      3                 31.34%       0      0
k         17502.00000  17502.00000      4                 -0.00%       0      0
 *** Search completed ***
Uncrunching matrix
Final MIP objective                   : 1.750200000000000e+04
Final MIP bound                       : 1.750200000000000e+04
  Solution time / primaldual integral :         0s/ 76.440665%
  Number of solutions found / nodes   :         4 /         1
  Max primal violation      (abs/rel) :       0.0 /       0.0
  Max integer violation     (abs    ) :       0.0

Solver status= ok and solver terminal condition= optimal
The optimal solution is x= [584.0, 1166.0] and yields a profit of 17502.0
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/08"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="08.00.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">8. Robust Optimization - Single Stage Problems</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../09/09.00.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">9. Stochastic Optimization - Single Stage Problems</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The MO Book Group<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>