

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Airline seat allocation problem &#8212; Companion Notebooks for Data-Driven Optimization in Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-DVQ7NZ8CYZ"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-DVQ7NZ8CYZ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/10/airline-seating';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Optimal power flow problem with recourse actions" href="opf-ldr.html" />
    <link rel="prev" title="10. Two-Stage Problems" href="10.00.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo-02.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/logo-02.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Data-Driven Mathematical Optimization in Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/01.00.html">1. Mathematical Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/production-planning.html">A Production Planning Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/production-planning-basic.html">A Basic Pyomo Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/production-planning-advanced.html">A Data-Driven Pyomo Model</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/02.00.html">2. Linear Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/bim.html">BIM production</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/lad-regression.html">LAD Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/mad-portfolio-optimization.html">MAD portfolio optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/L1-regression-wine-quality.html">Wine quality prediction with L1 regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/bim-maxmin.html">BIM production for worst case</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/bim-fractional.html">BIM production variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/bim-rawmaterialplanning.html">BIM production using demand forecasts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/multiproductionfaciliity_worstcase.html">Extra material: Multi-product facility production</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../03/03.00.html">3. Mixed Integer Linear Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../03/bim-perturbed.html">BIM production with perturbed data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/shift-scheduling.html">Workforce shift scheduling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/simple-production-model-gdp.html">Production model using disjunctions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/machine-scheduling.html">Machine Scheduling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/recharging-electric-vehicle.html">Recharging strategy for an electric vehicle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/bim-production-revisited.html">BIM production revisited</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/cryptarithms.html">Extra material: Cryptarithms puzzle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/strip-packing.html">Extra material: Strip packing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/job-shop-scheduling.html">Extra material: Job shop scheduling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/maintenance-planning.html">Extra material: Maintenance planning</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../04/04.00.html">4. Network Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../04/dinner-seat-allocation.html">Dinner seating arrangement</a></li>

<li class="toctree-l2"><a class="reference internal" href="../04/gasoline-distribution.html">Gasoline distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04/cryptocurrency-arbitrage.html">Cryptocurrency arbitrage search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04/power-network.html">Extra material: Energy dispatch problem</a></li>




<li class="toctree-l2"><a class="reference internal" href="../04/forex-arbitrage.html">Forex Arbitrage</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../05/05.00.html">5. Convex Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../05/milk-pooling.html">Milk pooling and blending</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05/ols-regression.html">Ordinary Least Squares (OLS) Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05/markowitz_portfolio.html">Markowitz portfolio optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05/svm.html">Support Vector Machines for Binary Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05/refinery-production.html">Extra material: Refinery production and shadow pricing with CVXPY</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../06/06.00.html">6. Conic Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../06/economic-order-quantity.html">Economic Order Quantity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06/kelly-criterion.html">The Kelly Criterion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06/markowitz_portfolio_revisited.html">Markowitz portfolio optimization revisited</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06/building-insulation.html">Optimal Design of Multilayered Building Insulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06/svm-conic.html">Support Vector Machines Revisited</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06/investment-wheel.html">Extra material: Luenberger’s Investment Wheel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06/optimal-growth-portfolios.html">Extra material: Optimal Growth Portfolios with Risk Aversion</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../07/07.00.html">7. Accounting for Uncertainty: Optimization Meets Reality</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../07/fleet-assignment.html">Fleet assignment problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07/bim-robustness-analysis.html">Robustness analysis of BIM production plan via simulations</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../08/08.00.html">8. Robust Optimization - Single Stage Problems</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../08/bim-robust-optimization.html">Robust BIM microchip production problem</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../09/09.00.html">9. Stochastic Optimization - Single Stage Problems</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../09/pop-up_shop.html">Pop-up shop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09/markowitz_portfolio_with_chance_constraint.html">Markowitz portfolio optimization with chance constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09/seafood.html">Stock optimization for seafood distribution center</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09/economicdispatch.html">Economic dispatch in energy systems</a></li>


</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="10.00.html">10. Two-Stage Problems</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Airline seat allocation problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="opf-ldr.html">Optimal power flow problem with recourse actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="ccg.html">Two-stage Production Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="farmer.html">Extra: The farmer’s problem and its variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="opf-wind-curtailment.html">Extra: Two-stage energy dispatch optimization with wind curtailment</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../appendix/appendix.html">Appendix: Working with Pyomo</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../appendix/pyomo-style-guide.html">Pyomo style guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendix/functional-programming-pyomo.html">Functional Programming with Pyomo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Index</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/mobook/MO-book/blob/main/notebooks/10/airline-seating.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/mobook/MO-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mobook/MO-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/10/airline-seating.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/10/airline-seating.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Airline seat allocation problem</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#attribution">Attribution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-description">Problem description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-and-imports">Installation and imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-data">Problem data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analytics">Analytics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-1-deterministic-solution-for-the-average-demand-scenario">Model 1. Deterministic solution for the average demand scenario</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-2-two-stage-stochastic-optimization-and-its-extensive-form">Model 2. Two-stage stochastic optimization and its extensive form</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-3-adding-chance-constraints">Model 3. Adding chance constraints</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-4-solving-the-case-of-continuous-demand-distributions-using-the-saa-method">Model 4. Solving the case of continuous demand distributions using the SAA method</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scenario-generation-uncorrelated-case">Scenario generation (uncorrelated case)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-5-adding-correlations-between-different-demand-types">Model 5. Adding correlations between different demand types</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-6-tackling-chance-constraints-using-saa-in-the-case-of-correlated-demand">Model 6. Tackling chance constraints using SAA in the case of correlated demand</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <span class="target" id="index-0"></span><span class="target" id="index-1"></span><span class="target" id="index-2"></span><span class="target" id="index-3"></span><span class="target" id="index-4"></span><span class="target" id="index-5"></span><span class="target" id="index-6"></span><section class="tex2jax_ignore mathjax_ignore" id="airline-seat-allocation-problem">
<span id="index-7"></span><h1>Airline seat allocation problem<a class="headerlink" href="#airline-seat-allocation-problem" title="Permalink to this heading">#</a></h1>
<section id="attribution">
<h2>Attribution<a class="headerlink" href="#attribution" title="Permalink to this heading">#</a></h2>
<p>The following problem statement is adapted from an exercise and examples presented by Birge and Louveaux (2011).</p>
<ul class="simple">
<li><p>Birge, J. R., &amp; Louveaux, F. (2011). Introduction to stochastic programming. Springer Science &amp; Business Media.</p></li>
</ul>
<p>The adaptations include a change to parameters for consistency among reformulations of the problem, and additional treatments for sample average approximation (SAA) with chance constraints.</p>
</section>
<section id="problem-description">
<h2>Problem description<a class="headerlink" href="#problem-description" title="Permalink to this heading">#</a></h2>
<p>An airline is deciding how to partition a new plane for the Amsterdam-Buenos Aires route. This plane can seat 200 economy-class passengers. A section can be created for first-class seats, but each of these seats takes the space of 2 economy-class seats. A business-class section can also be created, but each of these takes the space of 1.5 economy-class seats. The profit for a first-class ticket is three times the profit of an economy ticket, while a business-class ticket has a profit of two times an economy ticket’s profit. Once the plane is partitioned into these seating classes, it cannot be changed.</p>
<p>The airlines knows that the plane will not always be full in every section. The airline has initially identified three scenarios to consider with about equal frequency:</p>
<ol class="arabic simple">
<li><p>Weekday morning and evening traffic;</p></li>
<li><p>Weekend traffic; and</p></li>
<li><p>Weekday midday traffic.</p></li>
</ol>
<p>Under Scenario 1 the airline thinks they can sell as many as 20 first-class tickets, 50 business-class tickets, and 200 economy tickets. Under Scenario 2 these figures are 10 , 24, and 175, while under Scenario 3, they are 6, 10, and 150, respectively. The following table summarizes the forecast demand for these three scenarios.</p>
<center>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Scenario</p></th>
<th class="head text-center"><p>First-class seats</p></th>
<th class="head text-center"><p>Business-class seats</p></th>
<th class="head text-center"><p>Economy-class seats</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>(1) weekday morning and evening</p></td>
<td class="text-center"><p>20</p></td>
<td class="text-center"><p>50</p></td>
<td class="text-center"><p>200</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>(2) weekend</p></td>
<td class="text-center"><p>10</p></td>
<td class="text-center"><p>24</p></td>
<td class="text-center"><p>175</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>(3) weekday midday</p></td>
<td class="text-center"><p>6</p></td>
<td class="text-center"><p>10</p></td>
<td class="text-center"><p>150</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Average Scenario</strong></p></td>
<td class="text-center"><p><strong>12</strong></p></td>
<td class="text-center"><p><strong>28</strong></p></td>
<td class="text-center"><p><strong>175</strong></p></td>
</tr>
</tbody>
</table>
</center>
<p>The goal of the airline is to maximize ticket revenue. For marketing purposes, the airline will not sell more tickets than seats in each of the sections (hence no overbooking strategy). We further assume customers seeking a first-class or business-class seat will not downgrade if those seats are unavailable.</p>
</section>
<section id="installation-and-imports">
<h2>Installation and imports<a class="headerlink" href="#installation-and-imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># install pyomo and select solver</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">SOLVER</span> <span class="o">=</span> <span class="s2">&quot;cbc&quot;</span>

<span class="k">if</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
    <span class="o">!</span>pip install highspy &gt;/dev/null
    <span class="n">SOLVER</span> <span class="o">=</span> <span class="s2">&quot;appsi_highs&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="problem-data">
<h2>Problem data<a class="headerlink" href="#problem-data" title="Permalink to this heading">#</a></h2>
<p>Pandas DataFrames and Series are used to encode problem data in the following cell, and to encode problem solutions in subsequent cells.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># scenario data</span>
<span class="n">demand</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;morning and evening&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
        <span class="s2">&quot;weekend&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mi">175</span><span class="p">},</span>
        <span class="s2">&quot;midday&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># global revenue and seat factor data</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">revenue_factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>
<span class="n">seat_factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="analytics">
<h2>Analytics<a class="headerlink" href="#analytics" title="Permalink to this heading">#</a></h2>
<p>Prior to optimization, a useful first step is to prepare an analytics function to display performance for any given allocation of seats. The first-stage decision variables are the number of seats allocated for each class <span class="math notranslate nohighlight">\(c\in C\)</span>. We would like to provide a analysis showing the operational consequences for any proposed allocation of seats. For this purpose, we create a function <code class="docutils literal notranslate"><span class="pre">seat_report()</span></code> that show the tickets that can be sold in each scenario, the resulting revenue, and the unsatisfied demand (‘spillage’).</p>
<p>To establish a basis for analyzing possible solutions to the airline’s problem, this function first is demonstrated for the case where the airplane is configured as entirely economy-class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># function to report analytics for any given seat allocations</span>
<span class="k">def</span> <span class="nf">seat_report</span><span class="p">(</span><span class="n">seats</span><span class="p">,</span> <span class="n">demand</span><span class="p">):</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="n">seats</span><span class="o">.</span><span class="n">index</span>

    <span class="c1"># report seat allocation</span>
    <span class="n">equivalent_seats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;seat allocation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">},</span>
            <span class="s2">&quot;economy equivalent seat allocation&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">c</span><span class="p">:</span> <span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">seat_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span>
            <span class="p">},</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">equivalent_seats</span><span class="p">[</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">equivalent_seats</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Seat Allocation&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">equivalent_seats</span><span class="p">)</span>

    <span class="c1"># tickets sold is the minimum of available seats and demand</span>
    <span class="n">tickets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">demand</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tickets Sold&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">tickets</span><span class="p">)</span>

    <span class="c1"># seats unsold</span>
    <span class="n">unsold</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">unsold</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">-</span> <span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Seats not Sold&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">unsold</span><span class="p">)</span>

    <span class="c1"># spillage (unmet demand)</span>
    <span class="n">spillage</span> <span class="o">=</span> <span class="n">demand</span> <span class="o">-</span> <span class="n">tickets</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Spillage (Unfulfilled Demand)&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">spillage</span><span class="p">)</span>

    <span class="c1"># compute revenue</span>
    <span class="n">revenue</span> <span class="o">=</span> <span class="n">tickets</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">revenue_factor</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Expected Revenue (in units of economy ticket price): </span><span class="si">{</span><span class="n">revenue</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># charts</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">revenue</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Revenue by Scenario&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">revenue</span><span class="o">.</span><span class="n">mean</span><span class="p">()]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Revenue&quot;</span><span class="p">)</span>

    <span class="n">tickets</span><span class="p">[</span><span class="n">classes</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Demand Scenarios&quot;</span>
    <span class="p">)</span>
    <span class="n">demand</span><span class="p">[</span><span class="n">classes</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span>
        <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Demand Scenarios&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Seats&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span>


<span class="c1"># a trial solution</span>
<span class="n">seats_all_economy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">})</span>
<span class="n">seat_report</span><span class="p">(</span><span class="n">seats_all_economy</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>200.0</td>
      <td>200.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>200.0</td>
      <td>200.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tickets Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>0</td>
      <td>0</td>
      <td>200</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0</td>
      <td>0</td>
      <td>175</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>0</td>
      <td>0</td>
      <td>150</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seats not Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0</td>
      <td>0</td>
      <td>25</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>0</td>
      <td>0</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>20</td>
      <td>50</td>
      <td>0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>10</td>
      <td>24</td>
      <td>0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>6</td>
      <td>10</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 175.00
</pre></div>
</div>
<img alt="../../_images/aec05e4113b7e50cb309d28650d7eb0d56ee41906dc25b4d0a38345e96322db4.png" src="../../_images/aec05e4113b7e50cb309d28650d7eb0d56ee41906dc25b4d0a38345e96322db4.png" />
</div>
</div>
</section>
<section id="model-1-deterministic-solution-for-the-average-demand-scenario">
<h2>Model 1. Deterministic solution for the average demand scenario<a class="headerlink" href="#model-1-deterministic-solution-for-the-average-demand-scenario" title="Permalink to this heading">#</a></h2>
<p>A common starting point in stochastic optimization is to solve the deterministic problem where future demands are fixed at their mean values and compute the corresponding optimal solution. The resulting value of the objective has been called the <em>expectation of the expected value problem (EEV)</em> by Birge, or the <em>expected value of the mean (EVM)</em> solution by others.</p>
<p>Let us introduce the set <span class="math notranslate nohighlight">\(C\)</span> of the three possible classes, i.e., <span class="math notranslate nohighlight">\(C=\{F,B,E\}\)</span>. The objective function is to maximize ticket revenue.</p>
<div class="math notranslate nohighlight">
\[
\max_{s_c, t_c} \quad \sum_{c\in C} r_c t_c 
\]</div>
<p>where <span class="math notranslate nohighlight">\(r_c\)</span> is the revenue from selling a ticket for a seat in class <span class="math notranslate nohighlight">\(c\in C\)</span>.</p>
<p>Let <span class="math notranslate nohighlight">\(s_c\)</span> denote the number of seats of class <span class="math notranslate nohighlight">\(c \in C\)</span> installed in the new plane. Let <span class="math notranslate nohighlight">\(f_c\)</span> be the scale factor denoting the number of economy seats displaced by one seat in class <span class="math notranslate nohighlight">\(c \in C\)</span>. Then, since there is a total of 200 economy-class seats that could fit on the plane, the capacity constraint reads as</p>
<div class="math notranslate nohighlight">
\[
    \sum_{c\in C} f_c s_c \leq 200,
\]</div>
<p>Let <span class="math notranslate nohighlight">\(\mu_c\)</span> be the mean demand for seats of class <span class="math notranslate nohighlight">\(c\in C\)</span>, and let <span class="math notranslate nohighlight">\(t_c\)</span> be the number of tickets of class <span class="math notranslate nohighlight">\(c\in C\)</span> that are sold. To ensure we do not sell more tickets than available seats nor more than demand, we need to add two more constraints:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
    t_c &amp; \leq s_c \qquad \forall \, c\in C \\
    t_c &amp; \leq \mu_c \qquad \forall \, c\in C
\end{align*}
\end{split}\]</div>
<p>Lastly, both ticket and seat variables need to be nonnegative integers, so we add the constraints <span class="math notranslate nohighlight">\(\bm{t}, \bm{s} \in \mathbb{Z}_+\)</span>.</p>
<p>The following cell presents a Pyomo model implementing this model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">airline_deterministic</span><span class="p">(</span><span class="n">demand</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s2">&quot;Airline seating (deterministic)&quot;</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">demand</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="c1"># first stage variables and constraints</span>
    <span class="n">m</span><span class="o">.</span><span class="n">seats</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">plane_seats</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">seat_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">capacity</span>

    <span class="c1"># second stage variable and constraints</span>
    <span class="n">m</span><span class="o">.</span><span class="n">tickets</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">demand_limits</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">demand</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">seat_limits</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>

    <span class="c1"># objective</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">revenue</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">revenue_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>


<span class="k">def</span> <span class="nf">airline_solve</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">c</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">})</span>


<span class="c1"># Solve deterministic model to obtain the expectation of the expected value problem (EEV)</span>
<span class="n">model_eev</span> <span class="o">=</span> <span class="n">airline_deterministic</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>
<span class="n">seats_eev</span> <span class="o">=</span> <span class="n">airline_solve</span><span class="p">(</span><span class="n">model_eev</span><span class="p">)</span>
<span class="n">seat_report</span><span class="p">(</span><span class="n">seats_eev</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>12.0</td>
      <td>28.0</td>
      <td>134.0</td>
      <td>174.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>24.0</td>
      <td>42.0</td>
      <td>134.0</td>
      <td>200.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tickets Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>12.0</td>
      <td>28.0</td>
      <td>134.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>10.0</td>
      <td>24.0</td>
      <td>134.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>6.0</td>
      <td>10.0</td>
      <td>134.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seats not Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>2.0</td>
      <td>4.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>6.0</td>
      <td>18.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>8.0</td>
      <td>22.0</td>
      <td>66.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>41.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>16.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 203.33
</pre></div>
</div>
<img alt="../../_images/dd9444138203cd364755cc3cf7e85c0058b4a1258ee3a0cd5fb1afdcf95bc9ed.png" src="../../_images/dd9444138203cd364755cc3cf7e85c0058b4a1258ee3a0cd5fb1afdcf95bc9ed.png" />
</div>
</div>
</section>
<section id="model-2-two-stage-stochastic-optimization-and-its-extensive-form">
<h2>Model 2. Two-stage stochastic optimization and its extensive form<a class="headerlink" href="#model-2-two-stage-stochastic-optimization-and-its-extensive-form" title="Permalink to this heading">#</a></h2>
<p>If we assume demand is not certain, we can formulate a two-stage stochastic optimization problem. The first-stage or here-and-now variables are the <span class="math notranslate nohighlight">\(s_c\)</span>’s, those related to the seat allocations. Due to their dependence on the realized demand <span class="math notranslate nohighlight">\(\bm{z}\)</span>, the variables <span class="math notranslate nohighlight">\(t_c\)</span>’s describing the number of tickets sold, are second-stage or recourse decision variables. The full problem formulation is as follows: the first stage problem is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
    \max \quad &amp; \mathbb E_{z} Q(\bm{s},\bm{z}) \\
    \textup{ s.t. } \quad &amp; \sum_{c\in C} f_c s_c \leq 200,\\
    &amp; \bm{s} \in \mathbb{Z}_+,
\end{align*}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(Q(\bm{s},\bm{z})\)</span> is the value of the second-stage problem, defined as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
    Q(\bm{s},\bm{z}) := \max \quad &amp; \sum_{c\in C} r_c t_{c}\\
    \textup{ s.t. } \quad 
    &amp; t_c \leq s_c &amp; \forall \, c\in C \\
    &amp; t_c \leq z_c &amp; \forall \, c\in C \\
    &amp; \bm{t} \in \mathbb{Z}_+.
\end{align*}
\end{split}\]</div>
<p>In view of the assumption that there is only a finite number <span class="math notranslate nohighlight">\(N=|S|\)</span> of scenarios for ticket demand, we can write the extensive form of the two-stage stochastic optimization problem above and solve it exactly. To do so, we modify the second-stage variables <span class="math notranslate nohighlight">\(t_{c,s}\)</span> so that they are indexed by both class <span class="math notranslate nohighlight">\(c\)</span> and scenario <span class="math notranslate nohighlight">\(s\)</span>. The expectation can thus be replaced with the average revenue over the <span class="math notranslate nohighlight">\(N\)</span> scenarios, that is</p>
<div class="math notranslate nohighlight">
\[
\max \quad \sum_{s \in S} \frac{1}{N} \sum_{c\in C}  r_c t_{c, s},
\]</div>
<p>where the fraction <span class="math notranslate nohighlight">\(\frac{1}{N}\)</span> appears since we assume that all <span class="math notranslate nohighlight">\(N\)</span> scenarios are equally likely. The first stage constraint remains unchanged, while the second stage constraints are tuplicated for each scenario <span class="math notranslate nohighlight">\(s \in S\)</span>, namely</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
t_{c,s} &amp; \leq s_c &amp; \forall \, c\in C \\
t_{c,s} &amp; \leq z_{c, s} &amp; \forall \, (c, s) \in C \times S
\end{align*}
\end{split}\]</div>
<p>The following cell presents a Pyomo model implementing this model and solving it for the <span class="math notranslate nohighlight">\(N=3\)</span> equiprobable scenarios introduced above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">airline_stochastic</span><span class="p">(</span><span class="n">demand</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s2">&quot;Airline seating (stochastic)&quot;</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">demand</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">demand</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># first stage variables and constraints</span>
    <span class="n">m</span><span class="o">.</span><span class="n">seats</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">plane_seats</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">seat_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">capacity</span>

    <span class="c1"># second stage variable and constraints</span>
    <span class="n">m</span><span class="o">.</span><span class="n">tickets</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">demand_limits</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">demand</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">seat_limits</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>

    <span class="c1"># objective</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">revenue</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">revenue_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>


<span class="c1"># create and solve model for the three scenarios defined above</span>
<span class="n">model_stochastic</span> <span class="o">=</span> <span class="n">airline_stochastic</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>
<span class="n">seats_stochastic</span> <span class="o">=</span> <span class="n">airline_solve</span><span class="p">(</span><span class="n">model_stochastic</span><span class="p">)</span>
<span class="n">seat_report</span><span class="p">(</span><span class="n">seats_stochastic</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>10.0</td>
      <td>20.0</td>
      <td>150.0</td>
      <td>180.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>20.0</td>
      <td>30.0</td>
      <td>150.0</td>
      <td>200.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tickets Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>10.0</td>
      <td>20.0</td>
      <td>150.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>10.0</td>
      <td>20.0</td>
      <td>150.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>6.0</td>
      <td>10.0</td>
      <td>150.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seats not Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>4.0</td>
      <td>10.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>10.0</td>
      <td>30.0</td>
      <td>50.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0.0</td>
      <td>4.0</td>
      <td>25.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 209.33
</pre></div>
</div>
<img alt="../../_images/6d717b9c0df99f8d8522c0745e2d99097805c028a954604c6b1efb25fd5a807d.png" src="../../_images/6d717b9c0df99f8d8522c0745e2d99097805c028a954604c6b1efb25fd5a807d.png" />
</div>
</div>
</section>
<section id="model-3-adding-chance-constraints">
<h2>Model 3. Adding chance constraints<a class="headerlink" href="#model-3-adding-chance-constraints" title="Permalink to this heading">#</a></h2>
<p>The airline wishes a special guarantee for its clients enrolled in its loyalty program. In particular, it wants <span class="math notranslate nohighlight">\(98\%\)</span> probability to cover the demand of first-class seats and <span class="math notranslate nohighlight">\(95\%\)</span> probability to cover the demand of business-class seats (by clients of the loyalty program). First-class passengers are covered if they can purchase a first-class seat. Business-class passengers are covered if they purchase a business-class seat or upgrade to a first-class seat.</p>
<p>Assume the demand of loyalty-program passengers is normally distributed as <span class="math notranslate nohighlight">\(z_F \sim \mathcal N(\mu_F, \sigma_F^2)\)</span> and <span class="math notranslate nohighlight">\(z_B \sim \mathcal N(\mu_B, \sigma_B^2)\)</span> for first-class and business, respectively, where the parameters are given in the table below. For completeness, we also include the parameters for economy-class passengers.</p>
<center>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\mu_{\cdot}\)</span></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\sigma_{\cdot}\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p>F</p></td>
<td class="text-center"><p>12</p></td>
<td class="text-center"><p>4</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>B</p></td>
<td class="text-center"><p>28</p></td>
<td class="text-center"><p>8</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>E</p></td>
<td class="text-center"><p>175</p></td>
<td class="text-center"><p>20</p></td>
</tr>
</tbody>
</table>
</center>
<p>We further assume that the demands for first-class and business-class seats are independent of each other and of the scenario (time of the week).</p>
<p>Let <span class="math notranslate nohighlight">\(s_F\)</span> be the number of first-class seats and <span class="math notranslate nohighlight">\(s_B\)</span> the number of business seats. The probabilistic constraints are</p>
<div class="math notranslate nohighlight">
\[
\mathbb P(s_F \geq z_F ) \geq 0.98, \qquad \text{ and } \qquad \mathbb P(s_F + s_B \geq z_F + z_B ) \geq 0.95.
\]</div>
<p>These are can be written equivalently as linear constraints, specifically</p>
<div class="math notranslate nohighlight">
\[
\frac{s_F - \mu_F}{\sigma_F} \geq \Phi^{-1}(0.98) \approx 2.054 \qquad \text{ and } \qquad \frac{(s_F + s_B) - (\mu_F + \mu_B)}{\sqrt{\sigma_F^2 + \sigma_B^2}} \geq \Phi^{-1}(0.95) \approx 1.645.
\]</div>
<p>For the second constraint, we use the fact that the sum of the two independent random variables <span class="math notranslate nohighlight">\(z_F\)</span> and <span class="math notranslate nohighlight">\(z_B\)</span> is normally distributed with mean <span class="math notranslate nohighlight">\(\mu_F + \mu_B\)</span> and variance <span class="math notranslate nohighlight">\(\sigma_F^2 + \sigma_B^2\)</span>.</p>
<p>We add these equivalent linear counterparts of the two chance constraints to the stochastic optimization model. Rather than writing a function to create a whole new model, we can use the prior function to create and add the two chance constraints using decorators.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the scipy.stats.norm object needed to use the quantile function of the standard normal distribution</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="c1"># define the mean and standard deviation of the demand for each class</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="p">}))</span>


<span class="c1"># create a new model with chance constraints that takes as input also</span>
<span class="c1"># the target quality of service (QoS) levels for classes F and B</span>
<span class="k">def</span> <span class="nf">airline_cc</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">QoSF</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">QoSFB</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
    <span class="c1"># create two-stage stochastic model as before</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">airline_stochastic</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>

    <span class="c1"># add equivalent counterparts of the two chance constraints to the first stage problem</span>
    <span class="c1"># the two coefficients related the inverse CDF of the standard normal are computed using the norm.ppf function</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">first_class</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mu</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">QoSF</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">business_class</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">mu</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span>
            <span class="n">QoSFB</span>
        <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">sigma</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>


<span class="c1"># create and solve model</span>
<span class="n">model_cc</span> <span class="o">=</span> <span class="n">airline_cc</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>
<span class="n">seats_cc</span> <span class="o">=</span> <span class="n">airline_solve</span><span class="p">(</span><span class="n">model_cc</span><span class="p">)</span>
<span class="n">seat_report</span><span class="p">(</span><span class="n">seats_cc</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mu</th>
      <th>sigma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>12.0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>B</th>
      <td>28.0</td>
      <td>16</td>
    </tr>
    <tr>
      <th>E</th>
      <td>175.0</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>21.0</td>
      <td>47.0</td>
      <td>87.0</td>
      <td>155.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>42.0</td>
      <td>70.5</td>
      <td>87.0</td>
      <td>199.5</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tickets Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>20.0</td>
      <td>47.0</td>
      <td>87.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>10.0</td>
      <td>24.0</td>
      <td>87.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>6.0</td>
      <td>10.0</td>
      <td>87.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seats not Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>11.0</td>
      <td>23.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>15.0</td>
      <td>37.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>0.0</td>
      <td>3.0</td>
      <td>113.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>88.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>63.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 177.00
</pre></div>
</div>
<img alt="../../_images/8e7c42c6f90ca7f835e4e98f0bca53dedff4b75d713ce9700847c711f9a92a46.png" src="../../_images/8e7c42c6f90ca7f835e4e98f0bca53dedff4b75d713ce9700847c711f9a92a46.png" />
</div>
</div>
</section>
<section id="model-4-solving-the-case-of-continuous-demand-distributions-using-the-saa-method">
<h2>Model 4. Solving the case of continuous demand distributions using the SAA method<a class="headerlink" href="#model-4-solving-the-case-of-continuous-demand-distributions-using-the-saa-method" title="Permalink to this heading">#</a></h2>
<p>Let us now move past the simplifying assumption that there are only three equally likely scenarios and consider the case where the demand is described by a random vector <span class="math notranslate nohighlight">\((z_F, z_B, z_E)\)</span>, where <span class="math notranslate nohighlight">\(z_c\)</span> is the demand for seats of class <span class="math notranslate nohighlight">\(c\in C\)</span>. The demand for class <span class="math notranslate nohighlight">\(c\)</span> is assumed to be independent and normally distributed with mean <span class="math notranslate nohighlight">\(\mu_c\)</span> and variance <span class="math notranslate nohighlight">\(\sigma_c^2\)</span> as reported in the following table</p>
<center>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\mu\)</span></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(\sigma\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p>F</p></td>
<td class="text-center"><p>12</p></td>
<td class="text-center"><p>4</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>B</p></td>
<td class="text-center"><p>28</p></td>
<td class="text-center"><p>8</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>E</p></td>
<td class="text-center"><p>175</p></td>
<td class="text-center"><p>20</p></td>
</tr>
</tbody>
</table>
</center>
<p>Note that we model the demand for each class using a continuous random variable, which is a simplification of the real world, where the ticket demand is always a discrete nonnegative number. Therefore, we round down all the obtained random numbers.</p>
<p>However, now that the number of scenarios is not finite anymore, we cannot solve the problem exactly. Instead, we can use the SAA method to approximate the expected value appearing in the objective function. The first step of the SAA is to generate a collection of <span class="math notranslate nohighlight">\(N\)</span> scenarios <span class="math notranslate nohighlight">\((z_{F,s}, z_{B,s}, z_{E,s})\)</span> for <span class="math notranslate nohighlight">\(s=1,\ldots,N\)</span>. We can do this by sampling from the normal distributions with the given means and variances.</p>
<p>For sake of generality, we create a script to generate scenarios in which the three demands have a general correlation structure captured by a correlation matrix <span class="math notranslate nohighlight">\(\bm{\rho}\)</span>.</p>
<section id="scenario-generation-uncorrelated-case">
<h3>Scenario generation (uncorrelated case)<a class="headerlink" href="#scenario-generation-uncorrelated-case" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sample size</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># define the mean mu and standard deviation sigma of the demand for each class</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
<span class="n">classes</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># build covariance matrix from covariances and correlations</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sigma</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Model Covariance&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">classes</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># generate N samples, round each demand entry to nearest integer, and correct non-negative values</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
<span class="n">demand_saa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">classes</span><span class="p">)</span>
<span class="n">demand_saa</span><span class="p">[</span><span class="n">demand_saa</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># report sample means and standard deviations for each class</span>
<span class="n">demand_saa_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;mu (mean)&quot;</span><span class="p">:</span> <span class="n">mu</span><span class="p">,</span>
        <span class="s2">&quot;sample mean&quot;</span><span class="p">:</span> <span class="n">demand_saa</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;sigma (std)&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="p">,</span>
        <span class="s2">&quot;sample std&quot;</span><span class="p">:</span> <span class="n">demand_saa</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">demand_saa_stats</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ci</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">classes</span><span class="p">):</span>
    <span class="n">demand_saa</span><span class="p">[</span><span class="n">ci</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Histogram demand class </span><span class="si">{</span><span class="n">ci</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model Covariance
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>16</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>B</th>
      <td>0</td>
      <td>256</td>
      <td>0</td>
    </tr>
    <tr>
      <th>E</th>
      <td>0</td>
      <td>0</td>
      <td>400</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mu (mean)</th>
      <th>sample mean</th>
      <th>sigma (std)</th>
      <th>sample std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>12.0</td>
      <td>11.889</td>
      <td>4</td>
      <td>4.088936</td>
    </tr>
    <tr>
      <th>B</th>
      <td>28.0</td>
      <td>28.626</td>
      <td>16</td>
      <td>15.051534</td>
    </tr>
    <tr>
      <th>E</th>
      <td>175.0</td>
      <td>172.966</td>
      <td>20</td>
      <td>19.839669</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../../_images/41168d302d65513a23b33648085b60ecd1e2197c03f5caffca7b217c055890a0.png" src="../../_images/41168d302d65513a23b33648085b60ecd1e2197c03f5caffca7b217c055890a0.png" />
</div>
</div>
<p>We also introduce a new function to report the solution and its features in this more general continuous demand case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># function to report analytics for SAA case</span>
<span class="k">def</span> <span class="nf">seat_report_saa</span><span class="p">(</span><span class="n">seats</span><span class="p">,</span> <span class="n">demand</span><span class="p">):</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="n">seats</span><span class="o">.</span><span class="n">index</span>

    <span class="c1"># report seat allocation</span>
    <span class="n">equivalent_seats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;seat allocation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">},</span>
            <span class="s2">&quot;economy equivalent seat allocation&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">c</span><span class="p">:</span> <span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">seat_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span>
            <span class="p">},</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">equivalent_seats</span><span class="p">[</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">equivalent_seats</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Seat Allocation&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">equivalent_seats</span><span class="p">)</span>

    <span class="c1"># tickets sold</span>
    <span class="n">tickets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">demand</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mean Tickets Sold&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">tickets</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="c1"># seats unsold</span>
    <span class="n">unsold</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">unsold</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">-</span> <span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mean Seats not Sold&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">unsold</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="c1"># spillage (unmet demand)</span>
    <span class="n">spillage</span> <span class="o">=</span> <span class="n">demand</span> <span class="o">-</span> <span class="n">tickets</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mean Spillage (Unfulfilled Demand)&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">spillage</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="c1"># compute revenue</span>
    <span class="n">revenue</span> <span class="o">=</span> <span class="n">tickets</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">revenue_factor</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Expected Revenue (in units of economy ticket price): </span><span class="si">{</span><span class="n">revenue</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># charts</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">revenue</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Revenue Histogram&quot;</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">classes</span><span class="p">):</span>
        <span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">demand</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;Tickets Sold&quot;</span><span class="p">,</span> <span class="s2">&quot;Demand&quot;</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<p>We can now solve the stochastic optimization problem using the generated <span class="math notranslate nohighlight">\(N=1000\)</span> scenarios. Note that we can use the previously defined function <code class="docutils literal notranslate"><span class="pre">airline_stochastic</span></code> to solve the model by simply calling it with a different dataframe as argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_ssa</span> <span class="o">=</span> <span class="n">airline_stochastic</span><span class="p">(</span><span class="n">demand_saa</span><span class="p">)</span>
<span class="n">seats_saa</span> <span class="o">=</span> <span class="n">airline_solve</span><span class="p">(</span><span class="n">model_ssa</span><span class="p">)</span>
<span class="n">seat_report_saa</span><span class="p">(</span><span class="n">seats_saa</span><span class="p">,</span> <span class="n">demand_saa</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>11.0</td>
      <td>20.0</td>
      <td>148.0</td>
      <td>179.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>22.0</td>
      <td>30.0</td>
      <td>148.0</td>
      <td>200.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Tickets Sold
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F      9.764
B     17.416
E    147.056
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Seats not Sold
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F    1.236
B    2.584
E    0.944
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F     2.125
B    11.210
E    25.910
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 211.18
</pre></div>
</div>
<img alt="../../_images/2ea558f42b3d4c8ba2ab1c80d56cc99b1ea2b54ce303557c4c8f64d06065de6f.png" src="../../_images/2ea558f42b3d4c8ba2ab1c80d56cc99b1ea2b54ce303557c4c8f64d06065de6f.png" />
<img alt="../../_images/69b9adbfe76df9e2076dfe66fede2b5ead8aa814aa83c9f427f28965183015e6.png" src="../../_images/69b9adbfe76df9e2076dfe66fede2b5ead8aa814aa83c9f427f28965183015e6.png" />
</div>
</div>
</section>
</section>
<section id="model-5-adding-correlations-between-different-demand-types">
<h2>Model 5. Adding correlations between different demand types<a class="headerlink" href="#model-5-adding-correlations-between-different-demand-types" title="Permalink to this heading">#</a></h2>
<p>Now assume the ticket demand for the three categories is captured by a <span class="math notranslate nohighlight">\(3\)</span>-dimensional multivariate normal distribution mean <span class="math notranslate nohighlight">\(\mu=(\mu_F, \mu_B, \mu_E)\)</span>, variances <span class="math notranslate nohighlight">\((\sigma_F^2, \sigma_B^2, \sigma_E^2)\)</span> and a symmetric correlation matrix</p>
<div class="math notranslate nohighlight">
\[\begin{split}
P = \left(
\begin{array}{ccc}
1 &amp; \rho_{FB} &amp; \rho_{FE} \\
\rho_{BF} &amp; 1 &amp; \rho_{BE}\\
\rho_{EF} &amp; \rho_{EB} &amp; 1 \\
\end{array}
\right)
\end{split}\]</div>
<p>The covariance matrix is given by <span class="math notranslate nohighlight">\(\Sigma = \text{diag}(\sigma)\ P\ \text{diag}(\sigma)\)</span> or</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\Sigma= \left(
\begin{array}{ccc}
 \sigma_F^2 &amp; \rho_{FB}\sigma_F\sigma_B &amp; \rho_{FE}\sigma_F\sigma_E \\
\rho_{BF}\sigma_B\sigma_F &amp; \sigma_B^2 &amp; \rho_{BE}\sigma_B\sigma_E\\
\rho_{EF}\sigma_E\sigma_F &amp; \rho_{EB}\sigma_E\sigma_B &amp; \sigma_E^2 \\
\end{array}
\right)
\end{split}\]</div>
<p>We assume <span class="math notranslate nohighlight">\(\rho_{FB} = 0.6\)</span>, <span class="math notranslate nohighlight">\(\rho_{BE} = 0.4\)</span> and <span class="math notranslate nohighlight">\(\rho_{FE} = 0.2\)</span>.</p>
<p>We now sample <span class="math notranslate nohighlight">\(N=1000\)</span> scenarios from this multivariate correlated normal distribution and use the SAA method to approximate the solution of the two-stage stochastic optimization problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sample size</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># define the mean mu and standard deviation sigma of the demand for each class</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="p">}))</span>

<span class="c1"># correlation matrix</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

<span class="c1"># build covariance matrix from covariances and correlations</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sigma</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">@</span> <span class="n">P</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># create samples</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>

<span class="c1"># truncate to integers and non-negative values</span>
<span class="n">classes</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">columns</span>
<span class="n">demand_saa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">classes</span><span class="p">)</span>
<span class="n">demand_saa</span><span class="p">[</span><span class="n">demand_saa</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample means&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">demand_saa</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample std dev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">demand_saa</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Model Covariance&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">classes</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sample Covariance&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">demand_saa</span><span class="o">.</span><span class="n">cov</span><span class="p">()))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ci</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">classes</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">cj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">classes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">demand_saa</span><span class="p">[</span><span class="n">ci</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Histogram </span><span class="si">{</span><span class="n">ci</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">demand_saa</span><span class="p">[</span><span class="n">ci</span><span class="p">],</span> <span class="n">demand_saa</span><span class="p">[</span><span class="n">cj</span><span class="p">],</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ci</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">cj</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Convariance: </span><span class="si">{</span><span class="n">ci</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">cj</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mu</th>
      <th>sigma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>12.0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>B</th>
      <td>28.0</td>
      <td>16</td>
    </tr>
    <tr>
      <th>E</th>
      <td>175.0</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mu</th>
      <th>sample means</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>12.0</td>
      <td>12.012</td>
    </tr>
    <tr>
      <th>B</th>
      <td>28.0</td>
      <td>28.590</td>
    </tr>
    <tr>
      <th>E</th>
      <td>175.0</td>
      <td>175.301</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sigma</th>
      <th>sample std dev</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>4</td>
      <td>3.951388</td>
    </tr>
    <tr>
      <th>B</th>
      <td>16</td>
      <td>15.139984</td>
    </tr>
    <tr>
      <th>E</th>
      <td>20</td>
      <td>20.147365</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model Covariance
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>16.0</td>
      <td>38.4</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>B</th>
      <td>38.4</td>
      <td>256.0</td>
      <td>128.0</td>
    </tr>
    <tr>
      <th>E</th>
      <td>16.0</td>
      <td>128.0</td>
      <td>400.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sample Covariance
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>15.613469</td>
      <td>36.044965</td>
      <td>12.434823</td>
    </tr>
    <tr>
      <th>B</th>
      <td>36.044965</td>
      <td>229.219119</td>
      <td>107.216627</td>
    </tr>
    <tr>
      <th>E</th>
      <td>12.434823</td>
      <td>107.216627</td>
      <td>405.916315</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../../_images/133ae3d32ff19c43e68cb11078dd7c96753e835aecc3877520692c5b12a62e12.png" src="../../_images/133ae3d32ff19c43e68cb11078dd7c96753e835aecc3877520692c5b12a62e12.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_ssa</span> <span class="o">=</span> <span class="n">airline_stochastic</span><span class="p">(</span><span class="n">demand_saa</span><span class="p">)</span>
<span class="n">seats_saa</span> <span class="o">=</span> <span class="n">airline_solve</span><span class="p">(</span><span class="n">model_ssa</span><span class="p">)</span>
<span class="n">seat_report_saa</span><span class="p">(</span><span class="n">seats_saa</span><span class="p">,</span> <span class="n">demand_saa</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>11.0</td>
      <td>20.0</td>
      <td>148.0</td>
      <td>179.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>22.0</td>
      <td>30.0</td>
      <td>148.0</td>
      <td>200.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Tickets Sold
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F      9.863
B     17.303
E    147.184
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Seats not Sold
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F    1.137
B    2.697
E    0.816
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F     2.149
B    11.287
E    28.117
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 211.38
</pre></div>
</div>
<img alt="../../_images/ef992eaadb2a2e6a9e2ff1a45bfc363a8537ac01c74b81c6d0cee8f668e7369f.png" src="../../_images/ef992eaadb2a2e6a9e2ff1a45bfc363a8537ac01c74b81c6d0cee8f668e7369f.png" />
<img alt="../../_images/2ba8784408ac99124215a4d8aab3c24e66745d422b3ac6b5c9a2b6b8a1792825.png" src="../../_images/2ba8784408ac99124215a4d8aab3c24e66745d422b3ac6b5c9a2b6b8a1792825.png" />
</div>
</div>
</section>
<section id="model-6-tackling-chance-constraints-using-saa-in-the-case-of-correlated-demand">
<h2>Model 6. Tackling chance constraints using SAA in the case of correlated demand<a class="headerlink" href="#model-6-tackling-chance-constraints-using-saa-in-the-case-of-correlated-demand" title="Permalink to this heading">#</a></h2>
<p>The linear counterparts of the chance constraints used above in Model 3 were derived under the assumption of independent normal distributions of demand for first-class and business travel. That assumption no longer holds for the case where demand scenarios are sampled from correlated distributions.</p>
<p>This final model replaces the chance constraints by approximating them using two linear constraints that explicitly track unsatisfied demand. In doing so, we introduce two new sets of integer variables <span class="math notranslate nohighlight">\(y_s\)</span> and <span class="math notranslate nohighlight">\(w_s\)</span> and a big-M constant and approximate the true multivariate distribution with the empirical one obtained from the sample.</p>
<p>The first stage remains unchanged and so does the objective value of the second stage. The adjusted second-stage constraints are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
    t_c &amp; \leq s_c &amp; \forall c\in C \\
    t_c &amp; \leq z_{c, s} &amp; \forall (c, s) \in C \times S \\
    s_F + M y_s &amp; \geq z_{F, s} &amp; \forall s \in  S\\
    s_F + s_B + M w_s &amp; \geq z_{F, s} + z_{B,s} &amp; \forall s \in  S \\
    \frac{1}{N} \sum_{s\in S} y_s &amp; \leq 1 - 0.98 \\
    \frac{1}{N} \sum_{s\in S} z_s &amp; \leq 1 - 0.95
\end{align*}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(y_s\)</span> and <span class="math notranslate nohighlight">\(w_s\)</span> are binary variables indicating those scenarios which do not satisfy the requirements of the airline’s loyalty programs for first-class and business-class passengers.</p>
<p>The following cell implements this new model. Note that the running time for the cell can be up to a few minutes for a large number of scenarios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define big M constant for chance constraints counterparts</span>
<span class="n">bigM</span> <span class="o">=</span> <span class="mi">100</span>


<span class="k">def</span> <span class="nf">airline_final</span><span class="p">(</span><span class="n">demand</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>

    <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">demand</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">demand</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># first stage variables and constraints</span>
    <span class="n">m</span><span class="o">.</span><span class="n">seats</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">plane_seats</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">seat_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">capacity</span>

    <span class="c1"># second stage variable and constraints</span>
    <span class="n">m</span><span class="o">.</span><span class="n">tickets</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">first_class</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">business_class</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">demand_limits</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">demand</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">seat_limits</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">first_class_loyality</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bigM</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">first_class</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">demand</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">first_class_loyality_rate</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">first_class</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span>
        <span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">business_class_loyality</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bigM</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">business_class</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
            <span class="o">&gt;=</span> <span class="n">demand</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="n">demand</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">business_class_loyality_rate</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">business_class</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span>
        <span class="p">)</span>

    <span class="c1"># objective</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">revenue</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">revenue_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>


<span class="c1"># create model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">airline_final</span><span class="p">(</span><span class="n">demand_saa</span><span class="p">)</span>
<span class="n">seats</span> <span class="o">=</span> <span class="n">airline_solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">seat_report_saa</span><span class="p">(</span><span class="n">seats</span><span class="p">,</span> <span class="n">demand_saa</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>20.0</td>
      <td>50.0</td>
      <td>85.0</td>
      <td>155.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>40.0</td>
      <td>75.0</td>
      <td>85.0</td>
      <td>200.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Tickets Sold
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F    11.995
B    28.031
E    85.000
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Seats not Sold
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F     8.005
B    21.969
E     0.000
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F     0.017
B     0.559
E    90.301
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 177.05
</pre></div>
</div>
<img alt="../../_images/72ede3091c5ccf0068d1e972481950c647421ec90304ad32a9e55558da186dd8.png" src="../../_images/72ede3091c5ccf0068d1e972481950c647421ec90304ad32a9e55558da186dd8.png" />
<img alt="../../_images/1813465705cf13f818ee5ff8163f581473ce9828629f186e89c43cc0171c96fb.png" src="../../_images/1813465705cf13f818ee5ff8163f581473ce9828629f186e89c43cc0171c96fb.png" />
</div>
</div>
<p><strong>Exercise</strong></p>
<p>Compared the results of using positive correlation in demand for first and business-class tickets results in lower expected revenue. What happens if there is no correlation, or there is negative correlation? Verify your predictions by simulation.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/10"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="10.00.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">10. Two-Stage Problems</p>
      </div>
    </a>
    <a class="right-next"
       href="opf-ldr.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Optimal power flow problem with recourse actions</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#attribution">Attribution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-description">Problem description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-and-imports">Installation and imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-data">Problem data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analytics">Analytics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-1-deterministic-solution-for-the-average-demand-scenario">Model 1. Deterministic solution for the average demand scenario</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-2-two-stage-stochastic-optimization-and-its-extensive-form">Model 2. Two-stage stochastic optimization and its extensive form</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-3-adding-chance-constraints">Model 3. Adding chance constraints</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-4-solving-the-case-of-continuous-demand-distributions-using-the-saa-method">Model 4. Solving the case of continuous demand distributions using the SAA method</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scenario-generation-uncorrelated-case">Scenario generation (uncorrelated case)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-5-adding-correlations-between-different-demand-types">Model 5. Adding correlations between different demand types</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-6-tackling-chance-constraints-using-saa-in-the-case-of-correlated-demand">Model 6. Tackling chance constraints using SAA in the case of correlated demand</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner">
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The MO Book Group
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div></div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>