
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Airline seat allocation problem &#8212; Companion Notebooks for Data-Driven Mathematical Optimization in Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="The Farmer’s Problem and Variants" href="farmer.html" />
    <link rel="prev" title="Robust Production Planning" href="ccg.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DVQ7NZ8CYZ"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-DVQ7NZ8CYZ');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo-02.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Companion Notebooks for Data-Driven Mathematical Optimization in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Data-Driven Mathematical Optimization in Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/01.00.html">
   1. Mathematical Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/alice-rose.html">
     A first example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/pop-up_shop.html">
     Pop-up shop
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/02.00.html">
   2. Linear Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim.html">
     BIM production
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/lad-regression.html">
     LAD Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/mad-portfolio-optimization.html">
     MAD portfolio optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/l1-regression-wine-quality.html">
     Wine quality prediction with L1 regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-fractional.html">
     BIM production variants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/multiproductionfaciliity_worstcase.html">
     Extra material: Multi-product facility production
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/03.00.html">
   3. Mixed Integer Linear Programming
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-perturbed.html">
     BIM production with perturbed data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/shift-scheduling.html">
     Workforce shift scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/simple-production-model-gdp.html">
     Production model using disjunctions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/machine-scheduling.html">
     Machine Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/recharging-electric-vehicle.html">
     Recharging strategy for an electric vehicle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-production-revisited.html">
     BIM production revisited
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/cryptarithms.html">
     Extra material: Cryptarithms puzzle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/strip-packing.html">
     Extra material: Strip packing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/job-shop-scheduling.html">
     Extra material: Job shop scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/maintenance-planning.html">
     Extra material: Maintenance planning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/04.00.html">
   4. Network Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/dinner-seat-allocation.html">
     Dinner seating arrangement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/gasoline-distribution.html">
     Gasoline distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/cryptocurrency-arbitrage.html">
     Cryptocurrency arbitrage search
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/shortest-path-road-networks.html">
     Extra material: Shortest path in real life
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/power-network.html">
     Extra material: Energy dispatch problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05/05.00.html">
   5. Convex Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/milk-pooling.html">
     Milk pooling and blending
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/ols-regression.html">
     Ordinary Least Squares (OLS) Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/markowitz_portfolio_with_chance_constraint.html">
     Portfolio optimization with chance constraint
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/svm-linear.html">
     Support Vector Machines for Binary Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/refinery-production.html">
     Extra material: Refinery production and shadow pricing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/06.00.html">
   6. Conic Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/economic-order-quantity.html">
     Economic Order Quantity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/building-insulation.html">
     Optimal Design of Multilayered Building Insulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/kelly-criterion-cone-programming.html">
     Kelly Criterion and Exponential Cones
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/07.00.html">
   7. Accounting for Uncertainty: Optimization Meets Reality
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/fleet-assignment.html">
     Fleet assignment problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/bim-robustness-analysis.html">
     Robustness analysis of BIM production plan via simulations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08/08.00.html">
   8. Robust Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/bim-robust-optimization.html">
     Robust BIM microchip production problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/09.00.html">
   9. Stochastic Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/newsvendor.html">
     Stock optimization for seafood distribution center
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="10.00.html">
   10. Two-Stage Problems
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="ccg.html">
     Robust Production Planning
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Airline seat allocation problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="farmer.html">
     The Farmer’s Problem and Variants
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pyomo_style_guide.html">
   Appendix: Pyomo style guide
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/mobook/MO-book/main?urlpath=tree/notebooks/10/airline-seating.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/mobook/MO-book/blob/main/notebooks/10/airline-seating.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/mobook/MO-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/mobook/MO-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/10/airline-seating.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/10/airline-seating.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#attribution">
   Attribution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-statement">
   Problem Statement
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation-and-imports">
   Installation and Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-data">
   Problem Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analytics">
   Analytics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-1-deterministic-solution-for-the-average-scenario">
   Model 1. Deterministic Solution for the Average Scenario
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-2-extensive-form-of-a-stochastic-program">
   Model 2. Extensive Form of a Stochastic Program
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-3-chance-constraints">
   Model 3. Chance Constraints
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-4-sample-average-approximation">
   Model 4. Sample Average Approximation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scenario-generation">
     Scenario Generation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-5-chance-constraints-for-sample-average-approximation">
   Model 5. Chance Constraints for Sample Average Approximation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bibliographic-notes">
   Bibliographic Notes
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Airline seat allocation problem</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#attribution">
   Attribution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-statement">
   Problem Statement
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation-and-imports">
   Installation and Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-data">
   Problem Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analytics">
   Analytics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-1-deterministic-solution-for-the-average-scenario">
   Model 1. Deterministic Solution for the Average Scenario
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-2-extensive-form-of-a-stochastic-program">
   Model 2. Extensive Form of a Stochastic Program
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-3-chance-constraints">
   Model 3. Chance Constraints
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-4-sample-average-approximation">
   Model 4. Sample Average Approximation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scenario-generation">
     Scenario Generation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-5-chance-constraints-for-sample-average-approximation">
   Model 5. Chance Constraints for Sample Average Approximation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bibliographic-notes">
   Bibliographic Notes
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="airline-seat-allocation-problem">
<h1>Airline seat allocation problem<a class="headerlink" href="#airline-seat-allocation-problem" title="Permalink to this heading">#</a></h1>
<section id="attribution">
<h2>Attribution<a class="headerlink" href="#attribution" title="Permalink to this heading">#</a></h2>
<p>The following problem statement is adapted from an exercise and examples presented by Birge and Louveaux (2011).</p>
<ul class="simple">
<li><p>Birge, J. R., &amp; Louveaux, F. (2011). Introduction to stochastic programming. Springer Science &amp; Business Media.</p></li>
</ul>
<p>The adaptations include a change to parameters for consistency among reformulations of the problem, and additional treatments for sample average approximation (SAA) with chance constraints.</p>
</section>
<section id="problem-statement">
<h2>Problem Statement<a class="headerlink" href="#problem-statement" title="Permalink to this heading">#</a></h2>
<p>An airline is deciding how to partition a new plane for the Amsterdam-Buenos Aires route. This plane can seat 200 economy class passengers. A section can be created for first class seats, but each of these seats takes the space of 2 economy class seats. A business class section can also be created, but each of these takes the space of 1.5 economy class seats. The profit for a first class ticket is three times the profit of an economy ticket, while a business class ticket has a profit of two times an economy ticket’s profit. Once the plane is partitioned into these seating classes, it cannot be changed.</p>
<p>The airlines knows that the plane will not always be full in every section. The airline has initially identified three scenarios to consider with about equal frequency:</p>
<ol class="simple">
<li><p>Weekday morning and evening traffic.</p></li>
<li><p>Weekend traffic.</p></li>
<li><p>Weekday midday traffic.</p></li>
</ol>
<p>Under Scenario 1 the airline thinks they can sell as many as 20 first class tickets, 50 business class tickets, and 200 economy tickets. Under Scenario 2 these figures are 10 , 24, and 175, while under Scenario 3, they are 6, 10, and 150, respectively. The following table summarizes the forecast demand for these three scenarios.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-align:left"><p>Scenario</p></th>
<th class="head text-align:center"><p>First class seats</p></th>
<th class="head text-align:center"><p>Business class seats</p></th>
<th class="head text-align:center"><p>Economy class seats</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>(1) weekday morning and evening</p></td>
<td class="text-align:center"><p>20</p></td>
<td class="text-align:center"><p>50</p></td>
<td class="text-align:center"><p>200</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>(2) weekend</p></td>
<td class="text-align:center"><p>10</p></td>
<td class="text-align:center"><p>24</p></td>
<td class="text-align:center"><p>175</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>(3) weekday midday</p></td>
<td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p>10</p></td>
<td class="text-align:center"><p>150</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><strong>Mean Scenario</strong></p></td>
<td class="text-align:center"><p><strong>12</strong></p></td>
<td class="text-align:center"><p><strong>28</strong></p></td>
<td class="text-align:center"><p><strong>175</strong></p></td>
</tr>
</tbody>
</table>
<p>For marketing purposes, the airline will not sell more tickets than seats in each of the sections (hence no overbooking strategy). We further assume customers seeking a first-class or business class seat will not downgrade if those seats are not available.</p>
<p>Implement and solve the extensive form of the stochastic program for the optimal seat allocation aiming to maximize the airline profit.</p>
</section>
<section id="installation-and-imports">
<h2>Installation and Imports<a class="headerlink" href="#installation-and-imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># install Pyomo and solvers</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/mobook/MO-book/main/python/helper.py&quot;</span>
<span class="n">helper</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s2">&quot;helper&quot;</span><span class="p">)</span>
<span class="n">exec</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">helper</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

<span class="n">helper</span><span class="o">.</span><span class="n">install_pyomo</span><span class="p">()</span>
<span class="n">helper</span><span class="o">.</span><span class="n">install_cbc</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pyomo was previously installed
cbc was previously installed
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="problem-data">
<h2>Problem Data<a class="headerlink" href="#problem-data" title="Permalink to this heading">#</a></h2>
<p>Pandas DataFrames and Series are used to encode problem data in the following cell, and to encode problem solutions in subsequent cells.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># scenario data</span>
<span class="n">demand</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;morning and evening&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
    <span class="s2">&quot;weekend&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">175</span><span class="p">},</span>
    <span class="s2">&quot;midday&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;F&#39;</span><span class="p">:</span>  <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">150</span><span class="p">}</span>
<span class="p">})</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># global revenue and seat factor data</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">revenue_factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>
<span class="n">seat_factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="analytics">
<h2>Analytics<a class="headerlink" href="#analytics" title="Permalink to this heading">#</a></h2>
<p>Prior to optimization, a useful first step is to prepare an analytics function to display performance for any given allocation of seats. The first-stage decision variables are the number of seats allocated for each class <span class="math notranslate nohighlight">\(c\in C\)</span>. We would like to provide a analysis showing the operational consequences for any proposed allocation of seats. For this purpose, we create a function <code class="docutils literal notranslate"><span class="pre">seat_report()</span></code> that show the tickets that can be sold in each scenario, the resulting revenue, and the unsatisfied demand (‘spillage’).</p>
<p>To establish a basis for analyzing possible solutions to the airline’s problem, this function first is demonstrated for the case where the airplane is configured as entirely economy class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># function to report analytics for any given seat allocations</span>
<span class="k">def</span> <span class="nf">seat_report</span><span class="p">(</span><span class="n">seats</span><span class="p">,</span> <span class="n">demand</span><span class="p">):</span>
    
    <span class="n">classes</span> <span class="o">=</span> <span class="n">seats</span><span class="o">.</span><span class="n">index</span>
    
    <span class="c1"># report seat allocation</span>
    <span class="n">equivalent_seats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;seat allocation&quot;</span><span class="p">:</span>  <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">},</span>
        <span class="s2">&quot;economy equivalent seat allocation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">seat_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">}</span>
    <span class="p">})</span><span class="o">.</span><span class="n">T</span>
    <span class="n">equivalent_seats</span><span class="p">[</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">equivalent_seats</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Seat Allocation&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">equivalent_seats</span><span class="p">)</span>
    
    <span class="c1"># tickets sold is the minimum of available seats and demand</span>
    <span class="n">tickets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">demand</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tickets Sold&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">tickets</span><span class="p">)</span>
    
    <span class="c1"># seats unsold</span>
    <span class="n">unsold</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">unsold</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">-</span> <span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Seats not Sold&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">unsold</span><span class="p">)</span>

    <span class="c1"># spillage (unmet demand)</span>
    <span class="n">spillage</span> <span class="o">=</span> <span class="n">demand</span> <span class="o">-</span> <span class="n">tickets</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Spillage (Unfulfilled Demand)&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">spillage</span><span class="p">)</span>
    
    <span class="c1"># compute revenue</span>
    <span class="n">revenue</span> <span class="o">=</span> <span class="n">tickets</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">revenue_factor</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Expected Revenue (in units of economy ticket price): </span><span class="si">{</span><span class="n">revenue</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># charts</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">revenue</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Revenue by Scenario&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">revenue</span><span class="o">.</span><span class="n">mean</span><span class="p">()]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Revenue&quot;</span><span class="p">)</span>
    
    <span class="n">tickets</span><span class="p">[</span><span class="n">classes</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Demand Scenarios&quot;</span><span class="p">)</span>
    <span class="n">demand</span><span class="p">[</span><span class="n">classes</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Demand Scenarios&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Seats&quot;</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span>

<span class="c1"># a trial solution </span>
<span class="n">seats_all_economy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">})</span>
<span class="n">seat_report</span><span class="p">(</span><span class="n">seats_all_economy</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>200.0</td>
      <td>200.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>200.0</td>
      <td>200.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tickets Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>0</td>
      <td>0</td>
      <td>200</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0</td>
      <td>0</td>
      <td>175</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>0</td>
      <td>0</td>
      <td>150</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seats not Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0</td>
      <td>0</td>
      <td>25</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>0</td>
      <td>0</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>20</td>
      <td>50</td>
      <td>0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>10</td>
      <td>24</td>
      <td>0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>6</td>
      <td>10</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 175.00
</pre></div>
</div>
<img alt="../../_images/airline-seating_8_9.png" src="../../_images/airline-seating_8_9.png" />
</div>
</div>
</section>
<section id="model-1-deterministic-solution-for-the-average-scenario">
<h2>Model 1. Deterministic Solution for the Average Scenario<a class="headerlink" href="#model-1-deterministic-solution-for-the-average-scenario" title="Permalink to this heading">#</a></h2>
<p>A common starting point in stochastic programming is to solve the deterministic problem where future demands are fixed at their mean values, then computing the expected value that results when using that solution. The resulting value of the objective has been called the <em>expectation of the expected value probem (EEV)</em> by Birge, or the <em>expected value of the mean (EVM)</em> solution by others.</p>
<p>The objective function is to maximize ticket revenue.</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
\max_{\text{seats}_c, \text{tickets}_c} &amp; \sum_{c\in \text{CLASSES}} r_c \text{tickets}_c 
\end{align}
\]</div>
<p>where <span class="math notranslate nohighlight">\(r_c\)</span> is the revenue from selling a ticket for a seat in class <span class="math notranslate nohighlight">\(c\in \text{CLASSES}\)</span>.</p>
<p>Let <span class="math notranslate nohighlight">\(\text{seats}_c\)</span> denote the number of seats of class <span class="math notranslate nohighlight">\(c \in \{F, B, E\}\)</span> installed in the new plane. Let <span class="math notranslate nohighlight">\(s_c\)</span> be the scale factor denoting the number of economy seats displaced by one seat in class <span class="math notranslate nohighlight">\(c\)</span>. Then</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
\sum_{c\in \text{CLASSES}} s_c \text{seats}_c &amp; \leq \text{capacity}
\end{align}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\text{capacity}\)</span> is the total number of economy class seats that could fit on the plane. Let <span class="math notranslate nohighlight">\(\bar{\text{demand}}_c\)</span> be the mean demand for seats of class <span class="math notranslate nohighlight">\(c\in \text{CLASSES}\)</span>, and let <span class="math notranslate nohighlight">\(\text{tickets}_c\)</span> be the number of tickets of class <span class="math notranslate nohighlight">\(c\in \text{CLASSES}\)</span> that are sold. Then</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\text{tickets}_c &amp; \leq \text{seats}_c &amp; \forall c\in \text{CLASSES} \\
\text{tickets}_c &amp; \leq \text{mean demand}_c &amp; \forall c\in \text{CLASSES}
\end{align}
\end{split}\]</div>
<p>The following cell presents a Pyomo model implementing this model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">airline_EEV</span><span class="p">(</span><span class="n">demand</span><span class="p">):</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">demand</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="c1"># first stage variables and constraints</span>
    <span class="n">m</span><span class="o">.</span><span class="n">seats</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span> 

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">plane_seats</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">seat_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">capacity</span>

    <span class="c1"># second stage variable and constraints</span>
    <span class="n">m</span><span class="o">.</span><span class="n">tickets</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">demand_limits</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">demand</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">seat_limits</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>

    <span class="c1"># objective</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">revenue</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">revenue_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">m</span>

<span class="k">def</span> <span class="nf">airline_solve</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">c</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">})</span>

<span class="n">model_eev</span> <span class="o">=</span> <span class="n">airline_EEV</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>
<span class="n">seats_eev</span> <span class="o">=</span> <span class="n">airline_solve</span><span class="p">(</span><span class="n">model_eev</span><span class="p">)</span>
<span class="n">seat_report</span><span class="p">(</span><span class="n">seats_eev</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>12.0</td>
      <td>28.0</td>
      <td>134.0</td>
      <td>174.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>24.0</td>
      <td>42.0</td>
      <td>134.0</td>
      <td>200.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tickets Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>12.0</td>
      <td>28.0</td>
      <td>134.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>10.0</td>
      <td>24.0</td>
      <td>134.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>6.0</td>
      <td>10.0</td>
      <td>134.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seats not Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>2.0</td>
      <td>4.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>6.0</td>
      <td>18.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>8.0</td>
      <td>22.0</td>
      <td>66.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>41.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>16.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 203.33
</pre></div>
</div>
<img alt="../../_images/airline-seating_10_9.png" src="../../_images/airline-seating_10_9.png" />
</div>
</div>
</section>
<section id="model-2-extensive-form-of-a-stochastic-program">
<h2>Model 2. Extensive Form of a Stochastic Program<a class="headerlink" href="#model-2-extensive-form-of-a-stochastic-program" title="Permalink to this heading">#</a></h2>
<p>The stochastic program accounts for uncertainty in demand by treating the number of tickets sold as scenario dependent, i.e., a second-stage or recourse decision variable, <span class="math notranslate nohighlight">\(\text{tickets}_{c,s}\)</span> that is indexed by both seat class and scenario.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\max &amp; \frac{1}{N}\sum_{\substack{c\in \text{CLASSES} \\ s\in \text{SCENARIOS}}} r_c \text{tickets}_{c, s} 
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(N\)</span> is the number of scenarios. The first stage constraint remains unchanged</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
\sum_{c\in \text{CLASSES}} s_c \text{seats}_c &amp; \leq \text{capacity}
\end{align}
\]</div>
<p>The second stage constraints are</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\text{tickets}_c &amp; \leq \text{seats}_c &amp; \forall c\in \text{CLASSES} \\
\text{tickets}_c &amp; \leq \text{demand}_{c, s} &amp; \forall (c, s) \in \text{CLASSES} \times \text{SCENARIOS}
\end{align}
\end{split}\]</div>
<p>The following cell presents a Pyomo model implementing this model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">airline_SS</span><span class="p">(</span><span class="n">demand</span><span class="p">):</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">demand</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">demand</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># first stage variables and constraints</span>
    <span class="n">m</span><span class="o">.</span><span class="n">seats</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span> 

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">plane_seats</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">seat_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">capacity</span>

    <span class="c1"># second stage variable and constraints</span>
    <span class="n">m</span><span class="o">.</span><span class="n">tickets</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">demand_limits</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">demand</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">seat_limits</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>

    <span class="c1"># objective</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">revenue</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">revenue_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">m</span>

<span class="c1"># create model</span>
<span class="n">model_ss</span> <span class="o">=</span> <span class="n">airline_SS</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>
<span class="n">seats_ss</span> <span class="o">=</span> <span class="n">airline_solve</span><span class="p">(</span><span class="n">model_ss</span><span class="p">)</span>
<span class="n">seat_report</span><span class="p">(</span><span class="n">seats_ss</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>10.0</td>
      <td>20.0</td>
      <td>150.0</td>
      <td>180.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>20.0</td>
      <td>30.0</td>
      <td>150.0</td>
      <td>200.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tickets Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>10.0</td>
      <td>20.0</td>
      <td>150.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>10.0</td>
      <td>20.0</td>
      <td>150.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>6.0</td>
      <td>10.0</td>
      <td>150.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seats not Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>4.0</td>
      <td>10.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>10.0</td>
      <td>30.0</td>
      <td>50.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0.0</td>
      <td>4.0</td>
      <td>25.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 209.33
</pre></div>
</div>
<img alt="../../_images/airline-seating_12_9.png" src="../../_images/airline-seating_12_9.png" />
</div>
</div>
</section>
<section id="model-3-chance-constraints">
<h2>Model 3. Chance Constraints<a class="headerlink" href="#model-3-chance-constraints" title="Permalink to this heading">#</a></h2>
<p>The airline wishes a special guarantee for its clients enrolled in its loyalty program. In particular, it wants <span class="math notranslate nohighlight">\(98\%\)</span> probability to cover the demand of first-class seats and <span class="math notranslate nohighlight">\(95\%\)</span> probability to cover the demand of business class seats (by clients of the loyalty program). First-class passengers are covered if they can purchase a first-class seat. Business class passengers are covered if they purchase a business class seat or upgrade to a first-class seat.</p>
<p>Assume weekday demands of loyalty-program passengers are Normally distributed as <span class="math notranslate nohighlight">\(\xi_F \sim \mathcal N(\mu_F, \sigma_F^2)\)</span> and <span class="math notranslate nohighlight">\(\xi_B \sim \mathcal N(\mu_B, \sigma_B^2)\)</span> for first-class and business, respectively. Assume that the demands for first-class and business class seats are independent.</p>
<p>Let <span class="math notranslate nohighlight">\(\text{seats}_F\)</span> be the number of first-class seats and <span class="math notranslate nohighlight">\(\text{seats}_B\)</span> the number of business seats. The probabilistic constraints are</p>
<div class="math notranslate nohighlight">
\[
\mathbb P(\text{seats}_F \geq \xi_F ) \geq 0.98, \qquad \text{ and } \qquad \mathbb P(\text{seats}_F + \text{seats}_B \geq \xi_F + \xi_B ) \geq 0.95.
\]</div>
<p>These are can be written equivalently as linear constraints, specifically</p>
<div class="math notranslate nohighlight">
\[
\frac{\text{seats}_F - \mu_F}{\sigma_F} \geq 2.054 \qquad \text{ and } \qquad \frac{(\text{seats}_F + \text{seats}_B) - (\mu_F + \mu_B)}{\sqrt{\sigma_F^2 + \sigma_B^2}} \geq 1.645.
\]</div>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-align:center"><p></p></th>
<th class="head text-align:center"><p><span class="math notranslate nohighlight">\(\mu\)</span></p></th>
<th class="head text-align:center"><p><span class="math notranslate nohighlight">\(\sigma\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>F</p></td>
<td class="text-align:center"><p>12</p></td>
<td class="text-align:center"><p>4</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>B</p></td>
<td class="text-align:center"><p>28</p></td>
<td class="text-align:center"><p>8</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>E</p></td>
<td class="text-align:center"><p>175</p></td>
<td class="text-align:center"><p>20</p></td>
</tr>
</tbody>
</table>
<p>Add to your implementation of the extensive form the two equivalent deterministic constraints corresponding to the two chance constraints and find the new optimal solution meeting these additional constraints. How is the solution different from the previous one?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="p">}))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mu</th>
      <th>sigma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>12.0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>B</th>
      <td>28.0</td>
      <td>16</td>
    </tr>
    <tr>
      <th>E</th>
      <td>175.0</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The chance constraints are additional constraints imposed on the stochastic programming model. Rather than writing a function to create a whole new model, we can use the prior function to create and add the two chance constraints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">airline_CC</span><span class="p">(</span><span class="n">demand</span><span class="p">):</span>
    <span class="c1"># create model</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">airline_SS</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>

    <span class="c1"># add chance constraints</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">first_class</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mu</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">2.054</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span>

    <span class="c1"># add chance constraints</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">business_class</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span>  <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">mu</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> \
                <span class="mf">1.645</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sigma</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">m</span>

<span class="c1"># create and solve model</span>
<span class="n">model_cc</span> <span class="o">=</span> <span class="n">airline_CC</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>
<span class="n">seats_cc</span> <span class="o">=</span> <span class="n">airline_solve</span><span class="p">(</span><span class="n">model_cc</span><span class="p">)</span>
<span class="n">seat_report</span><span class="p">(</span><span class="n">seats_cc</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>21.0</td>
      <td>47.0</td>
      <td>87.0</td>
      <td>155.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>42.0</td>
      <td>70.5</td>
      <td>87.0</td>
      <td>199.5</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tickets Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>20.0</td>
      <td>47.0</td>
      <td>87.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>10.0</td>
      <td>24.0</td>
      <td>87.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>6.0</td>
      <td>10.0</td>
      <td>87.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seats not Sold
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>11.0</td>
      <td>23.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>15.0</td>
      <td>37.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>morning and evening</th>
      <td>0.0</td>
      <td>3.0</td>
      <td>113.0</td>
    </tr>
    <tr>
      <th>weekend</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>88.0</td>
    </tr>
    <tr>
      <th>midday</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>63.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 177.00
</pre></div>
</div>
<img alt="../../_images/airline-seating_16_9.png" src="../../_images/airline-seating_16_9.png" />
</div>
</div>
</section>
<section id="model-4-sample-average-approximation">
<h2>Model 4. Sample Average Approximation<a class="headerlink" href="#model-4-sample-average-approximation" title="Permalink to this heading">#</a></h2>
<p>Now assume the ticket demand for the three categories is captured by a <span class="math notranslate nohighlight">\(3\)</span>-dimensional multivariate normal distribution mean <span class="math notranslate nohighlight">\(\mu=(\mu_F, \mu_B, \mu_E)\)</span>, variances <span class="math notranslate nohighlight">\((\sigma_F^2, \sigma_B^2, \sigma_E^2)\)</span> and a symmetric correlation matrix</p>
<div class="math notranslate nohighlight">
\[\begin{split}
P = \left(
\begin{array}{ccc}
1 &amp; \rho_{FB} &amp; \rho_{FE} \\
\rho_{BF} &amp; 1 &amp; \rho_{BE}\\
\rho_{EF} &amp; \rho_{EB} &amp; 1 \\
\end{array}
\right)
\end{split}\]</div>
<p>The covariance matrix is given by <span class="math notranslate nohighlight">\(\Sigma = \text{diag}(\sigma)\ P\ \text{diag}(\sigma)\)</span> or</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\Sigma= \left(
\begin{array}{ccc}
 \sigma_F^2 &amp; \rho_{FB}\sigma_F\sigma_B &amp; \rho_{FE}\sigma_F\sigma_E \\
\rho_{BF}\sigma_B\sigma_F &amp; \sigma_B^2 &amp; \rho_{BE}\sigma_B\sigma_E\\
\rho_{EF}\sigma_E\sigma_F &amp; \rho_{EB}\sigma_E\sigma_B &amp; \sigma_E^2 \\
\end{array}
\right)
\end{split}\]</div>
<p>We assume <span class="math notranslate nohighlight">\(\rho_FB = 0.6\)</span>, <span class="math notranslate nohighlight">\(\rho_{BE} = 0.4\)</span> and <span class="math notranslate nohighlight">\(\rho_{FE} = 0.2\)</span>.</p>
<p>Find an approximate solution to the airline seat allocation problem with the loyalty constraints using the Sample Average Approximation method. Sample <span class="math notranslate nohighlight">\(N=1000\)</span> points from the multivariate normal distribution and solve the extensive form for the stochastic LP resulting from those <span class="math notranslate nohighlight">\(N=1000\)</span> scenarios.</p>
<section id="scenario-generation">
<h3>Scenario Generation<a class="headerlink" href="#scenario-generation" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sample size</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># assume mu and sigma are given (see above)</span>

<span class="c1"># correlation matrix</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

<span class="c1"># build covariance matrix from covariances and correlations</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sigma</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">@</span> <span class="n">P</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># create samples</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>

<span class="c1"># truncate to integers and non-negative values</span>
<span class="n">classes</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">columns</span>
<span class="n">demand_saa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">classes</span><span class="p">)</span>
<span class="n">demand_saa</span><span class="p">[</span><span class="n">demand_saa</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample means&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">demand_saa</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample std dev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">demand_saa</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Model Covariance&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">classes</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sample Covariance&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">demand_saa</span><span class="o">.</span><span class="n">cov</span><span class="p">()))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ci</span>  <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">classes</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">cj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">classes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">j</span><span class="p">:</span>
            <span class="n">demand_saa</span><span class="p">[</span><span class="n">ci</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Histogram </span><span class="si">{</span><span class="n">ci</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">demand_saa</span><span class="p">[</span><span class="n">ci</span><span class="p">],</span> <span class="n">demand_saa</span><span class="p">[</span><span class="n">cj</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ci</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">cj</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Convariance: </span><span class="si">{</span><span class="n">ci</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">cj</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mu</th>
      <th>sample means</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>12.0</td>
      <td>12.058</td>
    </tr>
    <tr>
      <th>B</th>
      <td>28.0</td>
      <td>28.355</td>
    </tr>
    <tr>
      <th>E</th>
      <td>175.0</td>
      <td>175.436</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sigma</th>
      <th>sample std dev</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>4</td>
      <td>4.046852</td>
    </tr>
    <tr>
      <th>B</th>
      <td>16</td>
      <td>15.879708</td>
    </tr>
    <tr>
      <th>E</th>
      <td>20</td>
      <td>19.503597</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model Covariance
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>16.0</td>
      <td>38.4</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>B</th>
      <td>38.4</td>
      <td>256.0</td>
      <td>128.0</td>
    </tr>
    <tr>
      <th>E</th>
      <td>16.0</td>
      <td>128.0</td>
      <td>400.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sample Covariance
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>16.377013</td>
      <td>40.352763</td>
      <td>15.402114</td>
    </tr>
    <tr>
      <th>B</th>
      <td>40.352763</td>
      <td>252.165140</td>
      <td>121.395616</td>
    </tr>
    <tr>
      <th>E</th>
      <td>15.402114</td>
      <td>121.395616</td>
      <td>380.390294</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../../_images/airline-seating_19_6.png" src="../../_images/airline-seating_19_6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_ssa</span> <span class="o">=</span> <span class="n">airline_CC</span><span class="p">(</span><span class="n">demand_saa</span><span class="p">)</span>
<span class="n">seats_saa</span> <span class="o">=</span> <span class="n">airline_solve</span><span class="p">(</span><span class="n">model_ssa</span><span class="p">)</span>

<span class="c1"># function to report analytics for SAA case</span>
<span class="k">def</span> <span class="nf">seat_report_saa</span><span class="p">(</span><span class="n">seats</span><span class="p">,</span> <span class="n">demand</span><span class="p">):</span>
    
    <span class="n">classes</span> <span class="o">=</span> <span class="n">seats</span><span class="o">.</span><span class="n">index</span>
    
    <span class="c1"># report seat allocation</span>
    <span class="n">equivalent_seats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;seat allocation&quot;</span><span class="p">:</span>  <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">},</span>
        <span class="s2">&quot;economy equivalent seat allocation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">seat_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">}</span>
    <span class="p">})</span><span class="o">.</span><span class="n">T</span>
    <span class="n">equivalent_seats</span><span class="p">[</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">equivalent_seats</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Seat Allocation&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">equivalent_seats</span><span class="p">)</span>
    
    <span class="c1"># tickets sold</span>
    <span class="n">tickets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">demand</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mean Tickets Sold&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">tickets</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    
    <span class="c1"># seats unsold</span>
    <span class="n">unsold</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">unsold</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">-</span> <span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mean Seats not Sold&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">unsold</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="c1"># spillage (unmet demand)</span>
    <span class="n">spillage</span> <span class="o">=</span> <span class="n">demand</span> <span class="o">-</span> <span class="n">tickets</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mean Spillage (Unfulfilled Demand)&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">spillage</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    
    <span class="c1"># compute revenue</span>
    <span class="n">revenue</span> <span class="o">=</span> <span class="n">tickets</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">revenue_factor</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Expected Revenue (in units of economy ticket price): </span><span class="si">{</span><span class="n">revenue</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># charts</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">revenue</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Revenue Histogram&quot;</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">classes</span><span class="p">):</span>
        <span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">demand</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Tickets Sold&#39;</span><span class="p">,</span> <span class="s1">&#39;Demand&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

    <span class="k">return</span>

<span class="n">seat_report_saa</span><span class="p">(</span><span class="n">seats_saa</span><span class="p">,</span> <span class="n">demand_saa</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>21.0</td>
      <td>47.0</td>
      <td>87.0</td>
      <td>155.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>42.0</td>
      <td>70.5</td>
      <td>87.0</td>
      <td>199.5</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Tickets Sold
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F    12.035
B    27.304
E    87.000
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Seats not Sold
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F     8.965
B    19.696
E     0.000
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F     0.023
B     1.051
E    88.436
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 177.71
</pre></div>
</div>
<img alt="../../_images/airline-seating_20_9.png" src="../../_images/airline-seating_20_9.png" />
<img alt="../../_images/airline-seating_20_10.png" src="../../_images/airline-seating_20_10.png" />
</div>
</div>
</section>
</section>
<section id="model-5-chance-constraints-for-sample-average-approximation">
<h2>Model 5. Chance Constraints for Sample Average Approximation<a class="headerlink" href="#model-5-chance-constraints-for-sample-average-approximation" title="Permalink to this heading">#</a></h2>
<p>The chance constraints used used above were developed on the assumption independent Normal distributions of demand for first class and business travel. That assumption no longer holds for the case where demand scenarios are being sampled from correlated, multivariate distributions.</p>
<p>This final model replaces the chance constraints by explicitly tracking unsatisfied demand for first and business class seats.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\max &amp; \frac{1}{N}\sum_{\substack{c\in \text{CLASSES} \\ s\in \text{SCENARIOS}}} r_c \text{tickets}_{c, s} 
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(N\)</span> is the number of scenarios. The first stage constraint remains unchanged</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
\sum_{c\in \text{CLASSES}} s_c \text{seats}_c &amp; \leq \text{capacity}
\end{align}
\]</div>
<p>The second stage constraints are</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\text{tickets}_c &amp; \leq \text{seats}_c &amp; \forall c\in \text{CLASSES} \\
\text{tickets}_c &amp; \leq \text{demand}_{c, s} &amp; \forall (c, s) \in \text{CLASSES} \times \text{SCENARIOS} \\
\text{seats}_F + M y_s &amp; \geq \text{demand}_{F, s} &amp; \forall s \in  \text{SCENARIOS}\\
\text{seats}_F + \text{seats}_B + M z_s &amp; \geq \text{demand}_{F, s} + \text{demand}_{B,s} &amp; \forall s \in  \text{SCENARIOS} \\
\sum_{s\in \text{SCENARIOS}} y_s &amp; \leq 0.02 N \\
\sum_{s\in \text{SCENARIOS}} z_s &amp; \leq 0.05 N
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(y_s\)</span> and <span class="math notranslate nohighlight">\(z_s\)</span> are binary variables indicating those scenarios which do not satisfy the requirements of the airline’s loyalty programs for first class and business class passengers.</p>
<p>The following cell implements this new model. Note that the running time for the cell can be up to a few minutes for a large number of scenarios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bigM</span> <span class="o">=</span> <span class="mi">100</span>

<span class="k">def</span> <span class="nf">airline</span><span class="p">(</span><span class="n">demand</span><span class="p">):</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">demand</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">demand</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># first stage variables and constraints</span>
    <span class="n">m</span><span class="o">.</span><span class="n">seats</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span> 

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">plane_seats</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">seat_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">capacity</span>

    <span class="c1"># second stage variable and constraints</span>
    <span class="n">m</span><span class="o">.</span><span class="n">tickets</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">first_class</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">business_class</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">demand_limits</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">demand</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">seat_limits</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
    
    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">first_class_loyality</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bigM</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">first_class</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">demand</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>
    
    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">first_class_loyality_rate</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">first_class</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    
    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">business_class_loyality</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bigM</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">business_class</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;=</span> \
            <span class="n">demand</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="n">demand</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">business_class_loyality_rate</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">business_class</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    
    <span class="c1"># objective</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">revenue</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">tickets</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">revenue_factor</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">CLASSES</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">m</span>

<span class="c1"># create model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">airline</span><span class="p">(</span><span class="n">demand_saa</span><span class="p">)</span>
<span class="n">seats</span> <span class="o">=</span> <span class="n">airline_solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">seat_report_saa</span><span class="p">(</span><span class="n">seats</span><span class="p">,</span> <span class="n">demand_saa</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Seat Allocation
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>F</th>
      <th>B</th>
      <th>E</th>
      <th>TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>seat allocation</th>
      <td>20.0</td>
      <td>54.0</td>
      <td>79.0</td>
      <td>153.0</td>
    </tr>
    <tr>
      <th>economy equivalent seat allocation</th>
      <td>40.0</td>
      <td>81.0</td>
      <td>79.0</td>
      <td>200.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Tickets Sold
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F    12.018
B    27.927
E    79.000
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Seats not Sold
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F     7.982
B    26.073
E     0.000
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Spillage (Unfulfilled Demand)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F     0.040
B     0.428
E    96.436
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Revenue (in units of economy ticket price): 170.91
</pre></div>
</div>
<img alt="../../_images/airline-seating_22_9.png" src="../../_images/airline-seating_22_9.png" />
<img alt="../../_images/airline-seating_22_10.png" src="../../_images/airline-seating_22_10.png" />
</div>
</div>
<p><strong>Exercise</strong></p>
<p>Compared the results of using positive correlation in demand for first and business class tickets results in lower expected revenue. What happens if there is no correlation, or there is negative correlation? Verify your predictions by simulation.</p>
</section>
<section id="bibliographic-notes">
<h2>Bibliographic Notes<a class="headerlink" href="#bibliographic-notes" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>The aircraft rotation problem:  <a class="reference external" href="https://link.springer.com/content/pdf/10.1023/A:1018945415148.pdf">https://link.springer.com/content/pdf/10.1023/A:1018945415148.pdf</a></p>
</div></blockquote>
<blockquote>
<div><p>SAA guide: <a class="reference external" href="https://people.orie.cornell.edu/shane/pubs/SAAGuide.pdf">https://people.orie.cornell.edu/shane/pubs/SAAGuide.pdf</a></p>
</div></blockquote>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/10"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="ccg.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Robust Production Planning</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="farmer.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">The Farmer’s Problem and Variants</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The MO Book Group<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>