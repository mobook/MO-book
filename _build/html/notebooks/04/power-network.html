
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Extra material: Energy dispatch problem &#8212; Companion code for the book &#34;Hands-On Optimization with Python&#34;</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Forex Arbitrage" href="forex-arbitrage.html" />
    <link rel="prev" title="Cryptocurrency arbitrage search" href="cryptocurrency-arbitrage.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DVQ7NZ8CYZ"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-DVQ7NZ8CYZ');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo-02.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Companion code for the book "Hands-On Optimization with Python"</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Hands-On Optimization with Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/01.00.html">
   1. Mathematical Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/production-planning.html">
     A first production planning problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/production-planning-basic.html">
     A basic Pyomo model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/production-planning-advanced.html">
     A data-driven Pyomo Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/02.00.html">
   2. Linear Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim.html">
     BIM production
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/lad-regression.html">
     Least Absolute Deviation (LAD) Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/mad-portfolio-optimization.html">
     Mean Absolute Deviation (MAD) portfolio optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-dual.html">
     Dual of the BIM production problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-maxmin.html">
     BIM production for worst case
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-fractional.html">
     BIM production variants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-rawmaterialplanning.html">
     BIM production using demand forecasts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/L1-regression-wine-quality.html">
     Extra material: Wine quality prediction with
     <span class="math notranslate nohighlight">
      \(L_1\)
     </span>
     regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/multiproductionfaciliity_worstcase.html">
     Extra material: Multi-product facility production
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/03.00.html">
   3. Mixed Integer Linear Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-perturbed.html">
     BIM production with perturbed data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/shift-scheduling.html">
     Workforce shift scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/recharging-electric-vehicle.html">
     Recharging strategy for an electric vehicle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/simple-production-model-gdp.html">
     Production model using disjunctions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/machine-scheduling.html">
     Machine Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-production-revisited.html">
     BIM production revisited
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/cryptarithms.html">
     Extra material: Cryptarithms puzzle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/strip-packing.html">
     Extra material: Strip packing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/job-shop-scheduling.html">
     Extra material: Job shop scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/maintenance-planning.html">
     Extra material: Maintenance planning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="04.00.html">
   4. Network Optimization
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="dinner-seat-allocation.html">
     Dinner seating arrangement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gasoline-distribution.html">
     Gasoline distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cryptocurrency-arbitrage.html">
     Cryptocurrency arbitrage search
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Extra material: Energy dispatch problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="forex-arbitrage.html">
     Forex Arbitrage
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05/05.00.html">
   5. Convex Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/milk-pooling.html">
     Milk pooling and blending
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/ols-regression.html">
     Ordinary Least Squares (OLS) Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/markowitz_portfolio.html">
     Markowitz portfolio optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/svm.html">
     Support Vector Machines for Binary Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/refinery-production.html">
     Extra material: Refinery production and shadow pricing with CVXPY
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/cutting-stock.html">
     Extra Material: Cutting Stock
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/06.00.html">
   6. Conic Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/economic-order-quantity.html">
     Economic Order Quantity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/kelly-criterion.html">
     The Kelly Criterion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/markowitz_portfolio_revisited.html">
     Markowitz portfolio optimization revisited
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/building-insulation.html">
     Optimal Design of Multilayered Building Insulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/svm-conic.html">
     Training Support Vector Machines with Conic Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/investment-wheel.html">
     Extra material: Luenberger’s Investment Wheel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/optimal-growth-portfolios.html">
     Extra material: Optimal Growth Portfolios with Risk Aversion
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/07.00.html">
   7. Accounting for Uncertainty: Optimization Meets Reality
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/fleet-assignment.html">
     Fleet assignment problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/bim-robustness-analysis.html">
     Robustness analysis of BIM production plan via simulations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08/08.00.html">
   8. Robust Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/bim-robust-optimization.html">
     Robust BIM microchip production problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/09.00.html">
   9. Stochastic Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/pop-up_shop.html">
     Pop-up shop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/markowitz_portfolio_with_chance_constraint.html">
     Markowitz portfolio optimization with chance constraints
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/seafood.html">
     Stock optimization for seafood distribution center
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/economicdispatch.html">
     Economic dispatch in energy systems
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../10/10.00.html">
   10. Two-Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/airline-seating.html">
     Airline seat allocation problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/opf-ldr.html">
     Optimal power flow problem with recourse actions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/ccg.html">
     Two-stage Production Planning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/farmer.html">
     Extra: The farmer’s problem and its variants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/opf-wind-curtailment.html">
     Extra: Two-stage energy dispatch optimization with wind curtailment
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../appendix/appendix.html">
   Appendix: Working with Pyomo
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../appendix/pyomo-style-guide.html">
     Pyomo style guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../appendix/functional-programming-pyomo.html">
     Functional Programming with Pyomo
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../genindex.html">
   Index
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/mobook/MO-book/main?urlpath=tree/notebooks/04/power-network.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/mobook/MO-book/blob/main/notebooks/04/power-network.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/mobook/MO-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/mobook/MO-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/04/power-network.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/04/power-network.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Extra material: Energy dispatch problem
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#preamble-install-pyomo-and-a-solver">
     Preamble: Install Pyomo and a solver
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#background-power-networks-and-power-flow-physics">
     Background: Power networks and power flow physics
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimal-power-flow">
     Optimal Power Flow
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data">
     Data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setup-code">
       Setup code
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#data-import">
       Data import
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#network-data">
       Network data
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#edges">
       Edges
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#network-data-structure">
       Network data structure
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#instances">
       Instances
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solving-opf">
   Solving OPF
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#strict-fossil-fuel-policy-pt-1">
   Strict fossil fuel policy pt.1
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#strict-fossil-fuel-policy-pt-2">
   Strict fossil fuel policy pt.2
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-the-three-models">
   Comparing the three models
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Extra material: Energy dispatch problem</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Extra material: Energy dispatch problem
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#preamble-install-pyomo-and-a-solver">
     Preamble: Install Pyomo and a solver
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#background-power-networks-and-power-flow-physics">
     Background: Power networks and power flow physics
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimal-power-flow">
     Optimal Power Flow
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data">
     Data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setup-code">
       Setup code
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#data-import">
       Data import
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#network-data">
       Network data
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#edges">
       Edges
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#network-data-structure">
       Network data structure
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#instances">
       Instances
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solving-opf">
   Solving OPF
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#strict-fossil-fuel-policy-pt-1">
   Strict fossil fuel policy pt.1
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#strict-fossil-fuel-policy-pt-2">
   Strict fossil fuel policy pt.2
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-the-three-models">
   Comparing the three models
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <span class="target" id="index-0"></span><span class="target" id="index-1"></span><span class="target" id="index-2"></span><span class="target" id="index-3"></span><span class="target" id="index-4"></span><section class="tex2jax_ignore mathjax_ignore" id="extra-material-energy-dispatch-problem">
<span id="index-5"></span><h1>Extra material: Energy dispatch problem<a class="headerlink" href="#extra-material-energy-dispatch-problem" title="Permalink to this headline">#</a></h1>
<p>To meet the energy demand, power plants run day and night across the country to produce electricity from a variety of sources such as fossil fuels and renewable energy. On the short-time scale, the best operating levels for electric power plants are derived every 15 minutes by solving the so-called <em>Optimal Power Flow (OPF)</em> model. The OPF model is an optimization problem with the objective of minimizing the total energy dispatching cost, while ensuring that the generation meets the total energy demand. Furthermore, the model takes into account many constraints, among which operational and physical constraints.</p>
<section id="preamble-install-pyomo-and-a-solver">
<h2>Preamble: Install Pyomo and a solver<a class="headerlink" href="#preamble-install-pyomo-and-a-solver" title="Permalink to this headline">#</a></h2>
<p>This cell selects and verifies a global SOLVER for the notebook.</p>
<p>If run on Google Colab, the cell installs Pyomo and HiGHS, then sets SOLVER to
use the Highs solver via the appsi module. If run elsewhere, it assumes Pyomo and CBC
have been previously installed and sets SOLVER to use the CBC solver via the Pyomo
SolverFactory. It then verifies that SOLVER is available.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pyomo<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;/dev/null
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>highspy<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;/dev/null

    <span class="kn">from</span> <span class="nn">pyomo.contrib</span> <span class="kn">import</span> <span class="n">appsi</span>
    <span class="n">SOLVER</span> <span class="o">=</span> <span class="n">appsi</span><span class="o">.</span><span class="n">solvers</span><span class="o">.</span><span class="n">Highs</span><span class="p">(</span><span class="n">only_child_vars</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="n">SolverFactory</span>
    <span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">SOLVER</span><span class="o">.</span><span class="n">available</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;Solver </span><span class="si">{</span><span class="n">SOLVER</span><span class="si">}</span><span class="s2"> is not available.&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="background-power-networks-and-power-flow-physics">
<h2>Background: Power networks and power flow physics<a class="headerlink" href="#background-power-networks-and-power-flow-physics" title="Permalink to this headline">#</a></h2>
<p>We model the nation-wide transmission power network as a directed graph <span class="math notranslate nohighlight">\(G=(V, E)\)</span>, where <span class="math notranslate nohighlight">\(V\)</span> represents the set of nodes (e.g., cities, industrial districts, power plants) and <span class="math notranslate nohighlight">\(E\)</span> denotes the set of directed edges (e.g., physical transmission lines).</p>
<p>Each node <span class="math notranslate nohighlight">\(i \in V\)</span> has a power injection <span class="math notranslate nohighlight">\(p_i\)</span> and demand <span class="math notranslate nohighlight">\(d_i\)</span>. The set of nodes are separated into <em>generator</em> and <em>load</em> nodes. The set of generators <span class="math notranslate nohighlight">\(\mathcal{G} \subseteq V\)</span> corresponds to the nodes <span class="math notranslate nohighlight">\(i \in V\)</span> for which <span class="math notranslate nohighlight">\(p_i \geq 0\)</span> and <span class="math notranslate nohighlight">\(d_i = 0\)</span>. Each generator <span class="math notranslate nohighlight">\(i \in \mathcal{G}\)</span> has a minimum <span class="math notranslate nohighlight">\(p_i^{\min}\)</span> and maximum <span class="math notranslate nohighlight">\(p_i^{\max}\)</span> production capacity. The set of load nodes <span class="math notranslate nohighlight">\(\mathcal{D} \subseteq V\)</span> corresponds to the nodes for which <span class="math notranslate nohighlight">\(p_i = 0\)</span> and <span class="math notranslate nohighlight">\(d_i \geq 0\)</span>. The load nodes thus correspond to the places where electricity is being consumed, e.g., cities and industrial districts. We say that supply and demand is <em>matched</em> if <span class="math notranslate nohighlight">\(\sum_{i \in V} p_i - d_i = 0\)</span>. Since we cannot store electricity in large volumes, supply must meet demand at all times, hence adjusting to it every 15 minutes by solving the OPF.</p>
<p>Each edge <span class="math notranslate nohighlight">\((i, j) \in E\)</span> carries a <em>power flow</em> <span class="math notranslate nohighlight">\(f_{ij} \in R\)</span> and has a capacity <span class="math notranslate nohighlight">\(f_{ij}^{\max} \geq 0\)</span>, i.e., the maximum power flow that it may carry. Note that our choice to model a <em>directed</em> graph is to make the modeling of the network easier. In particular, a directed edge <span class="math notranslate nohighlight">\((i,j)\)</span> may carry a ‘negative’ flow <span class="math notranslate nohighlight">\(f_{ij} &lt; 0\)</span>, which implies that there is flow going from <span class="math notranslate nohighlight">\(j\)</span> to <span class="math notranslate nohighlight">\(i\)</span> where <span class="math notranslate nohighlight">\(f_{ji} = -f_{ij}\)</span>. The capacity does not depend on the direction of the flow, implying that the flow capacity constraints are given by <span class="math notranslate nohighlight">\(|f_{ij}| = |f_{ji}| \leq f_{ij}^{\max}\)</span>.</p>
<p>One crucial difference of power flow problems compared to typical network flow problems is that the power flows cannot be controlled directly. Instead, as you might recall from high-school physics, the power flows are determined by the laws of electricity, which we will now present as the <em>power flow equations</em>. Ignore for a moment the flow capacity constraints. Let <span class="math notranslate nohighlight">\(\theta_{i} \in \mathbb{R}\)</span> denote the <em>phase angle</em> of node <span class="math notranslate nohighlight">\(i\)</span>. For each edge <span class="math notranslate nohighlight">\((i,j)\)</span>, let <span class="math notranslate nohighlight">\(b_{ij} &gt; 0\)</span> denote the <em>line susceptance</em>. Assuming that supply and demand is matched, i.e., <span class="math notranslate nohighlight">\(\sum_{i=1}^{n} p_i - d_i = 0\)</span>, the power flows <span class="math notranslate nohighlight">\(\mathbf{f} \in \mathbb{R}^{m}\)</span> and phase angles <span class="math notranslate nohighlight">\(\mathbf{\theta} \in \mathbb{R}^{n}\)</span> are obtained by solving the following linear system of equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
p_i - d_i &amp;= \sum_{j: (i, j) \in E} f_{ij} - \sum_{j: (j, i) \in E} f_{ji}, &amp; \forall \, i \in V,\\
  f_{ij} &amp;=  b_{ij}(\theta_i - \theta_j), &amp; \forall \, (i, j) \in E.
\end{align}\end{split}\]</div>
<p>The first set of constraints ensures flow conservation and the second set of constrations captures the flow dependency on susceptances and angle differences. The DC power flow equations admit a unique power flow solution <span class="math notranslate nohighlight">\(\mathbf{f}\)</span> given matched power injections <span class="math notranslate nohighlight">\(\mathbf{p}\)</span> and demand <span class="math notranslate nohighlight">\(\mathbf{d}\)</span>.</p>
<p>For a given matched supply and demand vector <span class="math notranslate nohighlight">\(\mathbf{p}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{d}\)</span>, we can compute the power flows on the network by solving the linear equations as described above. There are exactly <span class="math notranslate nohighlight">\(|V|\)</span> and <span class="math notranslate nohighlight">\(|E|\)</span> equations for the <span class="math notranslate nohighlight">\(\theta_i\)</span> variables and <span class="math notranslate nohighlight">\(f_{ij}\)</span> variables, meaning that this system of equations admit a solution.</p>
</section>
<section id="optimal-power-flow">
<h2>Optimal Power Flow<a class="headerlink" href="#optimal-power-flow" title="Permalink to this headline">#</a></h2>
<p>We assumed above that the power injections <span class="math notranslate nohighlight">\(\mathbf{p}\)</span> were given. However, in practice, the power injections need to be determined for each generator in the power network, where some types of generators may be cheaper than others. Moreover, we need to take into account operational constraints, such as the maximum flow and generator limits.</p>
<p>On the short-time scale, the power injections are calculated for each generator by solving the so-called <em>Optimal Power Flow (OPF)</em> problem. The goal of the OPF problem is to determine a solution <span class="math notranslate nohighlight">\((\mathbf{p}, \mathbf{f}, \mathbf{\theta})\)</span> with minimal costs such that:</p>
<ul class="simple">
<li><p>Supply meets demand</p></li>
<li><p>Line capacity constraints are met</p></li>
<li><p>Generator capacity constraints are met</p></li>
</ul>
<p>Let <span class="math notranslate nohighlight">\(c_i &gt; 0\)</span> be the cost associated with the production of a unit energy by generator <span class="math notranslate nohighlight">\(i\)</span>. Then, the OPF problem can be formulated as</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\begin{array}{llll}
\max        &amp; \sum_{i \in V} c_i p_i \\
\text{s.t.} &amp; \sum_{j: (i, j) \in E} f_{ij} - \sum_{j: (j, i) \in E} f_{ji} = p_i - d_i &amp; \forall \, i \in V,\\
&amp; f_{ij} =  b_{ij}(\theta_i - \theta_j), &amp; \forall \, (i, j) \in E, \\
            &amp; |f_{ij}| \leq  f_{ij}^{\max}    &amp; \forall (i, j) \in E,\\
            &amp; p_{i}^{\min } \leq p_{i} \leq p_{i}^{\max }         &amp; \forall i \in V, \\
            &amp; p_i \in \mathbb{R}_{\geq 0}        &amp; \forall i \in V,                \\
            &amp; \theta_i \in \mathbb{R} &amp; \forall i \in V, \\
            &amp; f_{ij} \in \mathbb{R}                 &amp; \forall (i, j) \in E                \\
\end{array}
\end{align}\end{split}\]</div>
<p>For simplicity, you may assume that all load nodes do not produce energy, i.e., <span class="math notranslate nohighlight">\(p_i = p_i^{\min} = p_i^{\max} = 0\)</span> for all <span class="math notranslate nohighlight">\(i \in \mathcal{D}\)</span>. You may therefore model <span class="math notranslate nohighlight">\(p_i\)</span> as decision variables for all nodes (both generator and load nodes). Similarly, you may assume that all generator nodes have no demand, i.e., <span class="math notranslate nohighlight">\(d_i = 0\)</span> for all <span class="math notranslate nohighlight">\(i \in \mathcal{G}\)</span>.</p>
<p>To summarize, the decision variables in the OPF problem are:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p_i\)</span> power injections</p></li>
<li><p><span class="math notranslate nohighlight">\(\theta_i\)</span> phase angles</p></li>
<li><p><span class="math notranslate nohighlight">\(f_{ij}\)</span> power flows</p></li>
</ul>
<p>All the other quantities are instance dependent parameters.</p>
</section>
<section id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this headline">#</a></h2>
<p>You will solve the OPF problem on the IEEE-118 power network, which is a standard test network consisting of 118 nodes and 179 edges. In the following, we will load the data into the notebook and provide a description of the data. Make sure to run the setup code below. We will first describe the data which are initially provided as <code class="docutils literal notranslate"><span class="pre">pandas.DataFrames</span></code>. We will then provide a new network data structure to easily access the data for the implementation of the optimization model.</p>
<section id="setup-code">
<h3>Setup code<a class="headerlink" href="#setup-code" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load packages</span>

<span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.random</span> <span class="k">as</span> <span class="nn">rnd</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span> <span class="k">as</span> <span class="n">make_tuple</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">time</span> 

<span class="c1"># Load solver</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="n">SOLVER</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: Failed to create solver with name
    &#39;&lt;pyomo.solvers.plugins.solvers.CBCplugin.CBCSHELL object at
    0x7f7a85e3d880&gt;&#39;: Failed to set executable for solver asl. File with
    name=&lt;pyomo.solvers.plugins.solvers.CBCplugin.CBCSHELL object at
    0x7f7a85e3d880&gt; either does not exist or it is not executable. To skip
    this validation, call set_executable with validate=False.
Traceback (most recent call last):
  File &quot;/Users/jeff/opt/anaconda3/lib/python3.9/site-packages/pyomo/opt/base/solvers.py&quot;, line 166, in __call__
    opt = self._cls[_implicit_solvers[mode]](**kwds)
  File &quot;/Users/jeff/opt/anaconda3/lib/python3.9/site-packages/pyomo/solvers/plugins/solvers/ASL.py&quot;, line 45, in __init__
    SystemCallSolver.__init__(self, **kwds)
  File &quot;/Users/jeff/opt/anaconda3/lib/python3.9/site-packages/pyomo/opt/solver/shellcmd.py&quot;, line 66, in __init__
    self.set_executable(name=executable, validate=validate)
  File &quot;/Users/jeff/opt/anaconda3/lib/python3.9/site-packages/pyomo/opt/solver/shellcmd.py&quot;, line 114, in set_executable
    raise ValueError(
ValueError: Failed to set executable for solver asl. File with name=&lt;pyomo.solvers.plugins.solvers.CBCplugin.CBCSHELL object at 0x7f7a85e3d880&gt; either does not exist or it is not executable. To skip this validation, call set_executable with validate=False.
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-import">
<h3>Data import<a class="headerlink" href="#data-import" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the data</span>
<span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/mobook/MO-book/main/notebooks/04/&quot;</span>
<span class="n">nodes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">base_url</span> <span class="o">+</span> <span class="s1">&#39;nodes.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">edges_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">base_url</span> <span class="o">+</span> <span class="s1">&#39;edges.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Read all instances</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;instance&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
<span class="n">edges</span> <span class="o">=</span> <span class="n">edges_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">edges_df</span><span class="p">[</span><span class="s2">&quot;edge_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">make_tuple</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">I</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">n</span><span class="p">,</span> <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">edges</span><span class="p">}</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>

<span class="c1"># Initialize a network for demonstration purposes</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">example_nodes</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="p">[</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">instance</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">example_edges</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="p">[</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">instance</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="network-data">
<h3>Network data<a class="headerlink" href="#network-data" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">visualize_network</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">edge_flows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize a network instance, highlighting the generators in orange and the load buses in green.&quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">kamada_kawai_layout</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">color_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;solar&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffcb36&#39;</span><span class="p">,</span>
     <span class="s1">&#39;wind&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
     <span class="s1">&#39;hydro&#39;</span><span class="p">:</span> <span class="s1">&#39;#a5efff&#39;</span><span class="p">,</span>
     <span class="s1">&#39;coal&#39;</span><span class="p">:</span> <span class="s1">&#39;#686868&#39;</span><span class="p">,</span>
     <span class="s1">&#39;gas&#39;</span><span class="p">:</span> <span class="s1">&#39;#00ab4e&#39;</span><span class="p">,</span>
     <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span> <span class="s1">&#39;#b6b6b6&#39;</span><span class="p">}</span>
              
    <span class="n">vertex2color</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">color_mapping</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy_type&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">v2c_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">vertex2color</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span> <span class="c1"># Order based on networkx</span>

    <span class="n">nodes</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">v2c_list</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">,)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;#595959&#39;</span><span class="p">,)</span>

    <span class="c1"># Gives node colors</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">&quot;#595959&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualize_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/power-network_13_0.png" src="../../_images/power-network_13_0.png" />
</div>
</div>
<p>The IEEE-118 network has 18 generators, of which:</p>
<ul class="simple">
<li><p>2 hydro plants (cyan)</p></li>
<li><p>4 coal plants (dark gray)</p></li>
<li><p>4 solarfarms (yellow)</p></li>
<li><p>2 windmills (white)</p></li>
<li><p>6 gas plants (green)</p></li>
</ul>
<p>Moreover, the network has 100 load nodes (gray). Each node has the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">node_id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">d</span></code>: demand</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_min</span></code>: minimum production capacity</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_max</span></code>: maximum production capacity</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">c_var</span></code>: variable production costs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_generator</span></code>: boolean value to indicate whether the node is a generator or not</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">energy_type</span></code>: the type of energy used for electricity production</p></li>
</ul>
<p>All generator nodes can filtered by the <code class="docutils literal notranslate"><span class="pre">is_generator</span></code> parameter. All generators have a zero demand <span class="math notranslate nohighlight">\(d_i=0\)</span>. For the renewable energy sources (i.e., hydro, solar and wind) there are no variable costs <code class="docutils literal notranslate"><span class="pre">c_var</span></code>. For solar and wind, the production is fixed, i.e., <code class="docutils literal notranslate"><span class="pre">p_min</span> <span class="pre">=</span> <span class="pre">p_max</span></code>, meaning that all available solar and wind energy must be produced.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_nodes</span><span class="p">[</span><span class="n">example_nodes</span><span class="o">.</span><span class="n">is_generator</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>node_id</th>
      <th>d</th>
      <th>p_min</th>
      <th>p_max</th>
      <th>c_var</th>
      <th>is_generator</th>
      <th>energy_type</th>
      <th>instance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9</th>
      <td>9</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>400.000000</td>
      <td>0.000000</td>
      <td>True</td>
      <td>hydro</td>
      <td>0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>11</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>200.000000</td>
      <td>0.000000</td>
      <td>True</td>
      <td>hydro</td>
      <td>0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>24</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>397.800000</td>
      <td>28.948321</td>
      <td>True</td>
      <td>coal</td>
      <td>0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>25</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>873.000000</td>
      <td>22.220980</td>
      <td>True</td>
      <td>coal</td>
      <td>0</td>
    </tr>
    <tr>
      <th>30</th>
      <td>30</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>612.000000</td>
      <td>25.993982</td>
      <td>True</td>
      <td>coal</td>
      <td>0</td>
    </tr>
    <tr>
      <th>45</th>
      <td>45</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>720.000000</td>
      <td>24.202306</td>
      <td>True</td>
      <td>coal</td>
      <td>0</td>
    </tr>
    <tr>
      <th>48</th>
      <td>48</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>True</td>
      <td>solar</td>
      <td>0</td>
    </tr>
    <tr>
      <th>53</th>
      <td>53</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>True</td>
      <td>solar</td>
      <td>0</td>
    </tr>
    <tr>
      <th>58</th>
      <td>58</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>True</td>
      <td>solar</td>
      <td>0</td>
    </tr>
    <tr>
      <th>60</th>
      <td>60</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>True</td>
      <td>solar</td>
      <td>0</td>
    </tr>
    <tr>
      <th>64</th>
      <td>64</td>
      <td>0.0</td>
      <td>38.484861</td>
      <td>38.484861</td>
      <td>0.000000</td>
      <td>True</td>
      <td>wind</td>
      <td>0</td>
    </tr>
    <tr>
      <th>65</th>
      <td>65</td>
      <td>0.0</td>
      <td>180.602933</td>
      <td>180.602933</td>
      <td>0.000000</td>
      <td>True</td>
      <td>wind</td>
      <td>0</td>
    </tr>
    <tr>
      <th>79</th>
      <td>79</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>916.200000</td>
      <td>50.330000</td>
      <td>True</td>
      <td>gas</td>
      <td>0</td>
    </tr>
    <tr>
      <th>86</th>
      <td>86</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>360.000000</td>
      <td>50.330000</td>
      <td>True</td>
      <td>gas</td>
      <td>0</td>
    </tr>
    <tr>
      <th>88</th>
      <td>88</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>1146.600000</td>
      <td>50.330000</td>
      <td>True</td>
      <td>gas</td>
      <td>0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>99</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>1175.400000</td>
      <td>50.330000</td>
      <td>True</td>
      <td>gas</td>
      <td>0</td>
    </tr>
    <tr>
      <th>102</th>
      <td>102</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>194.400000</td>
      <td>50.330000</td>
      <td>True</td>
      <td>gas</td>
      <td>0</td>
    </tr>
    <tr>
      <th>110</th>
      <td>110</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>142.200000</td>
      <td>50.330000</td>
      <td>True</td>
      <td>gas</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>For the load nodes, the only important parameter is the demand <span class="math notranslate nohighlight">\(d_i \geq 0\)</span>. All other parameters are either zero, <code class="docutils literal notranslate"><span class="pre">False</span></code>, or <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_nodes</span><span class="p">[</span><span class="o">~</span><span class="n">example_nodes</span><span class="o">.</span><span class="n">is_generator</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>node_id</th>
      <th>d</th>
      <th>p_min</th>
      <th>p_max</th>
      <th>c_var</th>
      <th>is_generator</th>
      <th>energy_type</th>
      <th>instance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>28.186145</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>10.921628</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>22.884795</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>21.961682</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>113</th>
      <td>113</td>
      <td>4.396000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>114</th>
      <td>114</td>
      <td>11.864042</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>115</th>
      <td>115</td>
      <td>108.311328</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>116</th>
      <td>116</td>
      <td>10.703998</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>117</th>
      <td>117</td>
      <td>18.242759</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 8 columns</p>
</div></div></div>
</div>
</section>
<section id="edges">
<h3>Edges<a class="headerlink" href="#edges" title="Permalink to this headline">#</a></h3>
<p>The IEEE-118 network has 179 edges. Each edge has the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">edge_id</span></code>: the edge indices</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">b</span></code>: the line susceptance, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">f_max</span></code>: the maximum edge capacity.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edges_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>edge_id</th>
      <th>b</th>
      <th>f_max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(0, 1)</td>
      <td>10.0100</td>
      <td>271</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(0, 2)</td>
      <td>23.5849</td>
      <td>271</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(3, 4)</td>
      <td>125.3133</td>
      <td>316</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(2, 4)</td>
      <td>9.2593</td>
      <td>315</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(4, 5)</td>
      <td>18.5185</td>
      <td>316</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>174</th>
      <td>(64, 65)</td>
      <td>28.9059</td>
      <td>1427</td>
    </tr>
    <tr>
      <th>175</th>
      <td>(67, 68)</td>
      <td>28.9059</td>
      <td>1427</td>
    </tr>
    <tr>
      <th>176</th>
      <td>(80, 79)</td>
      <td>28.9059</td>
      <td>1427</td>
    </tr>
    <tr>
      <th>177</th>
      <td>(86, 85)</td>
      <td>4.8216</td>
      <td>253</td>
    </tr>
    <tr>
      <th>178</th>
      <td>(67, 115)</td>
      <td>246.9136</td>
      <td>12992</td>
    </tr>
  </tbody>
</table>
<p>179 rows × 3 columns</p>
</div></div></div>
</div>
</section>
<section id="network-data-structure">
<h3>Network data structure<a class="headerlink" href="#network-data-structure" title="Permalink to this headline">#</a></h3>
<p>When implementing optimization problems, it is often not the easiest way to access data directly through <code class="docutils literal notranslate"><span class="pre">pandas.DataFrames</span></code>. We have therefore provided a new type of data structure that will help to more easily implement an optimization problem. This data structure is also found in Exercise 5 &amp; 6 from Computer Lab 1, which is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">network</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;attr1&quot;</span><span class="p">:</span>  <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">},</span>
                       <span class="o">...</span>
                      <span class="p">},</span>
             <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span> <span class="p">{</span><span class="s2">&quot;attr1&quot;</span><span class="p">:</span>  <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;attr2&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">},</span>
                      <span class="o">...</span>
                      <span class="p">}</span>
            <span class="p">}</span>
</pre></div>
</div>
<p>In other words, each network consists of a dictionary, that contains a dictionary for nodes and edges, which again holds a dictionary for each node and edge. It might a be little bit confusing at first, but this data structure allows to easily access the parameters that you need for a specific constraint. For instance,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">network</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10.921627803299574
</pre></div>
</div>
</div>
</div>
<p>gives the demand of node <code class="docutils literal notranslate"><span class="pre">1</span></code>. To filter on generator nodes, you can use the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;is_generator&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9, 11, 24, 25, 30, 45, 48, 53, 58, 60, 64, 65, 79, 86, 88, 99, 102, 110]
</pre></div>
</div>
</div>
</div>
</section>
<section id="instances">
<h3>Instances<a class="headerlink" href="#instances" title="Permalink to this headline">#</a></h3>
<p>Since the OPF problem is solved every 15 minutes in practice, you will be given <code class="docutils literal notranslate"><span class="pre">24</span> <span class="pre">*</span> <span class="pre">4</span> <span class="pre">=</span> <span class="pre">96</span></code> network instances that need to be solved, hence solving an entire day’s worth of OPF problems. The first instance thus corresponds to the power generation within time window <code class="docutils literal notranslate"><span class="pre">[00:00,</span> <span class="pre">00:15]</span></code>, the second instance corresponds to <code class="docutils literal notranslate"><span class="pre">[00:15,</span> <span class="pre">00:30]</span></code>, and so on. The data takes into account a realistic demand and (renewable energy) generation pattern. We assume that the decisions in each time window are independent of the previous and subsequent time windows, so every 15 minutes a new OPF instance is solved independently.</p>
<p>The network instances are stored in the variable <code class="docutils literal notranslate"><span class="pre">I</span></code> as a list and can be accessed using indexing, i.e., <code class="docutils literal notranslate"><span class="pre">I[0]</span></code> gives the first network instance and <code class="docutils literal notranslate"><span class="pre">I[95]</span></code> gives the 96th network instance.</p>
</section>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="solving-opf">
<h1>Solving OPF<a class="headerlink" href="#solving-opf" title="Permalink to this headline">#</a></h1>
<p>Observe that the stated OPF problem contains absolute decision values. We first rewrite the OPF problem into a linear optimization problem.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\begin{array}{llll}
\min        &amp; \sum_{i \in V} c_i p_i \\
\text{s.t.} &amp; \sum_{j: (i, j) \in E} f^+_{ij} - f^-_{ij} - \sum_{j: (j, i) \in E} f^+_{ji} - f_{ji}^- = p_i - d_i &amp; \forall \, i \in V,\\
&amp; f^+_{ij} - f^-_{ij} =  b_{ij}(\theta_i - \theta_j), &amp; \forall \, (i, j) \in E, \\
            &amp; f^+_{ij} + f^-_{ij} \leq  f_{ij}^{\max}    &amp; \forall (i, j) \in E,\\
            &amp; p_{i}^{\min } \leq p_{i} \leq p_{i}^{\max }         &amp; \forall i \in V, \\
            &amp; p_i \in \mathbb{R}_{\geq 0}        &amp; \forall i \in V,                \\
            &amp; \theta_i \in \mathbb{R} &amp; \forall i \in V, \\
            &amp; f_{ij}^+, f_{ij}^- \in \mathbb{R}                 &amp; \forall (i, j) \in E                \\
\end{array}
\end{align}\end{split}\]</div>
<p>We then implement the model using <code class="docutils literal notranslate"><span class="pre">pyomo</span></code> and solve it for all instances <code class="docutils literal notranslate"><span class="pre">I[0]</span></code> to <code class="docutils literal notranslate"><span class="pre">I[95]</span></code>, reporting the average objective value across all the 96 instances.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">OPF1</span><span class="p">(</span><span class="n">network</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Input:</span>
<span class="sd">    - network: a dictionary containing:</span>
<span class="sd">      - a dictionary of nodes with a dictionary of attributes</span>
<span class="sd">      - a dictionary of edges with a dictionary of attributes</span>

<span class="sd">    Output:</span>
<span class="sd">    - power_generation: a dictionary containing the power generation for each node</span>
<span class="sd">    - power_flows: a dictionary containing the power flow for each edge</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define a model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s2">&quot;Q1&quot;</span><span class="p">)</span>

    <span class="c1"># Declare decision variables</span>
    <span class="n">model</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Reals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fabs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fm</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="c1"># Declare objective value</span>
    <span class="nd">@model</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;c_var&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;is_generator&quot;</span><span class="p">])</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">outgoing_flow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">fm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">incoming_flow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fp</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">fm</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">flow_conservation</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">outgoing_flow</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">incoming_flow</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;d&quot;</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">susceptance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">fp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">fm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">][(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)][</span><span class="s2">&quot;b&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">abs_flow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">fabs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">fp</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">fm</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">flows_upper_bound</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">fabs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">][</span><span class="n">e</span><span class="p">][</span><span class="s2">&quot;f_max&quot;</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">generation_upper_bound</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;p_max&quot;</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">generation_lower_bound</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;p_min&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
    <span class="c1"># Solve</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">SOLVER</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">objective</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The average objective value over all instances is: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">OPF1</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">I</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The average objective value over all instances is: 102898.76
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="strict-fossil-fuel-policy-pt-1">
<h1>Strict fossil fuel policy pt.1<a class="headerlink" href="#strict-fossil-fuel-policy-pt-1" title="Permalink to this headline">#</a></h1>
<p>Gas and coal plants emit CO2, while renewable energy sources are carbon neutral. For this reason, the Dutch government has decided to constrain the number of active fossil-fuel-based power plants for the generation of electricity. More specifically, a maximum of 2 gas plants and 1 coal plant may be <em>active</em> during a single OPF instance. Any plant that is set <em>inactive</em> for a specific instance cannot produce any electricity.</p>
<p>We first write down the new model. To this end, we introduce new decision variables <span class="math notranslate nohighlight">\(x_i, i\in V\)</span> to the model, which indicate whether a generator <span class="math notranslate nohighlight">\(i\)</span> is active or inactive.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\begin{array}{llll}
\min        &amp; \sum_{i \in V} c_i p_i \\
\text{s.t.} &amp; \sum_{j: (i, j) \in E} f^+_{ij} - f^-_{ij} - \sum_{j: (j, i) \in E} f^+_{ji} - f_{ji}^- = p_i - d_i &amp; \forall \, i \in V,\\
&amp; f^+_{ij} - f^-_{ij} =  b_{ij}(\theta_i - \theta_j), &amp; \forall \, (i, j) \in E, \\
&amp; f^{abs}_{ij} = f^+_{ij} + f^-_{ij}, &amp; \forall \, (i, j) \in E, \\
            &amp; f_{ij}^{abs} \leq  f_{ij}^{\max}    &amp; \forall (i, j) \in E,\\
            &amp; p_{i}^{\min } x_i \leq p_{i} \leq p_{i}^{\max } x_i        &amp; \forall i \in V, \\
            &amp; \sum_{i \in \mathcal{G}_{\text{gas}}} x_i \leq 2 &amp; \\
            &amp; \sum_{i \in \mathcal{G}_{\text{coal}}} x_i \leq 1 &amp;  \\
            &amp; p_i \in \mathbb{R}_{\geq 0}        &amp; \forall i \in V,                \\
            &amp; \theta_i \in \mathbb{R} &amp; \forall i \in V, \\
            &amp; f_{ij} \in \mathbb{R}                 &amp; \forall (i, j) \in E                \\
            &amp; x_i  \in \{0, 1\} &amp; \forall i \in V\\
\end{array}
\end{align}\end{split}\]</div>
<p>We then implement the new model using <code class="docutils literal notranslate"><span class="pre">pyomo</span></code> and solve it for all instances <code class="docutils literal notranslate"><span class="pre">I[0]</span></code> to <code class="docutils literal notranslate"><span class="pre">I[95]</span></code>, reporting the average objective value across the instances.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">OPF2</span><span class="p">(</span><span class="n">network</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Input:</span>
<span class="sd">    - network: a dictionary containing:</span>
<span class="sd">      - a dictionary of nodes with a dictionary of attributes</span>
<span class="sd">      - a dictionary of edges with a dictionary of attributes</span>

<span class="sd">    Output:</span>
<span class="sd">    - power_generation: a dictionary containing the power generation for each node</span>
<span class="sd">    - power_flows: a dictionary containing the power flow for each edge</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define a model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s2">&quot;Q2&quot;</span><span class="p">)</span>

    <span class="c1"># Declare decision variables</span>
    <span class="n">model</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Reals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fabs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fm</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>

    <span class="c1"># Declare objective value</span>
    <span class="nd">@model</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">minimize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;c_var&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;is_generator&quot;</span><span class="p">])</span>

    <span class="c1"># Declare constraints</span>
    <span class="nd">@model</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">outgoing_flow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">fm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">incoming_flow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fp</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">fm</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">flow_conservation</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">outgoing_flow</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">incoming_flow</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;d&quot;</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">susceptance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">fp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">fm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">][(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)][</span><span class="s2">&quot;b&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">abs_flows</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">fabs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">fp</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">fm</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">flows_upper_bound</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">fabs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">][</span><span class="n">e</span><span class="p">][</span><span class="s2">&quot;f_max&quot;</span><span class="p">]</span>

    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">generation_upperound</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;p_max&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">generation_lower_bound</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;p_min&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">max_gas_plants</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gas&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">max_coal_plants</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;coal&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>

    <span class="c1"># Solve</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">SOLVER</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">objective</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The average objective value over all instances is: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">OPF2</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">I</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The average objective value over all instances is: 53120.81
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="strict-fossil-fuel-policy-pt-2">
<h1>Strict fossil fuel policy pt.2<a class="headerlink" href="#strict-fossil-fuel-policy-pt-2" title="Permalink to this headline">#</a></h1>
<p>The restriction on the number of gas and coal plants may pose a threat to the availability of electricity production when renewable energy sources fail to deliver. For this reason, the grid operators have decided to slightly change the constraint that was introduced for OPF2. If the total production of energy from renewable energy sources (i.e., solar, wind and hydro) is above 1000, then the number of gas and coal plants is restricted to 2 and 1, respectively. Otherwise, the restriction on the number of gas and coal plants is lifted. These constraints can be modeled as <em>either-or</em> constraints.</p>
<p>We first write down the new model, using big-<span class="math notranslate nohighlight">\(M\)</span> constraints to model the either-or constraint.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\begin{array}{llll}
\min        &amp; \sum_{i \in V} c_i p_i \\
\text{s.t.} &amp; \sum_{j: (i, j) \in E} f^+_{ij} - f^-_{ij} - \sum_{j: (j, i) \in E} f^+_{ji} - f_{ji}^- = p_i - d_i &amp; \forall \, i \in V,\\
&amp; f^+_{ij} - f^-_{ij} =  b_{ij}(\theta_i - \theta_j), &amp; \forall \, (i, j) \in E, \\
&amp; f^{abs}_{ij} = f^+_{ij} + f^-_{ij}, &amp; \forall \, (i, j) \in E, \\
            &amp; f_{ij}^{abs} \leq  f_{ij}^{\max}    &amp; \forall (i, j) \in E,\\
            &amp; p_{i}^{\min } x_i \leq p_{i} \leq p_{i}^{\max } x_i        &amp; \forall i \in V, \\
            &amp; \sum_{i \in \mathcal{G}_{\text{gas}}} x_i \leq 2 + (1-y)M_0 &amp; \\
            &amp; \sum_{i \in \mathcal{G}_{\text{coal}}} x_i \leq 1 + (1-y)M_1 &amp;  \\
            &amp; \sum_{i \in \mathcal{G}_\text{solar}} p_i + \sum_{i \in \mathcal{G}_\text{wind}} p_i + \sum_{i \in \mathcal{G}_\text{hydro}} p_i \leq 1000 + yM_2&amp;\\
            &amp; p_i \in \mathbb{R}_{\geq 0}        &amp; \forall i \in V,                \\
            &amp; \theta_i \in \mathbb{R} &amp; \forall i \in V, \\
            &amp; f_{ij} \in \mathbb{R}                 &amp; \forall (i, j) \in E                \\
            &amp; x_i  \in \{0, 1\} &amp; \forall i \in V\\
            &amp; y \in \{0, 1\} &amp;\\
\end{array}
\end{align}\end{split}\]</div>
<p>We now implement the new model using <code class="docutils literal notranslate"><span class="pre">pyomo</span></code> and solve it for all instances <code class="docutils literal notranslate"><span class="pre">I[0]</span></code> to <code class="docutils literal notranslate"><span class="pre">I[95]</span></code>, reporting the average objective value across the instances.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">OPF3</span><span class="p">(</span><span class="n">network</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Input:</span>
<span class="sd">    - network: a dictionary containing:</span>
<span class="sd">      - a dictionary of nodes with a dictionary of attributes</span>
<span class="sd">      - a dictionary of edges with a dictionary of attributes</span>

<span class="sd">    Output:</span>
<span class="sd">    - power_generation: a dictionary containing the power generation for each node</span>
<span class="sd">    - power_flows: a dictionary containing the power flow for each edge</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define a model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s2">&quot;Q3&quot;</span><span class="p">)</span>

    <span class="c1"># Declare decision variables</span>
    <span class="n">model</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Reals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fabs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fm</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>

    <span class="c1"># Big-Ms</span>
    <span class="n">max_total_renewable_production</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;p_max&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy_type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;solar&#39;</span><span class="p">,</span> <span class="s1">&#39;wind&#39;</span><span class="p">,</span> <span class="s1">&#39;hydro&#39;</span><span class="p">])</span>
    <span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">max_total_renewable_production</span> <span class="o">-</span> <span class="mi">1000</span><span class="p">]</span>

    <span class="c1"># Declare objective value</span>
    <span class="nd">@model</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">minimize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;c_var&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;is_generator&quot;</span><span class="p">])</span>

    <span class="c1"># Declare constraints</span>
    <span class="nd">@model</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">outgoing_flow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">fm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">incoming_flow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fp</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">fm</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">flow_conservation</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">outgoing_flow</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">incoming_flow</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;d&quot;</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">susceptance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">fp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">fm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">][(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)][</span><span class="s2">&quot;b&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">abs_flows</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">fabs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">fp</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">fm</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">flows_upper_bound</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">fabs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">][</span><span class="n">e</span><span class="p">][</span><span class="s2">&quot;f_max&quot;</span><span class="p">]</span>

    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">generation_upper_bound</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;p_max&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">generation_lower_bound</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;p_min&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">max_gas_plants</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gas&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">max_coal_plants</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;coal&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@model</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">renewable_energy_production</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;energy_type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;solar&#39;</span><span class="p">,</span> <span class="s1">&#39;wind&#39;</span><span class="p">,</span> <span class="s1">&#39;hydro&#39;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="c1"># Solve</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">SOLVER</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="k">return</span>  <span class="n">model</span><span class="o">.</span><span class="n">objective</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The average objective value over all instances is: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">OPF3</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">I</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The average objective value over all instances is: 41608.73
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="comparing-the-three-models">
<h1>Comparing the three models<a class="headerlink" href="#comparing-the-three-models" title="Permalink to this headline">#</a></h1>
<p>For all three implemented models, we plot the objective values for all instances and explain the differences between the objective values in view of the different feasible regions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">objs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">OPF1</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">I</span><span class="p">],</span>
        <span class="p">[</span><span class="n">OPF2</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">I</span><span class="p">],</span>
        <span class="p">[</span><span class="n">OPF3</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">I</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">objs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;OPF1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">objs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;OPF2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">objs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;OPF3&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Optimal objective values over all instances and models&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Instance number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Optimal objective value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/power-network_39_0.png" src="../../_images/power-network_39_0.png" />
</div>
</div>
<p>The goal of the OPF problem is to minimize the total costs of dispatching energy. OPF1 is the original OPF formulation, whereas OPF2 and OPF3 are restricted versions of OPF1. This means that the feasible region of OPF1 is at least as large as OPF2 and OPF3, where we may assume that <span class="math notranslate nohighlight">\(x_i = 1\)</span> for all the generators <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>If we let <span class="math notranslate nohighlight">\(F_1, F_2, F_3\)</span> denote the feasible region of OPF1, OPF2 and OPF3, then we observe that which explains that the optimal objective value of OPF1 always remains below the optimal objectives values of OPF2 and OPF3.</p>
<p>The most important observation to make is that based on the problem descriptions, we would expect OPF2 to take on the objective values of OPF1 or OPF3, depending on which of the either-or-constraints are activated.</p>
<ul class="simple">
<li><p>OPF3 uses expensive generators, and possibly not all the renewable energy</p></li>
<li><p>OPF2 does only uses 1000 renewable energy power, because then it may keep using all the gas and coal generators.</p></li>
<li><p>OPF1 uses all renewable energy at all times, because it has the flexibility to use all generators in order to mitigate operational restrictions due to line flows.</p></li>
</ul>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/04"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="cryptocurrency-arbitrage.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Cryptocurrency arbitrage search</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="forex-arbitrage.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Forex Arbitrage</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The MO Book Group<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>